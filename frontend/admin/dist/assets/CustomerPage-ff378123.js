import{b as F,c as N,S as b,j as e,t as C,n as y,d as S,e as j,k as A,F as D,i as v,r as P,C as M,K as B,P as q}from"./index-04b06589.js";import{M as T}from"./ModalHandler-03d27907.js";import{a as L}from"./apiMultipart-73b930eb.js";import{D as w,A as _}from"./ActionsCell-f1e55298.js";import{I as g}from"./ImageTitleCell-e3aed608.js";import{P as E}from"./phoneNumber-234aa8a8.js";const f=()=>{const{showLoader:i,hideLoader:t}=F();return{viewCustomerDetails:async s=>{var n,c;try{return i(),(await N.get(`/admin/customer/${s}/edit`)).data}catch(r){return b.fire({icon:"error",title:(c=(n=r==null?void 0:r.response)==null?void 0:n.data)==null?void 0:c.message}),null}finally{t()}},updateCustomer:async(s,n,c)=>{var r,l,u,o;try{i();const a=await L.post(`/admin/customer/${n}/update`,s);b.fire({icon:(r=a.data)==null?void 0:r.status,title:(l=a.data)==null?void 0:l.message}),c==null||c(!0)}catch(a){console.log(a),b.fire({icon:"error",title:(o=(u=a==null?void 0:a.response)==null?void 0:u.data)==null?void 0:o.message})}finally{t()}},archivedCustomer:async(s,n)=>{var r,l,u,o;if((await b.fire({title:"Are you sure?",text:"This action will archive the user.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, archive it!"})).isConfirmed)try{i();const a=await N.delete(`/admin/customer/${s}/archive`);b.fire({icon:((r=a.data)==null?void 0:r.status)||"success",title:(l=a.data)==null?void 0:l.message}),n==null||n(!0)}catch(a){b.fire({icon:"error",title:((o=(u=a==null?void 0:a.response)==null?void 0:u.data)==null?void 0:o.message)||"An error occurred."})}finally{t()}},restoreCustomer:async(s,n,c)=>{var l,u,o,a;if((await b.fire({title:"Are you sure?",text:"This will restore the archived user.",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, restore it!"})).isConfirmed)try{i();const p=await N.post(`/admin/customer/${s}/restore`);b.fire({icon:((l=p.data)==null?void 0:l.status)||"success",title:((u=p.data)==null?void 0:u.message)||"User restored successfully."}),n==null||n(!0),c==null||c(!0)}catch(p){b.fire({icon:"error",title:((a=(o=p==null?void 0:p.response)==null?void 0:o.data)==null?void 0:a.message)||"Something went wrong."})}finally{t()}}}},$=({data:i})=>{const{personal_info:t}=i;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"d-flex align-items-center mb-4",children:e.jsxs("div",{children:[e.jsx("h5",{className:"mb-0",children:t.full_name}),e.jsx("small",{className:"text-muted",children:"Customer"})]})}),e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-sm-4 text-muted",children:"Email"}),e.jsx("div",{className:"col-sm-8 fw-semibold",children:t.email})]}),e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-sm-4 text-muted",children:"Contact No"}),e.jsx("div",{className:"col-sm-8 fw-semibold",children:t.phone})]}),e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-sm-4 text-muted",children:"Birthdate"}),e.jsx("div",{className:"col-sm-8 fw-semibold",children:t.birth_date_format})]}),e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-sm-4 text-muted",children:"Gender"}),e.jsx("div",{className:"col-sm-8 fw-semibold",children:t.gender==="M"?"Male":"Female"})]})]})},V=({data:i,loading:t,pagination:h,sortColumn:d,sortDirection:m,onPageChange:x,onSortChange:s,onRestore:n,onSearchChange:c,setRefreshTable:r,setRefreshFirstTable:l})=>{const u=[{title:"#",key:"row_number",sortable:!0},{title:"User",key:"image_cover",render:o=>e.jsx(g,{image:o.image_cover??C("media/products/default.jpg"),mainTitle:o.full_name,subTitle:o.account_no})},{title:"Contact Info",key:"email",sortable:!0,render:o=>e.jsx(g,{mainTitle:o.customer_account.email,subTitle:o.phone??"No Mobile Number Available"})},{title:"Gender",key:"gender_text_format",sortable:!0},{title:"Birth Date",key:"birth_date_format",sortable:!0},{title:"Action",key:"id_encrypted",render:o=>e.jsx(_,{restoreAction:()=>n(o.id_encrypted,r,l)})}];return e.jsx("div",{className:"table-responsive",children:t?e.jsx("div",{className:"alert alert-info",children:"Loading..."}):e.jsx(w,{data:i,columns:u,loading:t,pagination:h,sortColumn:d,sortDirection:m,onPageChange:x,onSortChange:s,onSearchChange:c})})},G=({onRefreshFirstTable:i})=>{const t=y("/admin/customer/archived/list"),{restoreCustomer:h}=f();return e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsx(V,{data:t.data,loading:t.loading,pagination:t.pagination,sortColumn:t.sortColumn,sortDirection:t.sortDirection,onPageChange:t.setPage,onSortChange:(d,m)=>{t.setSortColumn(d),t.setSortDirection(m)},onRestore:h,onSearchChange:d=>{t.setPage(1),t.setSearch(d)},setRefreshTable:t.setRefreshTable,setRefreshFirstTable:i})})})},I=({data:i,loading:t,pagination:h,sortColumn:d,sortDirection:m,onPageChange:x,onSortChange:s,onEdit:n,onView:c,onArchive:r,onSearchChange:l,setRefreshTable:u})=>{const o=[{title:"#",key:"row_number",sortable:!0},{title:"User",key:"image_cover",render:a=>e.jsx(g,{image:a.image_cover??C("media/products/default.jpg"),mainTitle:a.full_name,subTitle:a.customer_no})},{title:"Contact Info",key:"email",sortable:!0,render:a=>e.jsx(g,{mainTitle:a.customer_account.email,subTitle:a.phone??"No Mobile Number Available"})},{title:"Gender",key:"gender_text_format",sortable:!0},{title:"Birth Date",key:"birth_date_format",sortable:!0},{title:"Action",key:"id_encrypted",render:a=>e.jsx(_,{openDetailsModal:()=>c(a.id_encrypted),openEditModal:()=>n(a.id_encrypted),archiveAction:()=>r(a.id_encrypted,u)})}];return e.jsx("div",{className:"table-responsive",children:t?e.jsx("div",{className:"alert alert-info",children:"Loading..."}):e.jsx(w,{data:i,columns:o,loading:t,pagination:h,sortColumn:d,sortDirection:m,onPageChange:x,onSortChange:s,onSearchChange:l})})},U=({customerID:i,data:t,setRefreshTable:h,onSubmit:d})=>{const{updateCustomer:m}=f(),x=S().shape({fname:j().required("First name is required"),lname:j().required("Last name is required"),phone:j().required("Contact number is required"),email:j().required("Email address is required"),gender:j().oneOf(["M","F"]).required("Gender is required"),birthdate:A().required("Birthdate is required")});return e.jsx(D,{initialValues:{fname:t.personal_info.fname||"",lname:t.personal_info.lname||"",mname:t.personal_info.mname||"",suffix:t.personal_info.suffix||"",phone:t.personal_info.phone||"",email:t.personal_info.email||"",gender:t.personal_info.gender||"",birthdate:t.personal_info.birthdate||"",address:t.personal_info.address||""},validationSchema:x,onSubmit:async(s,{resetForm:n})=>{await m(s,i,h),d==null||d(s)},children:s=>e.jsxs("form",{noValidate:!0,onSubmit:s.handleSubmit,children:[e.jsx("div",{className:"row",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"First Name"}),e.jsx("input",{type:"text",className:v("form-control",{"is-invalid":s.touched.fname&&s.errors.fname}),...s.getFieldProps("fname")}),s.touched.fname&&typeof s.errors.fname=="string"&&e.jsx("div",{className:"invalid-feedback",children:s.errors.fname})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Middle Name"}),e.jsx("input",{type:"text",className:"form-control",...s.getFieldProps("mname")})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Last Name"}),e.jsx("input",{type:"text",className:v("form-control",{"is-invalid":s.touched.lname&&s.errors.lname}),...s.getFieldProps("lname")}),s.touched.lname&&typeof s.errors.lname=="string"&&e.jsx("div",{className:"invalid-feedback",children:s.errors.lname})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Suffix"}),e.jsx("input",{type:"text",className:"form-control",...s.getFieldProps("suffix")})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Gender"}),e.jsxs("select",{className:v("form-select",{"is-invalid":s.touched.gender&&s.errors.gender}),...s.getFieldProps("gender"),children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"M",children:"Male"}),e.jsx("option",{value:"F",children:"Female"})]}),s.touched.gender&&typeof s.errors.gender=="string"&&e.jsx("div",{className:"invalid-feedback",children:s.errors.gender})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Birthdate"}),e.jsx("input",{type:"date",className:v("form-control",{"is-invalid":s.touched.birthdate&&s.errors.birthdate}),...s.getFieldProps("birthdate")}),s.touched.birthdate&&typeof s.errors.birthdate=="string"&&e.jsx("div",{className:"invalid-feedback",children:s.errors.birthdate})]}),e.jsx(E,{setClass:"col-md-12 mb-3",labelName:"Contact Number",name:"phone",data:s.values.phone,setFieldValue:s.setFieldValue,error:s.errors.phone,touched:!!s.touched.phone}),e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label",children:"Email Address"}),e.jsx("input",{type:"email",className:v("form-control",{"is-invalid":s.touched.email&&s.errors.email}),...s.getFieldProps("email")}),s.touched.email&&typeof s.errors.email=="string"&&e.jsx("div",{className:"invalid-feedback",children:s.errors.email})]})]})}),e.jsx("div",{className:"d-flex justify-content-end mt-4",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Submit"})})]})})},H=({title:i})=>{const t=y("/admin/customer/list"),{viewCustomerDetails:h,archivedCustomer:d}=f(),[m,x]=P.useState({visible:!1,title:"",body:e.jsx(e.Fragment,{}),className:"modal-xl",alignment:"centered"}),s=async r=>{const l=await h(r);l&&x({visible:!0,title:`Edit ${i}`,body:e.jsx(U,{customerID:r,data:l,setRefreshTable:t.setRefreshTable}),className:"modal-xl",alignment:"centered"})},n=async r=>{const l=await h(r);l&&x({visible:!0,title:`View ${i} Details`,body:e.jsx($,{data:l}),className:"modal-md",alignment:"centered"})},c=async()=>{x({visible:!0,title:"Archived",body:e.jsx(G,{onRefreshFirstTable:t.setRefreshTable}),className:"modal-xl",alignment:"centered"})};return e.jsx(e.Fragment,{children:e.jsxs(M,{children:[e.jsxs("div",{className:"card mb-5 mb-xl-8",children:[e.jsxs("div",{className:"card-header border-0 pt-5",children:[e.jsx("h3",{className:"card-title align-items-start flex-column",children:e.jsxs("span",{className:"card-label fw-bold fs-3 mb-1",children:[i,"s"]})}),e.jsx("div",{className:"card-toolbar","data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-trigger":"hover",title:`Click to add a ${i.toLowerCase()}`,children:e.jsxs("button",{onClick:()=>c(),className:"btn btn-sm btn-light-danger me-3",children:[e.jsx(B,{iconName:"delete-files",className:"fs-3"}),"Archived"]})})]}),e.jsx("div",{className:"card-body py-3",children:e.jsx("div",{className:"table-responsive",children:e.jsx(I,{data:t.data,loading:t.loading,pagination:t.pagination,sortColumn:t.sortColumn,sortDirection:t.sortDirection,onPageChange:t.setPage,onSortChange:(r,l)=>{t.setSortColumn(r),t.setSortDirection(l)},onEdit:s,onView:n,onArchive:d,onSearchChange:r=>{t.setPage(1),t.setSearch(r)},setRefreshTable:t.setRefreshTable})})})]}),m.visible&&e.jsx(T,{title:m.title,body:m.body,modalClass:m.className,alignment:m.alignment,onClose:()=>x({visible:!1,title:"",body:e.jsx(e.Fragment,{}),className:"",alignment:"center"})})]})})},K=[{title:"Customer List",path:"/customer/list",isSeparator:!1,isActive:!1}],X=()=>e.jsxs(e.Fragment,{children:[e.jsx(q,{breadcrumbs:K}),e.jsx(H,{title:"Customer"})]});export{X as default};
