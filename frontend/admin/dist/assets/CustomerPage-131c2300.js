import{b as S,c as f,S as v,j as e,a as y,t as _,n as w,d as D,e as j,k as P,F as M,i as g,r as B,C as q,K as T,P as L}from"./index-47a86244.js";import{M as E}from"./ModalHandler-ad0ee9b4.js";import{a as $}from"./apiMultipart-5aee4e22.js";import{D as F,A}from"./ActionsCell-25d0eec8.js";import{I as N}from"./ImageTitleCell-2b5fa3f1.js";import{P as V}from"./phoneNumber-73030602.js";const C=()=>{const{showLoader:i,hideLoader:t}=S();return{viewCustomerDetails:async s=>{var n,o;try{return i(),(await f.get(`/admin/customer/${s}/edit`)).data}catch(a){return v.fire({icon:"error",title:(o=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:o.message}),null}finally{t()}},updateCustomer:async(s,n,o)=>{var a,l,u,h;try{i();const r=await $.post(`/admin/customer/${n}/update`,s);v.fire({icon:(a=r.data)==null?void 0:a.status,title:(l=r.data)==null?void 0:l.message}),o==null||o(!0)}catch(r){console.log(r),v.fire({icon:"error",title:(h=(u=r==null?void 0:r.response)==null?void 0:u.data)==null?void 0:h.message})}finally{t()}},archivedCustomer:async(s,n)=>{var a,l,u,h;if((await v.fire({title:"Are you sure?",text:"This action will archive the user.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, archive it!"})).isConfirmed)try{i();const r=await f.delete(`/admin/customer/${s}/archive`);v.fire({icon:((a=r.data)==null?void 0:a.status)||"success",title:(l=r.data)==null?void 0:l.message}),n==null||n(!0)}catch(r){v.fire({icon:"error",title:((h=(u=r==null?void 0:r.response)==null?void 0:u.data)==null?void 0:h.message)||"An error occurred."})}finally{t()}},restoreCustomer:async(s,n,o)=>{var l,u,h,r;if((await v.fire({title:"Are you sure?",text:"This will restore the archived user.",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, restore it!"})).isConfirmed)try{i();const c=await f.post(`/admin/customer/${s}/restore`);v.fire({icon:((l=c.data)==null?void 0:l.status)||"success",title:((u=c.data)==null?void 0:u.message)||"User restored successfully."}),n==null||n(!0),o==null||o(!0)}catch(c){v.fire({icon:"error",title:((r=(h=c==null?void 0:c.response)==null?void 0:h.data)==null?void 0:r.message)||"Something went wrong."})}finally{t()}}}},G=({data:i})=>{const{personal_info:t}=i;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"d-flex align-items-center mb-4",children:e.jsxs("div",{children:[e.jsx("h5",{className:"mb-0",children:t.full_name}),e.jsx("small",{className:"text-muted",children:"Customer"})]})}),e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-sm-4 text-muted",children:"Email"}),e.jsx("div",{className:"col-sm-8 fw-semibold",children:t.email})]}),e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-sm-4 text-muted",children:"Contact No"}),e.jsx("div",{className:"col-sm-8 fw-semibold",children:t.phone})]}),e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-sm-4 text-muted",children:"Birthdate"}),e.jsx("div",{className:"col-sm-8 fw-semibold",children:t.birth_date_format})]}),e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-sm-4 text-muted",children:"Gender"}),e.jsx("div",{className:"col-sm-8 fw-semibold",children:t.gender==="M"?"Male":"Female"})]})]})},I=({data:i,loading:t,pagination:x,sortColumn:d,sortDirection:m,onPageChange:b,onSortChange:s,onRestore:n,onSearchChange:o,setRefreshTable:a,setRefreshFirstTable:l})=>{const{currentUser:u}=y(),h=u==null?void 0:u.permissions,r=[{title:"#",key:"row_number",sortable:!0},{title:"User",key:"image_cover",render:c=>e.jsx(N,{image:c.image_cover??_("media/products/default.jpg"),mainTitle:c.full_name,subTitle:c.account_no})},{title:"Contact Info",key:"email",sortable:!0,render:c=>e.jsx(N,{mainTitle:c.customer_account.email,subTitle:c.phone??"No Mobile Number Available"})},{title:"Gender",key:"gender_text_format",sortable:!0},{title:"Birth Date",key:"birth_date_format",sortable:!0},{title:"Action",key:"id_encrypted",render:c=>e.jsx(A,{restoreAction:h.includes("restore_customer")?()=>n(c.id_encrypted,a,l):void 0})}];return e.jsx("div",{className:"table-responsive",children:t?e.jsx("div",{className:"alert alert-info",children:"Loading..."}):e.jsx(F,{data:i,columns:r,loading:t,pagination:x,sortColumn:d,sortDirection:m,onPageChange:b,onSortChange:s,onSearchChange:o})})},H=({onRefreshFirstTable:i})=>{const t=w("/admin/customer/archived/list"),{restoreCustomer:x}=C();return e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsx(I,{data:t.data,loading:t.loading,pagination:t.pagination,sortColumn:t.sortColumn,sortDirection:t.sortDirection,onPageChange:t.setPage,onSortChange:(d,m)=>{t.setSortColumn(d),t.setSortDirection(m)},onRestore:x,onSearchChange:d=>{t.setPage(1),t.setSearch(d)},setRefreshTable:t.setRefreshTable,setRefreshFirstTable:i})})})},K=({data:i,loading:t,pagination:x,sortColumn:d,sortDirection:m,onPageChange:b,onSortChange:s,onEdit:n,onView:o,onArchive:a,onSearchChange:l,setRefreshTable:u})=>{const{currentUser:h}=y(),r=h==null?void 0:h.permissions,c=[{title:"#",key:"row_number",sortable:!0},{title:"User",key:"image_cover",render:p=>e.jsx(N,{image:p.image_cover??_("media/products/default.jpg"),mainTitle:p.full_name,subTitle:p.customer_no})},{title:"Contact Info",key:"email",sortable:!0,render:p=>e.jsx(N,{mainTitle:p.customer_account.email,subTitle:p.phone??"No Mobile Number Available"})},{title:"Gender",key:"gender_text_format",sortable:!0},{title:"Birth Date",key:"birth_date_format",sortable:!0},{title:"Action",key:"id_encrypted",render:p=>e.jsx(A,{openDetailsModal:r.includes("view_customer_details")?()=>o(p.id_encrypted):void 0,openEditModal:r.includes("update_customer")?()=>n(p.id_encrypted):void 0,archiveAction:r.includes("archived_customer")?()=>a(p.id_encrypted,u):void 0})}];return e.jsx("div",{className:"table-responsive",children:t?e.jsx("div",{className:"alert alert-info",children:"Loading..."}):e.jsx(F,{data:i,columns:c,loading:t,pagination:x,sortColumn:d,sortDirection:m,onPageChange:b,onSortChange:s,onSearchChange:l})})},U=({customerID:i,data:t,setRefreshTable:x,onSubmit:d})=>{const{updateCustomer:m}=C(),b=D().shape({fname:j().required("First name is required"),lname:j().required("Last name is required"),phone:j().required("Contact number is required"),email:j().required("Email address is required"),gender:j().oneOf(["M","F"]).required("Gender is required"),birthdate:P().required("Birthdate is required")});return e.jsx(M,{initialValues:{fname:t.personal_info.fname||"",lname:t.personal_info.lname||"",mname:t.personal_info.mname||"",suffix:t.personal_info.suffix||"",phone:t.personal_info.phone||"",email:t.personal_info.email||"",gender:t.personal_info.gender||"",birthdate:t.personal_info.birthdate||"",address:t.personal_info.address||""},validationSchema:b,onSubmit:async(s,{resetForm:n})=>{await m(s,i,x),d==null||d(s)},children:s=>e.jsxs("form",{noValidate:!0,onSubmit:s.handleSubmit,children:[e.jsx("div",{className:"row",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"First Name"}),e.jsx("input",{type:"text",className:g("form-control",{"is-invalid":s.touched.fname&&s.errors.fname}),...s.getFieldProps("fname")}),s.touched.fname&&typeof s.errors.fname=="string"&&e.jsx("div",{className:"invalid-feedback",children:s.errors.fname})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Middle Name"}),e.jsx("input",{type:"text",className:"form-control",...s.getFieldProps("mname")})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Last Name"}),e.jsx("input",{type:"text",className:g("form-control",{"is-invalid":s.touched.lname&&s.errors.lname}),...s.getFieldProps("lname")}),s.touched.lname&&typeof s.errors.lname=="string"&&e.jsx("div",{className:"invalid-feedback",children:s.errors.lname})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Suffix"}),e.jsx("input",{type:"text",className:"form-control",...s.getFieldProps("suffix")})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Gender"}),e.jsxs("select",{className:g("form-select",{"is-invalid":s.touched.gender&&s.errors.gender}),...s.getFieldProps("gender"),children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"M",children:"Male"}),e.jsx("option",{value:"F",children:"Female"})]}),s.touched.gender&&typeof s.errors.gender=="string"&&e.jsx("div",{className:"invalid-feedback",children:s.errors.gender})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Birthdate"}),e.jsx("input",{type:"date",className:g("form-control",{"is-invalid":s.touched.birthdate&&s.errors.birthdate}),...s.getFieldProps("birthdate")}),s.touched.birthdate&&typeof s.errors.birthdate=="string"&&e.jsx("div",{className:"invalid-feedback",children:s.errors.birthdate})]}),e.jsx(V,{setClass:"col-md-12 mb-3",labelName:"Contact Number",name:"phone",data:s.values.phone,setFieldValue:s.setFieldValue,error:s.errors.phone,touched:!!s.touched.phone}),e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label",children:"Email Address"}),e.jsx("input",{type:"email",className:g("form-control",{"is-invalid":s.touched.email&&s.errors.email}),...s.getFieldProps("email")}),s.touched.email&&typeof s.errors.email=="string"&&e.jsx("div",{className:"invalid-feedback",children:s.errors.email})]})]})}),e.jsx("div",{className:"d-flex justify-content-end mt-4",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Submit"})})]})})},Y=({title:i})=>{const t=w("/admin/customer/list"),{viewCustomerDetails:x,archivedCustomer:d}=C(),[m,b]=B.useState({visible:!1,title:"",body:e.jsx(e.Fragment,{}),className:"modal-xl",alignment:"centered"}),s=async a=>{const l=await x(a);l&&b({visible:!0,title:`Edit ${i}`,body:e.jsx(U,{customerID:a,data:l,setRefreshTable:t.setRefreshTable}),className:"modal-xl",alignment:"centered"})},n=async a=>{const l=await x(a);l&&b({visible:!0,title:`View ${i} Details`,body:e.jsx(G,{data:l}),className:"modal-md",alignment:"centered"})},o=async()=>{b({visible:!0,title:"Archived",body:e.jsx(H,{onRefreshFirstTable:t.setRefreshTable}),className:"modal-xl",alignment:"centered"})};return e.jsx(e.Fragment,{children:e.jsxs(q,{children:[e.jsxs("div",{className:"card mb-5 mb-xl-8",children:[e.jsxs("div",{className:"card-header border-0 pt-5",children:[e.jsx("h3",{className:"card-title align-items-start flex-column",children:e.jsxs("span",{className:"card-label fw-bold fs-3 mb-1",children:[i,"s"]})}),e.jsx("div",{className:"card-toolbar","data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-trigger":"hover",title:`Click to add a ${i.toLowerCase()}`,children:e.jsxs("button",{onClick:()=>o(),className:"btn btn-sm btn-light-danger me-3",children:[e.jsx(T,{iconName:"delete-files",className:"fs-3"}),"Archived"]})})]}),e.jsx("div",{className:"card-body py-3",children:e.jsx("div",{className:"table-responsive",children:e.jsx(K,{data:t.data,loading:t.loading,pagination:t.pagination,sortColumn:t.sortColumn,sortDirection:t.sortDirection,onPageChange:t.setPage,onSortChange:(a,l)=>{t.setSortColumn(a),t.setSortDirection(l)},onEdit:s,onView:n,onArchive:d,onSearchChange:a=>{t.setPage(1),t.setSearch(a)},setRefreshTable:t.setRefreshTable})})})]}),m.visible&&e.jsx(E,{title:m.title,body:m.body,modalClass:m.className,alignment:m.alignment,onClose:()=>b({visible:!1,title:"",body:e.jsx(e.Fragment,{}),className:"",alignment:"center"})})]})})},O=[{title:"Customer List",path:"/customer/list",isSeparator:!1,isActive:!1}],R=()=>e.jsxs(e.Fragment,{children:[e.jsx(L,{breadcrumbs:O}),e.jsx(Y,{title:"Customer"})]});export{R as default};
