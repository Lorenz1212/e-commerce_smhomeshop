import{b as E,c as y,S as j,r as w,j as e,i as f,d as P,e as N,k as L,l as F,m as G,F as I,K as C,a as _,t as T,n as A,C as Y,o as H,g as K,R as X,h as B,O as Z,P as $}from"./index-47a86244.js";import{M as O}from"./ModalHandler-ad0ee9b4.js";import{a as R}from"./apiMultipart-5aee4e22.js";import{M as z}from"./MulitpleImageUploader-3f05f02e.js";import{P as J}from"./phoneNumber-73030602.js";import{S as k}from"./react-select.esm-840b2ab4.js";import{D as q,A as M}from"./ActionsCell-25d0eec8.js";import{I as S}from"./ImageTitleCell-2b5fa3f1.js";const D=()=>{const{showLoader:i,hideLoader:a}=E();return{viewUserDetails:async h=>{var s,t;try{return i(),(await y.get(`/core/user/${h}/edit`)).data}catch(n){return j.fire({icon:"error",title:(t=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:t.message}),null}finally{a()}},createUser:async(h,s,t,n)=>{var m,c,l,d,b;try{i();const g=await R.post("/core/user/store",h);j.fire({icon:(m=g.data)==null?void 0:m.status,title:(c=g.data)==null?void 0:c.message}),((l=g.data)==null?void 0:l.status)=="success"&&(s(),t==null||t(!0),n==null||n(1))}catch(g){j.fire({icon:"error",title:(b=(d=g==null?void 0:g.response)==null?void 0:d.data)==null?void 0:b.message})}finally{a()}},updateUser:async(h,s,t)=>{var n,m,c,l;try{i();const d=await R.post(`/core/user/${s}/update`,h);j.fire({icon:(n=d.data)==null?void 0:n.status,title:(m=d.data)==null?void 0:m.message}),t==null||t(!0)}catch(d){console.log(d),j.fire({icon:"error",title:(l=(c=d==null?void 0:d.response)==null?void 0:c.data)==null?void 0:l.message})}finally{a()}},archivedUser:async(h,s)=>{var n,m,c,l;if((await j.fire({title:"Are you sure?",text:"This action will archive the user.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, archive it!"})).isConfirmed)try{i();const d=await y.delete(`/core/user/${h}/archive`);j.fire({icon:((n=d.data)==null?void 0:n.status)||"success",title:(m=d.data)==null?void 0:m.message}),s==null||s(!0)}catch(d){j.fire({icon:"error",title:((l=(c=d==null?void 0:d.response)==null?void 0:c.data)==null?void 0:l.message)||"An error occurred."})}finally{a()}},restoreUser:async(h,s,t)=>{var m,c,l,d;if((await j.fire({title:"Are you sure?",text:"This will restore the archived user.",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, restore it!"})).isConfirmed)try{i();const b=await y.post(`/core/user/${h}/restore`);j.fire({icon:((m=b.data)==null?void 0:m.status)||"success",title:((c=b.data)==null?void 0:c.message)||"User restored successfully."}),s==null||s(!0),t==null||t(!0)}catch(b){j.fire({icon:"error",title:((d=(l=b==null?void 0:b.response)==null?void 0:l.data)==null?void 0:d.message)||"Something went wrong."})}finally{a()}},resetPasswordUser:async(h,s)=>{var n,m,c,l;if((await j.fire({title:"Are you sure?",text:"This user will be reset password.",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, reset it!"})).isConfirmed)try{i();const d=await y.post(`/core/user/${h}/reset`);j.fire({icon:((n=d.data)==null?void 0:n.status)||"success",title:((m=d.data)==null?void 0:m.message)||"User reset password successfully."}),s==null||s(!0)}catch(d){j.fire({icon:"error",title:((l=(c=d==null?void 0:d.response)==null?void 0:c.data)==null?void 0:l.message)||"Something went wrong."})}finally{a()}}}};async function ee(){try{const a=(await y.get("/core/roles")).data;return Array.isArray(a)?a:(console.warn("Unexpected response shape:",a),[])}catch(i){return console.error("Failed to fetch categories:",i),[]}}const Q=({setClass:i,name:a,value:v,onChange:o,onBlur:x,error:p,touched:r})=>{const[u,h]=w.useState([]);return w.useEffect(()=>{ee().then(s=>{const t=s.map(n=>({value:n.id,label:n.name}));h(t)}).catch(console.error)},[]),e.jsxs("div",{className:i,children:[e.jsx("label",{className:"form-label",children:"Roles"}),e.jsx(k,{name:a,options:u,value:u.find(s=>s.value===v)||null,onChange:s=>o({target:{name:a,value:(s==null?void 0:s.value)||""}}),onBlur:x,className:f("form-select-solid text-dark",{"is-invalid":p&&r},{})}),p&&r&&e.jsx("div",{className:"invalid-feedback",children:p})]})},se=P().shape({fname:N().required("First name is required"),lname:N().required("Last name is required"),contact_no:N().required("Contact number is required"),email:N().required("Email address is required"),gender:N().oneOf(["M","F"]).required("Gender is required"),birthdate:L().required("Birthdate is required"),modules:F().of(N()).min(1,"At least one module must be selected"),role_id:N().test("role-required-if-core","Role is required when Core module is selected",function(i){const{modules:a}=this.parent;return a!=null&&a.includes("core")?!!i:!0}),images:G().test("required","Image is required",i=>Array.isArray(i)&&i.length>0)}),ae=({setPage:i,setRefreshTable:a,onSubmit:v})=>{const[o,x]=w.useState([]),{createUser:p}=D();return e.jsx(I,{initialValues:{fname:"",lname:"",mname:"",suffix:"",contact_no:"",email:"",gender:"",birthdate:"",address:"",role_id:"",modules:[],images:[]},validationSchema:se,onSubmit:async(r,{resetForm:u})=>{await p(r,u,a,i),v==null||v(r)},children:r=>e.jsxs("form",{noValidate:!0,onSubmit:r.handleSubmit,children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-12",children:e.jsx("div",{className:"mb-3",children:e.jsx(z,{name:"images",formik:r,previews:o,setPreviews:x,label:"Profile Image",maxFiles:1})})}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"First Name"}),e.jsx("input",{type:"text",className:f("form-control",{"is-invalid":r.touched.fname&&r.errors.fname}),...r.getFieldProps("fname")}),r.touched.fname&&r.errors.fname&&e.jsx("div",{className:"invalid-feedback",children:r.errors.fname})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Middle Name"}),e.jsx("input",{type:"text",className:"form-control",...r.getFieldProps("mname")})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Last Name"}),e.jsx("input",{type:"text",className:f("form-control",{"is-invalid":r.touched.lname&&r.errors.lname}),...r.getFieldProps("lname")}),r.touched.lname&&r.errors.lname&&e.jsx("div",{className:"invalid-feedback",children:r.errors.lname})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Suffix"}),e.jsx("input",{type:"text",className:"form-control",...r.getFieldProps("suffix")})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Gender"}),e.jsxs("select",{className:f("form-select",{"is-invalid":r.touched.gender&&r.errors.gender}),...r.getFieldProps("gender"),children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"M",children:"Male"}),e.jsx("option",{value:"F",children:"Female"})]}),r.touched.gender&&typeof r.errors.gender=="string"&&e.jsx("div",{className:"invalid-feedback",children:r.errors.gender})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Birthdate"}),e.jsx("input",{type:"date",className:f("form-control",{"is-invalid":r.touched.birthdate&&r.errors.birthdate}),...r.getFieldProps("birthdate")}),r.touched.birthdate&&typeof r.errors.birthdate=="string"&&e.jsx("div",{className:"invalid-feedback",children:r.errors.birthdate})]}),e.jsx(J,{setClass:"col-md-12 mb-3",labelName:"Contact Number",name:"contact_no",data:r.values.contact_no,setFieldValue:r.setFieldValue,error:r.errors.contact_no,touched:r.touched.contact_no}),e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label",children:"Email Address"}),e.jsx("input",{type:"email",className:f("form-control",{"is-invalid":r.touched.email&&r.errors.email}),...r.getFieldProps("email")}),r.touched.email&&r.errors.email&&e.jsx("div",{className:"invalid-feedback",children:r.errors.email})]}),e.jsxs("div",{className:"col-md-12 mb-5",children:[e.jsx("label",{className:"form-label",children:"Address"}),e.jsx("textarea",{rows:3,className:f("form-control"),...r.getFieldProps("address")})]})]}),e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("div",{children:e.jsx("label",{className:"form-label fw-bold me-5",children:"Modules"})}),e.jsxs("div",{className:"form-check form-check-inline",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"module-cashier",value:"cashier",checked:r.values.modules.includes("cashier"),onChange:()=>{const u=[...r.values.modules];u.includes("cashier")?r.setFieldValue("modules",u.filter(h=>h!=="cashier")):(u.push("cashier"),r.setFieldValue("modules",u))}}),e.jsx("label",{className:"form-check-label",htmlFor:"module-cashier",children:"Cashier"}),e.jsx("div",{className:"form-text",children:"Grants access to the cashier portal for handling transactions."})]}),e.jsxs("div",{className:"form-check form-check-inline",children:[e.jsx("input",{className:"form-check-input mb-10",type:"checkbox",id:"module-core",value:"core",checked:r.values.modules.includes("core"),onChange:()=>{const u=[...r.values.modules];u.includes("core")?r.setFieldValue("modules",u.filter(h=>h!=="core")):(u.push("core"),r.setFieldValue("modules",u))}}),e.jsx("label",{className:"form-check-label",htmlFor:"module-core",children:"Core"}),e.jsx("div",{className:"form-text",children:"Grants access to core system features. Selecting this will enable Role selection."})]}),r.touched.modules&&r.errors.modules&&e.jsx("div",{className:"text-danger small",children:r.errors.modules})]}),r.values.modules.includes("core")&&e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx(Q,{setClass:"mb-3",name:"role_id",value:r.values.role_id,onChange:r.handleChange,onBlur:r.handleBlur,error:r.errors.role_id,touched:r.touched.role_id}),r.touched.role_id&&r.errors.role_id&&e.jsx("div",{className:"invalid-feedback",children:r.errors.role_id})]})]}),e.jsx("div",{className:"d-flex justify-content-end mt-4",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Submit"})})]})})},re=({userID:i,data:a,setRefreshTable:v,onSubmit:o})=>{var h;const[x,p]=w.useState((h=a==null?void 0:a.personal_info)!=null&&h.image_cover?[a.personal_info.image_cover]:[]),{updateUser:r}=D(),u=P().shape({fname:N().required("First name is required"),lname:N().required("Last name is required"),contact_no:N().required("Contact number is required"),email:N().required("Email address is required"),gender:N().oneOf(["M","F"]).required("Gender is required"),birthdate:L().required("Birthdate is required"),modules:F().of(N()).min(1,"At least one module must be selected"),role_id:N().test("role-required-if-core","Role is required when Core module is selected",function(s){const{modules:t}=this.parent;return t!=null&&t.includes("core")?!!s:!0}),images:G()});return e.jsx(I,{initialValues:{fname:a.personal_info.fname||"",lname:a.personal_info.lname||"",mname:a.personal_info.mname||"",suffix:a.personal_info.suffix||"",contact_no:a.personal_info.contact_no||"",email:a.user.email||"",gender:a.personal_info.gender||"",birthdate:a.personal_info.birthdate||"",address:a.personal_info.address||"",role_id:a.role?a.role:"",modules:[...a.modules,...a.role?["core"]:[]],images:[]},validationSchema:u,onSubmit:async(s,{resetForm:t})=>{await r(s,i,v),o==null||o(s)},children:s=>e.jsxs("form",{noValidate:!0,onSubmit:s.handleSubmit,children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-12",children:e.jsx("div",{className:"mb-3",children:e.jsx(z,{name:"images",formik:s,previews:x,setPreviews:p,label:"Profile Image",maxFiles:1})})}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"First Name"}),e.jsx("input",{type:"text",className:f("form-control",{"is-invalid":s.touched.fname&&s.errors.fname}),...s.getFieldProps("fname")}),s.touched.fname&&typeof s.errors.fname=="string"&&e.jsx("div",{className:"invalid-feedback",children:s.errors.fname})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Middle Name"}),e.jsx("input",{type:"text",className:"form-control",...s.getFieldProps("mname")})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Last Name"}),e.jsx("input",{type:"text",className:f("form-control",{"is-invalid":s.touched.lname&&s.errors.lname}),...s.getFieldProps("lname")}),s.touched.lname&&typeof s.errors.lname=="string"&&e.jsx("div",{className:"invalid-feedback",children:s.errors.lname})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Suffix"}),e.jsx("input",{type:"text",className:"form-control",...s.getFieldProps("suffix")})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Gender"}),e.jsxs("select",{className:f("form-select",{"is-invalid":s.touched.gender&&s.errors.gender}),...s.getFieldProps("gender"),children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"M",children:"Male"}),e.jsx("option",{value:"F",children:"Female"})]}),s.touched.gender&&typeof s.errors.gender=="string"&&e.jsx("div",{className:"invalid-feedback",children:s.errors.gender})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Birthdate"}),e.jsx("input",{type:"date",className:f("form-control",{"is-invalid":s.touched.birthdate&&s.errors.birthdate}),...s.getFieldProps("birthdate")}),s.touched.birthdate&&typeof s.errors.birthdate=="string"&&e.jsx("div",{className:"invalid-feedback",children:s.errors.birthdate})]}),e.jsx(J,{setClass:"col-md-12 mb-3",labelName:"Contact Number",name:"contact_no",data:s.values.contact_no,setFieldValue:s.setFieldValue,error:s.errors.contact_no,touched:!!s.touched.contact_no}),e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label",children:"Email Address"}),e.jsx("input",{type:"email",className:f("form-control",{"is-invalid":s.touched.email&&s.errors.email}),...s.getFieldProps("email")}),s.touched.email&&typeof s.errors.email=="string"&&e.jsx("div",{className:"invalid-feedback",children:s.errors.email})]}),e.jsxs("div",{className:"col-md-12 mb-5",children:[e.jsx("label",{className:"form-label",children:"Address"}),e.jsx("textarea",{rows:3,className:f("form-control"),...s.getFieldProps("address")})]})]}),e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("div",{children:e.jsx("label",{className:"form-label fw-bold me-5",children:"Modules"})}),e.jsxs("div",{className:"form-check form-check-inline",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"module-cashier",value:"cashier",checked:s.values.modules.includes("cashier"),onChange:()=>{const t=[...s.values.modules];t.includes("cashier")?s.setFieldValue("modules",t.filter(n=>n!=="cashier")):(t.push("cashier"),s.setFieldValue("modules",t))}}),e.jsx("label",{className:"form-check-label",htmlFor:"module-cashier",children:"Cashier"}),e.jsx("div",{className:"form-text",children:"Grants access to the cashier portal for handling transactions."})]}),e.jsxs("div",{className:"form-check form-check-inline",children:[e.jsx("input",{className:"form-check-input mb-10",type:"checkbox",id:"module-core",value:"core",checked:s.values.modules.includes("core"),onChange:()=>{const t=[...s.values.modules];t.includes("core")?s.setFieldValue("modules",t.filter(n=>n!=="core")):(t.push("core"),s.setFieldValue("modules",t))}}),e.jsx("label",{className:"form-check-label",htmlFor:"module-core",children:"Core"}),e.jsx("div",{className:"form-text",children:"Grants access to core system features. Selecting this will enable Role selection."})]}),s.touched.modules&&s.errors.modules&&e.jsx("div",{className:"text-danger small",children:s.errors.modules})]}),s.values.modules.includes("core")&&e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx(Q,{setClass:"mb-3",name:"role_id",value:s.values.role_id,onChange:s.handleChange,onBlur:s.handleBlur,error:s.errors.role_id&&typeof s.errors.role_id=="string"?s.errors.role_id:void 0,touched:!!s.touched.role_id}),s.touched.role_id&&typeof s.errors.role_id=="string"&&e.jsx("div",{className:"invalid-feedback",children:s.errors.role_id})]})]}),e.jsx("div",{className:"d-flex justify-content-end mt-4",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Submit"})})]})})},le=({data:i})=>{const{personal_info:a,user:v,modules:o,role_name:x}=i;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex align-items-center mb-4",children:[e.jsx("img",{src:a.image_cover||"/placeholder-profile.png",alt:"Profile",className:"rounded-circle me-3",style:{width:80,height:80,objectFit:"cover"}}),e.jsxs("div",{children:[e.jsx("h5",{className:"mb-0",children:a.full_name}),e.jsx("small",{className:"text-muted",children:x??"Cashier"})]})]}),e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-sm-4 text-muted",children:"Email"}),e.jsx("div",{className:"col-sm-8 fw-semibold",children:v.email})]}),e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-sm-4 text-muted",children:"Contact No"}),e.jsx("div",{className:"col-sm-8 fw-semibold",children:a.contact_no})]}),e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-sm-4 text-muted",children:"Birthdate"}),e.jsx("div",{className:"col-sm-8 fw-semibold",children:a.birth_date_format})]}),e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-sm-4 text-muted",children:"Gender"}),e.jsx("div",{className:"col-sm-8 fw-semibold",children:a.gender==="M"?"Male":"Female"})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-sm-4 text-muted",children:"Address"}),e.jsx("div",{className:"col-sm-8 fw-semibold",children:a.address})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-sm-4 text-muted",children:"Cashier"}),e.jsx("div",{className:"col-sm-8",children:o.length?e.jsx(C,{iconName:"check-circle",className:"fs-2 text-success"}):e.jsx("span",{className:"text-muted",children:"None"})})]})]})},te=({data:i,loading:a,pagination:v,sortColumn:o,sortDirection:x,onPageChange:p,onSortChange:r,onRestore:u,onSearchChange:h,setRefreshTable:s,setRefreshFirstTable:t})=>{const{currentUser:n}=_(),m=n==null?void 0:n.permissions,c=[{title:"#",key:"row_number",sortable:!0},{title:"User",key:"image_cover",render:l=>e.jsx(S,{image:l.image_cover??T("media/products/default.jpg"),mainTitle:l.full_name,subTitle:l.account_no})},{title:"Contact Info",key:"email",sortable:!0,render:l=>e.jsx(S,{mainTitle:l.user.email,subTitle:l.contant_no??"No Mobile Number Available"})},{title:"Gender",key:"gender_text_format",sortable:!0},{title:"Birth Date",key:"birth_date_format",sortable:!0},{title:"Action",key:"id_encrypted",render:l=>e.jsx(M,{restoreAction:m.includes("restore_product_brand")?()=>u(l.id_encrypted,s,t):void 0})}];return e.jsx("div",{className:"table-responsive",children:a?e.jsx("div",{className:"alert alert-info",children:"Loading..."}):e.jsx(q,{data:i,columns:c,loading:a,pagination:v,sortColumn:o,sortDirection:x,onPageChange:p,onSortChange:r,onSearchChange:h})})},ie=({onRefreshFirstTable:i})=>{const a=A("/core/user/archived/list"),{restoreUser:v}=D();return e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsx(te,{data:a.data,loading:a.loading,pagination:a.pagination,sortColumn:a.sortColumn,sortDirection:a.sortDirection,onPageChange:a.setPage,onSortChange:(o,x)=>{a.setSortColumn(o),a.setSortDirection(x)},onRestore:v,onSearchChange:o=>{a.setPage(1),a.setSearch(o)},setRefreshTable:a.setRefreshTable,setRefreshFirstTable:i})})})},ne=({data:i,loading:a,pagination:v,sortColumn:o,sortDirection:x,onPageChange:p,onSortChange:r,onEdit:u,onView:h,onArchive:s,onResetPassword:t,onSearchChange:n,setRefreshTable:m})=>{const{currentUser:c}=_(),l=c==null?void 0:c.permissions,d=[{title:"#",key:"row_number",sortable:!0},{title:"User",key:"image_cover",render:b=>e.jsx(S,{image:b.image_cover??T("media/products/default.jpg"),mainTitle:b.full_name,subTitle:b.account_no})},{title:"Contact Info",key:"email",sortable:!0,render:b=>e.jsx(S,{mainTitle:b.user.email,subTitle:b.contant_no??"No Mobile Number Available"})},{title:"Gender",key:"gender_text_format",sortable:!0},{title:"Birth Date",key:"birth_date_format",sortable:!0},{title:"Action",key:"id_encrypted",render:b=>e.jsx(M,{openDetailsModal:l.includes("view_user_account_details")?()=>h(b.id_encrypted):void 0,openEditModal:l.includes("update_user_account")?()=>u(b.id_encrypted):void 0,archiveAction:l.includes("archived_user_account")?()=>s(b.id_encrypted,m):void 0,resetAction:l.includes("reset_user_account")?()=>t(b.id_encrypted,m):void 0})}];return e.jsx("div",{className:"table-responsive",children:a?e.jsx("div",{className:"alert alert-info",children:"Loading..."}):e.jsx(q,{data:i,columns:d,loading:a,pagination:v,sortColumn:o,sortDirection:x,onPageChange:p,onSortChange:r,onSearchChange:n})})},ce=({title:i})=>{const{currentUser:a}=_(),v=a==null?void 0:a.permissions,o=A("/core/user/list"),{viewUserDetails:x,archivedUser:p,resetPasswordUser:r}=D(),[u,h]=w.useState({visible:!1,title:"",body:e.jsx(e.Fragment,{}),className:"modal-xl",alignment:"centered"}),s=()=>{h({visible:!0,title:`Create ${i}`,body:e.jsx(ae,{setPage:o.setPage,setRefreshTable:o.setRefreshTable}),className:"modal-xl",alignment:"centered"})},t=async c=>{const l=await x(c);l&&h({visible:!0,title:`Edit ${i}`,body:e.jsx(re,{userID:c,data:l,setRefreshTable:o.setRefreshTable}),className:"modal-xl",alignment:"centered"})},n=async c=>{const l=await x(c);l&&h({visible:!0,title:`View ${i} Details`,body:e.jsx(le,{data:l}),className:"modal-md",alignment:"centered"})},m=async()=>{h({visible:!0,title:"Archived",body:e.jsx(ie,{onRefreshFirstTable:o.setRefreshTable}),className:"modal-xl",alignment:"centered"})};return e.jsx(e.Fragment,{children:e.jsxs(Y,{children:[e.jsxs("div",{className:"card mb-5 mb-xl-8",children:[e.jsxs("div",{className:"card-header border-0 pt-5",children:[e.jsx("h3",{className:"card-title align-items-start flex-column",children:e.jsxs("span",{className:"card-label fw-bold fs-3 mb-1",children:[i,"s"]})}),e.jsxs("div",{className:"card-toolbar","data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-trigger":"hover",title:`Click to add a ${i.toLowerCase()}`,children:[v.includes("archived_product")&&e.jsxs("button",{onClick:()=>m(),className:"btn btn-sm btn-light-danger me-3",children:[e.jsx(C,{iconName:"delete-files",className:"fs-3"}),"Archived"]}),v.includes("create_product")&&e.jsxs("button",{onClick:()=>s(),className:"btn btn-sm btn-light-primary",children:[e.jsx(C,{iconName:"plus",className:"fs-3"}),"New ",i]})]})]}),e.jsx("div",{className:"card-body py-3",children:e.jsx("div",{className:"table-responsive",children:e.jsx(ne,{data:o.data,loading:o.loading,pagination:o.pagination,sortColumn:o.sortColumn,sortDirection:o.sortDirection,onPageChange:o.setPage,onSortChange:(c,l)=>{o.setSortColumn(c),o.setSortDirection(l)},onEdit:t,onView:n,onArchive:p,onResetPassword:r,onSearchChange:c=>{o.setPage(1),o.setSearch(c)},setRefreshTable:o.setRefreshTable})})})]}),u.visible&&e.jsx(O,{title:u.title,body:u.body,modalClass:u.className,alignment:u.alignment,onClose:()=>h({visible:!1,title:"",body:e.jsx(e.Fragment,{}),className:"",alignment:"center"})})]})})},U=()=>{const{showLoader:i,hideLoader:a}=E();return{viewRoleDetails:async u=>{var h,s;try{return i(),(await y.get(`/core/role/${u}/edit`)).data}catch(t){return j.fire({icon:"error",title:(s=(h=t==null?void 0:t.response)==null?void 0:h.data)==null?void 0:s.message}),null}finally{a()}},createRole:async(u,h,s,t)=>{var n,m,c,l,d;try{i();const b=await R.post("/core/role/store",u);j.fire({icon:(n=b.data)==null?void 0:n.status,title:(m=b.data)==null?void 0:m.message}),((c=b.data)==null?void 0:c.status)=="success"&&(h(),s==null||s(!0),t==null||t(1))}catch(b){j.fire({icon:"error",title:(d=(l=b==null?void 0:b.response)==null?void 0:l.data)==null?void 0:d.message})}finally{a()}},updateRole:async(u,h,s)=>{var t,n,m,c;try{i();const l=await y.put(`/core/role/${h}/update`,u);j.fire({icon:(t=l.data)==null?void 0:t.status,title:(n=l.data)==null?void 0:n.message}),s==null||s(!0)}catch(l){console.log(l),j.fire({icon:"error",title:(c=(m=l==null?void 0:l.response)==null?void 0:m.data)==null?void 0:c.message})}finally{a()}},archivedRole:async(u,h)=>{var t,n,m,c;if((await j.fire({title:"Are you sure?",text:"This action will archive the role.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, archive it!"})).isConfirmed)try{i();const l=await y.delete(`/core/role/${u}/archive`);j.fire({icon:((t=l.data)==null?void 0:t.status)||"success",title:(n=l.data)==null?void 0:n.message}),h==null||h(!0)}catch(l){j.fire({icon:"error",title:((c=(m=l==null?void 0:l.response)==null?void 0:m.data)==null?void 0:c.message)||"An error occurred."})}finally{a()}},restoreRole:async(u,h,s)=>{var n,m,c,l;if((await j.fire({title:"Are you sure?",text:"This will restore the archived role.",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, restore it!"})).isConfirmed)try{i();const d=await y.post(`/core/role/${u}/restore`);j.fire({icon:((n=d.data)==null?void 0:n.status)||"success",title:((m=d.data)==null?void 0:m.message)||"Role restored successfully."}),h==null||h(!0),s==null||s(!0)}catch(d){j.fire({icon:"error",title:((l=(c=d==null?void 0:d.response)==null?void 0:c.data)==null?void 0:l.message)||"Something went wrong."})}finally{a()}}}};async function oe(){try{const a=(await y.get("/core/permissions")).data;return Array.isArray(a)?a:(console.warn("Unexpected response shape:",a),[])}catch(i){return console.error("Failed to fetch categories:",i),[]}}const W=({selected:i,onChange:a})=>{const[v,o]=w.useState([]),[x,p]=w.useState({}),[r,u]=w.useState({});w.useEffect(()=>{oe().then(t=>{const n=t.map(l=>({id:l.id,label:l.name,permissions:l.permissions||[]}));o(n);const m={},c={};n.forEach(l=>{const d=l.permissions.find(b=>b.name.toLowerCase()==="view list");if(d){const b=l.permissions.filter(g=>g.id!==d.id).map(g=>g.id);m[d.id]=b,b.forEach(g=>{c[g]=d.id})}}),p(m),u(c)}).catch(console.error)},[]);const h=t=>{let n=[...i];n.includes(t)?(n=n.filter(m=>m!==t),x[t]&&(n=n.filter(m=>!x[t].includes(m)))):(n.push(t),r[t]&&n.push(r[t])),a([...new Set(n)])},s=t=>{const n=t.map(c=>c.id);if(n.every(c=>i.includes(c))){const c=new Set;n.forEach(d=>{c.add(d),x[d]&&x[d].forEach(b=>c.add(b))});const l=i.filter(d=>!c.has(d));a(l)}else{const c=[...new Set([...i,...n])];a(c)}};return e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Permissions"}),e.jsx("div",{className:"row",children:v.map(t=>{const n=t.permissions.map(l=>l.id),m=n.every(l=>i.includes(l)),c=n.some(l=>i.includes(l));return e.jsx("div",{className:"col-md-4 mb-3",children:e.jsxs("div",{className:"card shadow p-3 h-100",children:[e.jsxs("div",{className:"form-check mb-5",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:`group-${t.id}`,checked:m,ref:l=>{l&&(l.indeterminate=!m&&c)},onChange:()=>s(t.permissions)}),e.jsx("label",{className:"form-check-label fw-bold",htmlFor:`group-${t.id}`,children:t.label})]}),t.permissions.map(l=>e.jsxs("div",{className:"form-check ms-8 mb-4",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:`perm-${l.id}`,checked:i.includes(l.id),onChange:()=>h(l.id)}),e.jsx("label",{className:"form-check-label",htmlFor:`perm-${l.id}`,children:l.name})]},l.id))]})},t.id)})})]})},de=P().shape({name:N().min(1,"Minimum 1 character").max(50,"Maximum 50 characters").required("Role name is required"),permissions:F().of(H()).min(1,"At least 1 permission is required")}),me=({setPage:i,setRefreshTable:a,onSubmit:v})=>{const{createRole:o}=U(),x=K({initialValues:{name:"",permissions:[]},validationSchema:de,onSubmit:async(p,{resetForm:r})=>{await o(p,r,a,i),v==null||v(p)}});return e.jsxs("form",{className:"form",noValidate:!0,onSubmit:x.handleSubmit,children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label",children:"Role Name"}),e.jsx("input",{type:"text",className:f("form-control",{"is-invalid":x.touched.name&&x.errors.name}),...x.getFieldProps("name")}),x.touched.name&&x.errors.name&&e.jsx("div",{className:"invalid-feedback",children:x.errors.name})]}),e.jsxs("div",{className:"col-md-12",children:[e.jsx(W,{selected:x.values.permissions,onChange:p=>x.setFieldValue("permissions",p)}),x.touched.permissions&&x.errors.permissions&&e.jsx("div",{className:"text-danger small",children:x.errors.permissions})]})]}),e.jsx("div",{className:"d-flex justify-content-end mt-4",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Save"})})]})},ue=P().shape({name:N().min(1,"Minimum 1 character").max(50,"Maximum 50 characters").required("Role name is required"),permissions:F().of(H()).min(1,"At least 1 permission is required")}),he=({roleID:i,data:a,setRefreshTable:v,onSubmit:o})=>{var r;const{updateRole:x}=U(),p=K({initialValues:{name:a.name,permissions:((r=a==null?void 0:a.permissions)==null?void 0:r.flatMap(u=>u.permissions.map(h=>h.id)))||[]},validationSchema:ue,onSubmit:async(u,{resetForm:h})=>{await await x(u,i,v),o==null||o(u)}});return e.jsxs("form",{className:"form",noValidate:!0,onSubmit:p.handleSubmit,children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label",children:"Role Name"}),e.jsx("input",{type:"text",className:f("form-control",{"is-invalid":p.touched.name&&p.errors.name}),...p.getFieldProps("name")}),p.touched.name&&typeof p.errors.name=="string"&&e.jsx("div",{className:"invalid-feedback",children:p.errors.name})]}),e.jsxs("div",{className:"col-md-12",children:[e.jsx(W,{selected:p.values.permissions,onChange:u=>p.setFieldValue("permissions",u)}),p.touched.permissions&&p.errors.permissions&&e.jsx("div",{className:"text-danger small",children:p.errors.permissions})]})]}),e.jsx("div",{className:"d-flex justify-content-end mt-4",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Save"})})]})},xe=({data:i})=>e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"",children:["Role Name: ",e.jsx("span",{className:"fw-semibold fs-4",children:i.name})]})}),e.jsxs("div",{children:[e.jsx("h6",{className:"text-muted mb-3",children:"Permissions"}),e.jsxs("div",{className:"row g-3",children:[i.permissions.map(a=>e.jsx("div",{className:"col-md-6 col-lg-4",children:e.jsx("div",{className:"card shadow h-100 border-0",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h6",{className:"fw-bold mb-3",children:a.name}),e.jsx("div",{className:"d-flex flex-wrap gap-2",children:a.permissions.map(v=>e.jsx("span",{className:"badge bg-primary bg-opacity-75 text-white rounded-pill px-3 py-2",children:v.name},v.id))})]})})},a.id)),i.permissions.length===0&&e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"alert alert-secondary mb-0",children:"No permissions assigned to this role."})})]})]})]}),pe=({data:i,loading:a,pagination:v,sortColumn:o,sortDirection:x,onPageChange:p,onSortChange:r,onRestore:u,onSearchChange:h,setRefreshTable:s,setRefreshFirstTable:t})=>{const{currentUser:n}=_(),m=n==null?void 0:n.permissions,c=[{title:"#",key:"row_number",sortable:!0},{title:"Name",key:"name",sortable:!0},{title:"Permissions",key:"permissionParents",render:l=>!l.permissionParents||l.permissionParents.length===0?e.jsx("span",{className:"text-muted",children:"No permissions"}):e.jsx("div",{className:"d-flex flex-wrap gap-1",children:l.permissionParents.map((d,b)=>e.jsx("span",{className:"badge bg-primary",children:d.name},b))})},{title:"Action",key:"id_encrypted",render:l=>e.jsx(M,{restoreAction:m.includes("restore_role")?()=>u(l.id_encrypted,s,t):void 0})}];return e.jsx("div",{className:"table-responsive",children:a?e.jsx("div",{className:"alert alert-info",children:"Loading..."}):e.jsx(q,{data:i,columns:c,loading:a,pagination:v,sortColumn:o,sortDirection:x,onPageChange:p,onSortChange:r,onSearchChange:h})})},ve=({onRefreshFirstTable:i})=>{const a=A("/core/role/archived/list"),{restoreRole:v}=U();return e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsx(pe,{data:a.data,loading:a.loading,pagination:a.pagination,sortColumn:a.sortColumn,sortDirection:a.sortDirection,onPageChange:a.setPage,onSortChange:(o,x)=>{a.setSortColumn(o),a.setSortDirection(x)},onRestore:v,onSearchChange:o=>{a.setPage(1),a.setSearch(o)},setRefreshTable:a.setRefreshTable,setRefreshFirstTable:i})})})},be=({data:i,loading:a,pagination:v,sortColumn:o,sortDirection:x,onPageChange:p,onSortChange:r,onEdit:u,onView:h,onArchive:s,onSearchChange:t,setRefreshTable:n})=>{const{currentUser:m}=_(),c=m==null?void 0:m.permissions,l=[{title:"#",key:"row_number",sortable:!0},{title:"Name",key:"name",sortable:!0},{title:"Permissions",key:"permissionParents",render:d=>!d.permissionParents||d.permissionParents.length===0?e.jsx("span",{className:"text-muted",children:"No permissions"}):e.jsx("div",{className:"d-flex flex-wrap gap-1",children:d.permissionParents.map((b,g)=>e.jsx("span",{className:"badge bg-primary",children:b.name},g))})},{title:"Action",key:"id_encrypted",render:d=>e.jsx(M,{openDetailsModal:c.includes("view_role_details")?()=>h(d.id_encrypted):void 0,openEditModal:c.includes("update_role")?()=>u(d.id_encrypted):void 0,archiveAction:c.includes("archived_role")?()=>s(d.id_encrypted,n):void 0})}];return e.jsx("div",{className:"table-responsive",children:a?e.jsx("div",{className:"alert alert-info",children:"Loading..."}):e.jsx(q,{data:i,columns:l,loading:a,pagination:v,sortColumn:o,sortDirection:x,onPageChange:p,onSortChange:r,onSearchChange:t})})},je=({title:i})=>{const{currentUser:a}=_(),v=a==null?void 0:a.permissions,o=A("/core/role/list"),{viewRoleDetails:x,archivedRole:p}=U(),[r,u]=w.useState({visible:!1,title:"",body:e.jsx(e.Fragment,{}),className:"modal-xl",alignment:"centered"}),h=()=>{u({visible:!0,title:`Create ${i}`,body:e.jsx(me,{setPage:o.setPage,setRefreshTable:o.setRefreshTable}),className:"modal-xl",alignment:"centered"})},s=async m=>{const c=await x(m);c&&u({visible:!0,title:`Edit ${i}`,body:e.jsx(he,{roleID:m,data:c,setRefreshTable:o.setRefreshTable}),className:"modal-xl",alignment:"centered"})},t=async m=>{const c=await x(m);c&&u({visible:!0,title:`View ${i} Details`,body:e.jsx(xe,{data:c}),className:"modal-xl",alignment:"centered"})},n=async()=>{u({visible:!0,title:"Archived",body:e.jsx(ve,{onRefreshFirstTable:o.setRefreshTable}),className:"modal-xl",alignment:"centered"})};return e.jsx(e.Fragment,{children:e.jsxs(Y,{children:[e.jsxs("div",{className:"card mb-5 mb-xl-8",children:[e.jsxs("div",{className:"card-header border-0 pt-5",children:[e.jsx("h3",{className:"card-title align-items-start flex-column",children:e.jsxs("span",{className:"card-label fw-bold fs-3 mb-1",children:[i,"s"]})}),e.jsxs("div",{className:"card-toolbar","data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-trigger":"hover",title:`Click to add a ${i.toLowerCase()}`,children:[v.includes("archived_role")&&e.jsxs("button",{onClick:()=>n(),className:"btn btn-sm btn-light-danger me-3",children:[e.jsx(C,{iconName:"delete-files",className:"fs-3"}),"Archived"]}),v.includes("create_role")&&e.jsxs("button",{onClick:()=>h(),className:"btn btn-sm btn-light-primary",children:[e.jsx(C,{iconName:"plus",className:"fs-3"}),"New ",i]})]})]}),e.jsx("div",{className:"card-body py-3",children:e.jsx("div",{className:"table-responsive",children:e.jsx(be,{data:o.data,loading:o.loading,pagination:o.pagination,sortColumn:o.sortColumn,sortDirection:o.sortDirection,onPageChange:o.setPage,onSortChange:(m,c)=>{o.setSortColumn(m),o.setSortDirection(c)},onEdit:s,onView:t,onArchive:p,onSearchChange:m=>{o.setPage(1),o.setSearch(m)},setRefreshTable:o.setRefreshTable})})})]}),r.visible&&e.jsx(O,{title:r.title,body:r.body,modalClass:r.className,alignment:r.alignment,onClose:()=>u({visible:!1,title:"",body:e.jsx(e.Fragment,{}),className:"",alignment:"center"})})]})})},V=[{title:"Account",path:"/account-management",isSeparator:!1,isActive:!1},{title:"",path:"",isSeparator:!0,isActive:!1}],Pe=()=>e.jsx(X,{children:e.jsxs(B,{element:e.jsx(Z,{}),children:[e.jsx(B,{path:"/user/list",element:e.jsxs(e.Fragment,{children:[e.jsx($,{breadcrumbs:V,children:"Users"}),e.jsx(ce,{title:"User"})]})}),e.jsx(B,{path:"/role/list",element:e.jsxs(e.Fragment,{children:[e.jsx($,{breadcrumbs:V,children:"Roles"}),e.jsx(je,{title:"Role"})]})})]})});export{Pe as default};
