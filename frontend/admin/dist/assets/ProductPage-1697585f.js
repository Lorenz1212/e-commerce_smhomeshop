import{a as fs,j as e,t as ys,b as et,c as ye,S as H,r as d,i as F,p as fe,y as gs,q as st,s as Is,d as U,e as T,o as I,l as Te,m as is,F as Ls,n as Ds,C as tt,K as Es,P as rt}from"./index-47a86244.js";import{M as at}from"./ModalHandler-ad0ee9b4.js";import{D as Vs,A as zs}from"./ActionsCell-25d0eec8.js";import{I as Ms,L as nt}from"./ImageTitleCell-2b5fa3f1.js";import{S as Ks}from"./StatusCell-8960e5cb.js";import{C as ie}from"./CurrencyText-dfd7429e.js";import{a as Cs}from"./apiMultipart-5aee4e22.js";import{S as xs,a as lt,b as it,c as qs,o as ot,f as ct,s as dt}from"./react-select.esm-840b2ab4.js";import{M as Us}from"./MulitpleImageUploader-3f05f02e.js";const ut=({data:s,loading:r,pagination:l,sortColumn:h,sortDirection:v,onPageChange:o,onSortChange:m,onEdit:u,onView:f,onArchive:g,onSearchChange:x,setRefreshTable:a})=>{const{currentUser:n}=fs(),p=n==null?void 0:n.permissions,t=[{title:"#",key:"row_number",sortable:!0},{title:"Items",key:"image_cover",render:i=>{var c;return e.jsx(Ms,{image:((c=i.primary_image)==null?void 0:c.image_cover)??ys("media/products/default.jpg"),mainTitle:i.name,subTitle:i.sku})}},{title:"QTY on hand",key:"quantity_on_hand",sortable:!0,render:i=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"d-flex flex-column align-items-start",children:[e.jsxs("span",{className:"mb-2",children:["QTY: ",i.quantity_on_hand]}),e.jsx(Ks,{color:i.stock_status.color,title:i.stock_status.title})]})})},{title:"Price",key:"cost_price",sortable:!0,render:i=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"d-flex flex-column align-items-start",children:[e.jsxs("span",{className:"mb-2",children:["Cost: ",e.jsx(ie,{value:i.cost_price||0})]}),e.jsxs("span",{className:"mb-2",children:["Selling: ",e.jsx(ie,{value:i.selling_price||0})]})]})})},{title:"Variants",key:"variants",render:i=>e.jsx("div",{className:"d-flex flex-column gap-1",children:i.variants&&i.variants.length>0?i.variants.map((c,y)=>e.jsxs("div",{className:"border rounded p-2 bg-light",children:[e.jsxs("div",{className:"fw-semibold small",children:["SKU: ",e.jsx("span",{className:"text-primary",children:c.sku})]}),e.jsxs("div",{className:"small",children:["Name: ",c.variant_name??"-"]}),e.jsxs("div",{className:"small",children:["Qty: ",e.jsx("span",{className:"fw-bold",children:c.quantity_on_hand??0})]})]},y)):e.jsx("span",{className:"text-muted small",children:"No variants"})})},{title:"Created At",key:"created_at_format",sortable:!0},{title:"Action",key:"id_encrypted",render:i=>e.jsx(zs,{openDetailsModal:p.includes("view_product_details")?()=>f(i.id_encrypted):void 0,openEditModal:p.includes("update_product")?()=>u(i.id_encrypted):void 0,archiveAction:p.includes("archived_product")?()=>g(i.id_encrypted,a):void 0})}];return e.jsx("div",{className:"table-responsive",children:r?e.jsx("div",{className:"alert alert-info",children:"Loading..."}):e.jsx(Vs,{data:s,columns:t,loading:r,pagination:l,sortColumn:h,sortDirection:v,onPageChange:o,onSortChange:m,onSearchChange:x})})},os=()=>{const{showLoader:s,hideLoader:r}=et();return{viewProductDetails:async u=>{var f,g;try{return s(),(await ye.get(`/admin/product/${u}/edit`)).data}catch(x){return H.fire({icon:"error",title:(g=(f=x==null?void 0:x.response)==null?void 0:f.data)==null?void 0:g.message}),null}finally{r()}},createProduct:async(u,f,g,x)=>{var a,n,p,t,i;try{s();const c=new FormData;["sku","name","description","brand_id","category_id","supplier_id","quantity_on_hand","reorder_point","cost_price","selling_price"].forEach(E=>c.append(E,u[E])),u.images.forEach(E=>{c.append("images[]",E)}),typeof u.primary_index<"u"&&c.append("primary_index",u.primary_index),u.addons.forEach((E,A)=>{c.append(`addons[${A}][id]`,E.id),c.append(`addons[${A}][base_price]`,E.base_price.toString()),c.append(`addons[${A}][custom_price]`,E.custom_price.toString())}),u.variants.forEach((E,A)=>{c.append(`variants[${A}][sku]`,E.sku.toString()),c.append(`variants[${A}][variant_name]`,E.variant_name.toString()),c.append(`variants[${A}][quantity_on_hand]`,E.quantity_on_hand.toString()),c.append(`variants[${A}][reorder_point]`,E.reorder_point.toString()),c.append(`variants[${A}][cost_price]`,E.cost_price.toString()),c.append(`variants[${A}][selling_price]`,E.selling_price.toString()),c.append(`variants[${A}][image]`,E.image)});const w=await Cs.post("/admin/product/store",c);H.fire({icon:(a=w.data)==null?void 0:a.status,title:(n=w.data)==null?void 0:n.message}),((p=w.data)==null?void 0:p.status)=="success"&&(f(),g==null||g(!0),x==null||x(1))}catch(c){H.fire({icon:"error",title:(i=(t=c==null?void 0:c.response)==null?void 0:t.data)==null?void 0:i.message})}finally{r()}},updateProduct:async(u,f,g)=>{var x,a,n,p;try{s();const t=new FormData;["sku","name","description","brand_id","category_id","supplier_id","add_new_stocks","reorder_point","cost_price","selling_price"].forEach(y=>t.append(y,u[y])),u.images.forEach(y=>{t.append("images[]",y)}),typeof u.primary_index<"u"&&t.append("primary_index",u.primary_index),u.addons.forEach((y,w)=>{t.append(`addons[${w}][id]`,y.id),t.append(`addons[${w}][base_price]`,y.base_price.toString()),t.append(`addons[${w}][custom_price]`,y.custom_price.toString())}),u.variants.forEach((y,w)=>{t.append(`variants[${w}][id]`,y.id),t.append(`variants[${w}][sku]`,y.sku.toString()),t.append(`variants[${w}][variant_name]`,y.variant_name.toString()),t.append(`variants[${w}][quantity_on_hand]`,y.quantity_on_hand.toString()),t.append(`variants[${w}][reorder_point]`,y.reorder_point.toString()),t.append(`variants[${w}][cost_price]`,y.cost_price.toString()),t.append(`variants[${w}][selling_price]`,y.selling_price.toString()),t.append(`variants[${w}][image]`,y.image)});const c=await Cs.post(`/admin/product/${f}/update`,t);H.fire({icon:(x=c.data)==null?void 0:x.status,title:(a=c.data)==null?void 0:a.message}),g==null||g(!0)}catch(t){H.fire({icon:"error",title:(p=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:p.message})}finally{r()}},archivedProduct:async(u,f)=>{var x,a,n,p;if((await H.fire({title:"Are you sure?",text:"This action will archive the item.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, archive it!"})).isConfirmed)try{s();const t=await ye.delete(`/admin/product/${u}/archive`);H.fire({icon:((x=t.data)==null?void 0:x.status)||"success",title:(a=t.data)==null?void 0:a.message}),f==null||f(!0)}catch(t){H.fire({icon:"error",title:((p=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:p.message)||"An error occurred."})}finally{r()}},restoreProduct:async(u,f,g)=>{var a,n,p,t;if((await H.fire({title:"Are you sure?",text:"This will restore the archived item.",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, restore it!"})).isConfirmed)try{s();const i=await ye.post(`/admin/product/${u}/restore`);H.fire({icon:((a=i.data)==null?void 0:a.status)||"success",title:((n=i.data)==null?void 0:n.message)||"Item restored successfully."}),f==null||f(!0),g==null||g(!0)}catch(i){H.fire({icon:"error",title:((t=(p=i==null?void 0:i.response)==null?void 0:p.data)==null?void 0:t.message)||"Something went wrong."})}finally{r()}}}};async function pt(){try{const r=(await ye.get("/category")).data;return Array.isArray(r)?r:(console.warn("Unexpected response shape:",r),[])}catch(s){return console.error("Failed to fetch categories:",s),[]}}const Ys=({setClass:s,name:r,value:l,onChange:h,onBlur:v,error:o,touched:m})=>{const[u,f]=d.useState([]);return d.useEffect(()=>{pt().then(g=>{const x=g.map(a=>({value:a.id,label:a.name}));f(x)}).catch(console.error)},[]),e.jsxs("div",{className:s,children:[e.jsx("label",{className:"form-label required",children:"Category"}),e.jsx(xs,{name:r,options:u,value:u.find(g=>g.value===l)||null,onChange:g=>h({target:{name:r,value:(g==null?void 0:g.value)||""}}),onBlur:v,className:F("form-select-solid text-dark",{"is-invalid":o&&m},{})}),o&&m&&e.jsx("div",{className:"invalid-feedback",children:o})]})};async function mt(){try{const r=(await ye.get("/supplier")).data;return Array.isArray(r)?r:(console.warn("Unexpected response shape:",r),[])}catch(s){return console.error("Failed to fetch categories:",s),[]}}const Qs=({setClass:s,name:r,value:l,onChange:h,onBlur:v,error:o,touched:m})=>{const[u,f]=d.useState([]);return d.useEffect(()=>{mt().then(g=>{const x=g.map(a=>({value:a.id,label:a.name}));f(x)}).catch(console.error)},[]),e.jsxs("div",{className:s,children:[e.jsx("label",{className:"form-label required",children:"Supplier"}),e.jsx(xs,{name:r,options:u,value:u.find(g=>g.value===l)||null,onChange:g=>h({target:{name:r,value:(g==null?void 0:g.value)||""}}),onBlur:v,className:F("form-select-solid text-dark",{"is-invalid":o&&m},{})}),o&&m&&e.jsx("div",{className:"invalid-feedback",children:o})]})};/*
* React Tooltip
* {@link https://github.com/ReactTooltip/react-tooltip}
* @copyright ReactTooltip Team
* @license MIT
*/const ht="react-tooltip-core-styles",bt="react-tooltip-base-styles",As={core:!1,base:!1};function Ps({css:s,id:r=bt,type:l="base",ref:h}){var v,o;if(!s||typeof document>"u"||As[l]||l==="core"&&typeof process<"u"&&(!((v=process==null?void 0:process.env)===null||v===void 0)&&v.REACT_TOOLTIP_DISABLE_CORE_STYLES)||l!=="base"&&typeof process<"u"&&(!((o=process==null?void 0:process.env)===null||o===void 0)&&o.REACT_TOOLTIP_DISABLE_BASE_STYLES))return;l==="core"&&(r=ht),h||(h={});const{insertAt:m}=h;if(document.getElementById(r))return;const u=document.head||document.getElementsByTagName("head")[0],f=document.createElement("style");f.id=r,f.type="text/css",m==="top"&&u.firstChild?u.insertBefore(f,u.firstChild):u.appendChild(f),f.styleSheet?f.styleSheet.cssText=s:f.appendChild(document.createTextNode(s)),As[l]=!0}const $s=async({elementReference:s=null,tooltipReference:r=null,tooltipArrowReference:l=null,place:h="top",offset:v=10,strategy:o="absolute",middlewares:m=[ot(Number(v)),ct({fallbackAxisSideDirection:"start"}),dt({padding:5})],border:u,arrowSize:f=8})=>{if(!s)return{tooltipStyles:{},tooltipArrowStyles:{},place:h};if(r===null)return{tooltipStyles:{},tooltipArrowStyles:{},place:h};const g=m;return l?(g.push(it({element:l,padding:5})),qs(s,r,{placement:h,strategy:o,middleware:g}).then(({x,y:a,placement:n,middlewareData:p})=>{var t,i;const c={left:`${x}px`,top:`${a}px`,border:u},{x:y,y:w}=(t=p.arrow)!==null&&t!==void 0?t:{x:0,y:0},E=(i={top:"bottom",right:"left",bottom:"top",left:"right"}[n.split("-")[0]])!==null&&i!==void 0?i:"bottom",A=u&&{borderBottom:u,borderRight:u};let B=0;if(u){const R=`${u}`.match(/(\d+)px/);B=R!=null&&R[1]?Number(R[1]):1}return{tooltipStyles:c,tooltipArrowStyles:{left:y!=null?`${y}px`:"",top:w!=null?`${w}px`:"",right:"",bottom:"",...A,[E]:`-${f/2+B}px`},place:n}})):qs(s,r,{placement:"bottom",strategy:o,middleware:g}).then(({x,y:a,placement:n})=>({tooltipStyles:{left:`${x}px`,top:`${a}px`},tooltipArrowStyles:{},place:n}))},Fs=(s,r)=>!("CSS"in window&&"supports"in window.CSS)||window.CSS.supports(s,r),Bs=(s,r,l)=>{let h=null;const v=function(...o){const m=()=>{h=null,l||s.apply(this,o)};l&&!h&&(s.apply(this,o),h=setTimeout(m,r)),l||(h&&clearTimeout(h),h=setTimeout(m,r))};return v.cancel=()=>{h&&(clearTimeout(h),h=null)},v},Ts=s=>s!==null&&!Array.isArray(s)&&typeof s=="object",vs=(s,r)=>{if(s===r)return!0;if(Array.isArray(s)&&Array.isArray(r))return s.length===r.length&&s.every((v,o)=>vs(v,r[o]));if(Array.isArray(s)!==Array.isArray(r))return!1;if(!Ts(s)||!Ts(r))return s===r;const l=Object.keys(s),h=Object.keys(r);return l.length===h.length&&l.every(v=>vs(s[v],r[v]))},gt=s=>{if(!(s instanceof HTMLElement||s instanceof SVGElement))return!1;const r=getComputedStyle(s);return["overflow","overflow-x","overflow-y"].some(l=>{const h=r.getPropertyValue(l);return h==="auto"||h==="scroll"})},Rs=s=>{if(!s)return null;let r=s.parentElement;for(;r;){if(gt(r))return r;r=r.parentElement}return document.scrollingElement||document.documentElement},vt=typeof window<"u"?d.useLayoutEffect:d.useEffect,Z=s=>{s.current&&(clearTimeout(s.current),s.current=null)},ft="DEFAULT_TOOLTIP_ID",yt={anchorRefs:new Set,activeAnchor:{current:null},attach:()=>{},detach:()=>{},setActiveAnchor:()=>{}},xt=d.createContext({getTooltipData:()=>yt});function Gs(s=ft){return d.useContext(xt).getTooltipData(s)}var Be={tooltip:"core-styles-module_tooltip__3vRRp",fixed:"core-styles-module_fixed__pcSol",arrow:"core-styles-module_arrow__cvMwQ",noArrow:"core-styles-module_noArrow__xock6",clickable:"core-styles-module_clickable__ZuTTB",show:"core-styles-module_show__Nt9eE",closing:"core-styles-module_closing__sGnxF"},hs={tooltip:"styles-module_tooltip__mnnfp",arrow:"styles-module_arrow__K0L3T",dark:"styles-module_dark__xNqje",light:"styles-module_light__Z6W-X",success:"styles-module_success__A2AKt",warning:"styles-module_warning__SCK0X",error:"styles-module_error__JvumD",info:"styles-module_info__BWdHW"};const _t=({forwardRef:s,id:r,className:l,classNameArrow:h,variant:v="dark",anchorId:o,anchorSelect:m,place:u="top",offset:f=10,events:g=["hover"],openOnClick:x=!1,positionStrategy:a="absolute",middlewares:n,wrapper:p,delayShow:t=0,delayHide:i=0,float:c=!1,hidden:y=!1,noArrow:w=!1,clickable:E=!1,closeOnEsc:A=!1,closeOnScroll:B=!1,closeOnResize:R=!1,openEvents:q,closeEvents:L,globalCloseEvents:te,imperativeModeOnly:Re,style:We,position:Xe,afterShow:Ze,afterHide:re,disableTooltip:xe,content:Oe,contentWrapperRef:ue,isOpen:k,defaultIsOpen:_e=!1,setIsOpen:pe,activeAnchor:D,setActiveAnchor:je,border:He,opacity:ke,arrowColor:es,arrowSize:Ne=8,role:cs="tooltip"})=>{var Ie;const Y=d.useRef(null),we=d.useRef(null),ee=d.useRef(null),oe=d.useRef(null),Le=d.useRef(null),[ce,ds]=d.useState({tooltipStyles:{},tooltipArrowStyles:{},place:u}),[G,ss]=d.useState(!1),[me,he]=d.useState(!1),[$,De]=d.useState(null),Ve=d.useRef(!1),ze=d.useRef(null),{anchorRefs:Me,setActiveAnchor:ts}=Gs(r),Se=d.useRef(!1),[de,Ke]=d.useState([]),be=d.useRef(!1),Ee=x||g.includes("click"),us=Ee||(q==null?void 0:q.click)||(q==null?void 0:q.dblclick)||(q==null?void 0:q.mousedown),Ce=q?{...q}:{mouseover:!0,focus:!0,mouseenter:!1,click:!1,dblclick:!1,mousedown:!1};!q&&Ee&&Object.assign(Ce,{mouseenter:!1,focus:!1,mouseover:!1,click:!0});const ge=L?{...L}:{mouseout:!0,blur:!0,mouseleave:!1,click:!1,dblclick:!1,mouseup:!1};!L&&Ee&&Object.assign(ge,{mouseleave:!1,blur:!1,mouseout:!1});const se=te?{...te}:{escape:A||!1,scroll:B||!1,resize:R||!1,clickOutsideAnchor:us||!1};Re&&(Object.assign(Ce,{mouseover:!1,focus:!1,mouseenter:!1,click:!1,dblclick:!1,mousedown:!1}),Object.assign(ge,{mouseout:!1,blur:!1,mouseleave:!1,click:!1,dblclick:!1,mouseup:!1}),Object.assign(se,{escape:!1,scroll:!1,resize:!1,clickOutsideAnchor:!1})),vt(()=>(be.current=!0,()=>{be.current=!1}),[]);const O=b=>{be.current&&(b&&he(!0),setTimeout(()=>{be.current&&(pe==null||pe(b),k===void 0&&ss(b))},10))};d.useEffect(()=>{if(k===void 0)return()=>null;k&&he(!0);const b=setTimeout(()=>{ss(k)},10);return()=>{clearTimeout(b)}},[k]),d.useEffect(()=>{if(G!==Ve.current)if(Z(Le),Ve.current=G,G)Ze==null||Ze();else{const b=(j=>{const N=j.match(/^([\d.]+)(ms|s)$/);if(!N)return 0;const[,V,M]=N;return Number(V)*(M==="ms"?1:1e3)})(getComputedStyle(document.body).getPropertyValue("--rt-transition-show-delay"));Le.current=setTimeout(()=>{he(!1),De(null),re==null||re()},b+25)}},[G]);const rs=b=>{ds(j=>vs(j,b)?j:b)},Ue=(b=t)=>{Z(ee),me?O(!0):ee.current=setTimeout(()=>{O(!0)},b)},qe=(b=i)=>{Z(oe),oe.current=setTimeout(()=>{Se.current||O(!1)},b)},Ye=b=>{var j;if(!b)return;const N=(j=b.currentTarget)!==null&&j!==void 0?j:b.target;if(!(N!=null&&N.isConnected))return je(null),void ts({current:null});t?Ue():O(!0),je(N),ts({current:N}),Z(oe)},Ae=()=>{E?qe(i||100):i?qe():O(!1),Z(ee)},Pe=({x:b,y:j})=>{var N;const V={getBoundingClientRect:()=>({x:b,y:j,width:0,height:0,top:j,left:b,right:b,bottom:j})};$s({place:(N=$==null?void 0:$.place)!==null&&N!==void 0?N:u,offset:f,elementReference:V,tooltipReference:Y.current,tooltipArrowReference:we.current,strategy:a,middlewares:n,border:He,arrowSize:Ne}).then(M=>{rs(M)})},$e=b=>{if(!b)return;const j=b,N={x:j.clientX,y:j.clientY};Pe(N),ze.current=N},Qe=b=>{var j;if(!G)return;const N=b.target;N.isConnected&&(!((j=Y.current)===null||j===void 0)&&j.contains(N)||[document.querySelector(`[id='${o}']`),...de].some(V=>V==null?void 0:V.contains(N))||(O(!1),Z(ee)))},as=Bs(Ye,50,!0),z=Bs(Ae,50,!0),W=b=>{z.cancel(),as(b)},_=()=>{as.cancel(),z()},S=d.useCallback(()=>{var b,j;const N=(b=$==null?void 0:$.position)!==null&&b!==void 0?b:Xe;N?Pe(N):c?ze.current&&Pe(ze.current):D!=null&&D.isConnected&&$s({place:(j=$==null?void 0:$.place)!==null&&j!==void 0?j:u,offset:f,elementReference:D,tooltipReference:Y.current,tooltipArrowReference:we.current,strategy:a,middlewares:n,border:He,arrowSize:Ne}).then(V=>{be.current&&rs(V)})},[G,D,Oe,We,u,$==null?void 0:$.place,f,a,Xe,$==null?void 0:$.position,c,Ne]);d.useEffect(()=>{var b,j;const N=new Set(Me);de.forEach(C=>{xe!=null&&xe(C)||N.add({current:C})});const V=document.querySelector(`[id='${o}']`);V&&!(xe!=null&&xe(V))&&N.add({current:V});const M=()=>{O(!1)},ae=Rs(D),ne=Rs(Y.current);se.scroll&&(window.addEventListener("scroll",M),ae==null||ae.addEventListener("scroll",M),ne==null||ne.addEventListener("scroll",M));let Q=null;se.resize?window.addEventListener("resize",M):D&&Y.current&&(Q=lt(D,Y.current,S,{ancestorResize:!0,elementResize:!0,layoutShift:!0}));const X=C=>{C.key==="Escape"&&O(!1)};se.escape&&window.addEventListener("keydown",X),se.clickOutsideAnchor&&window.addEventListener("click",Qe);const P=[],Fe=C=>!!(C!=null&&C.target&&(D!=null&&D.contains(C.target))),Zs=C=>{G&&Fe(C)||Ye(C)},Hs=C=>{G&&Fe(C)&&Ae()},_s=["mouseover","mouseout","mouseenter","mouseleave","focus","blur"],js=["click","dblclick","mousedown","mouseup"];Object.entries(Ce).forEach(([C,le])=>{le&&(_s.includes(C)?P.push({event:C,listener:W}):js.includes(C)&&P.push({event:C,listener:Zs}))}),Object.entries(ge).forEach(([C,le])=>{le&&(_s.includes(C)?P.push({event:C,listener:_}):js.includes(C)&&P.push({event:C,listener:Hs}))}),c&&P.push({event:"pointermove",listener:$e});const Ns=()=>{Se.current=!0},ws=()=>{Se.current=!1,Ae()},Ss=E&&(ge.mouseout||ge.mouseleave);return Ss&&((b=Y.current)===null||b===void 0||b.addEventListener("mouseover",Ns),(j=Y.current)===null||j===void 0||j.addEventListener("mouseout",ws)),P.forEach(({event:C,listener:le})=>{N.forEach(ps=>{var Ge;(Ge=ps.current)===null||Ge===void 0||Ge.addEventListener(C,le)})}),()=>{var C,le;se.scroll&&(window.removeEventListener("scroll",M),ae==null||ae.removeEventListener("scroll",M),ne==null||ne.removeEventListener("scroll",M)),se.resize?window.removeEventListener("resize",M):Q==null||Q(),se.clickOutsideAnchor&&window.removeEventListener("click",Qe),se.escape&&window.removeEventListener("keydown",X),Ss&&((C=Y.current)===null||C===void 0||C.removeEventListener("mouseover",Ns),(le=Y.current)===null||le===void 0||le.removeEventListener("mouseout",ws)),P.forEach(({event:ps,listener:Ge})=>{N.forEach(ks=>{var ms;(ms=ks.current)===null||ms===void 0||ms.removeEventListener(ps,Ge)})})}},[D,S,me,Me,de,q,L,te,Ee,t,i]),d.useEffect(()=>{var b,j;let N=(j=(b=$==null?void 0:$.anchorSelect)!==null&&b!==void 0?b:m)!==null&&j!==void 0?j:"";!N&&r&&(N=`[data-tooltip-id='${r.replace(/'/g,"\\'")}']`);const V=new MutationObserver(M=>{const ae=[],ne=[];M.forEach(Q=>{if(Q.type==="attributes"&&Q.attributeName==="data-tooltip-id"&&(Q.target.getAttribute("data-tooltip-id")===r?ae.push(Q.target):Q.oldValue===r&&ne.push(Q.target)),Q.type==="childList"){if(D){const X=[...Q.removedNodes].filter(P=>P.nodeType===1);if(N)try{ne.push(...X.filter(P=>P.matches(N))),ne.push(...X.flatMap(P=>[...P.querySelectorAll(N)]))}catch{}X.some(P=>{var Fe;return!!(!((Fe=P==null?void 0:P.contains)===null||Fe===void 0)&&Fe.call(P,D))&&(he(!1),O(!1),je(null),Z(ee),Z(oe),!0)})}if(N)try{const X=[...Q.addedNodes].filter(P=>P.nodeType===1);ae.push(...X.filter(P=>P.matches(N))),ae.push(...X.flatMap(P=>[...P.querySelectorAll(N)]))}catch{}}}),(ae.length||ne.length)&&Ke(Q=>[...Q.filter(X=>!ne.includes(X)),...ae])});return V.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["data-tooltip-id"],attributeOldValue:!0}),()=>{V.disconnect()}},[r,m,$==null?void 0:$.anchorSelect,D]),d.useEffect(()=>{S()},[S]),d.useEffect(()=>{if(!(ue!=null&&ue.current))return()=>null;const b=new ResizeObserver(()=>{setTimeout(()=>S())});return b.observe(ue.current),()=>{b.disconnect()}},[Oe,ue==null?void 0:ue.current]),d.useEffect(()=>{var b;const j=document.querySelector(`[id='${o}']`),N=[...de,j];D&&N.includes(D)||je((b=de[0])!==null&&b!==void 0?b:j)},[o,de,D]),d.useEffect(()=>(_e&&O(!0),()=>{Z(ee),Z(oe)}),[]),d.useEffect(()=>{var b;let j=(b=$==null?void 0:$.anchorSelect)!==null&&b!==void 0?b:m;if(!j&&r&&(j=`[data-tooltip-id='${r.replace(/'/g,"\\'")}']`),j)try{const N=Array.from(document.querySelectorAll(j));Ke(N)}catch{Ke([])}},[r,m,$==null?void 0:$.anchorSelect]),d.useEffect(()=>{ee.current&&(Z(ee),Ue(t))},[t]);const J=(Ie=$==null?void 0:$.content)!==null&&Ie!==void 0?Ie:Oe,ve=G&&Object.keys(ce.tooltipStyles).length>0;return d.useImperativeHandle(s,()=>({open:b=>{if(b!=null&&b.anchorSelect)try{document.querySelector(b.anchorSelect)}catch{return void console.warn(`[react-tooltip] "${b.anchorSelect}" is not a valid CSS selector`)}De(b??null),b!=null&&b.delay?Ue(b.delay):O(!0)},close:b=>{b!=null&&b.delay?qe(b.delay):O(!1)},activeAnchor:D,place:ce.place,isOpen:!!(me&&!y&&J&&ve)})),me&&!y&&J?fe.createElement(p,{id:r,role:cs,className:gs("react-tooltip",Be.tooltip,hs.tooltip,hs[v],l,`react-tooltip__place-${ce.place}`,Be[ve?"show":"closing"],ve?"react-tooltip__show":"react-tooltip__closing",a==="fixed"&&Be.fixed,E&&Be.clickable),onTransitionEnd:b=>{Z(Le),G||b.propertyName!=="opacity"||(he(!1),De(null),re==null||re())},style:{...We,...ce.tooltipStyles,opacity:ke!==void 0&&ve?ke:void 0},ref:Y},J,fe.createElement(p,{className:gs("react-tooltip-arrow",Be.arrow,hs.arrow,h,w&&Be.noArrow),style:{...ce.tooltipArrowStyles,background:es?`linear-gradient(to right bottom, transparent 50%, ${es} 50%)`:void 0,"--rt-arrow-size":`${Ne}px`},ref:we})):null},jt=({content:s})=>fe.createElement("span",{dangerouslySetInnerHTML:{__html:s}}),Je=fe.forwardRef(({id:s,anchorId:r,anchorSelect:l,content:h,html:v,render:o,className:m,classNameArrow:u,variant:f="dark",place:g="top",offset:x=10,wrapper:a="div",children:n=null,events:p=["hover"],openOnClick:t=!1,positionStrategy:i="absolute",middlewares:c,delayShow:y=0,delayHide:w=0,float:E=!1,hidden:A=!1,noArrow:B=!1,clickable:R=!1,closeOnEsc:q=!1,closeOnScroll:L=!1,closeOnResize:te=!1,openEvents:Re,closeEvents:We,globalCloseEvents:Xe,imperativeModeOnly:Ze=!1,style:re,position:xe,isOpen:Oe,defaultIsOpen:ue=!1,disableStyleInjection:k=!1,border:_e,opacity:pe,arrowColor:D,arrowSize:je,setIsOpen:He,afterShow:ke,afterHide:es,disableTooltip:Ne,role:cs="tooltip"},Ie)=>{const[Y,we]=d.useState(h),[ee,oe]=d.useState(v),[Le,ce]=d.useState(g),[ds,G]=d.useState(f),[ss,me]=d.useState(x),[he,$]=d.useState(y),[De,Ve]=d.useState(w),[ze,Me]=d.useState(E),[ts,Se]=d.useState(A),[de,Ke]=d.useState(a),[be,Ee]=d.useState(p),[us,Ce]=d.useState(i),[ge,se]=d.useState(null),[O,rs]=d.useState(null),Ue=d.useRef(k),{anchorRefs:qe,activeAnchor:Ye}=Gs(s),Ae=z=>z==null?void 0:z.getAttributeNames().reduce((W,_)=>{var S;return _.startsWith("data-tooltip-")&&(W[_.replace(/^data-tooltip-/,"")]=(S=z==null?void 0:z.getAttribute(_))!==null&&S!==void 0?S:null),W},{}),Pe=z=>{const W={place:_=>{var S;ce((S=_)!==null&&S!==void 0?S:g)},content:_=>{we(_??h)},html:_=>{oe(_??v)},variant:_=>{var S;G((S=_)!==null&&S!==void 0?S:f)},offset:_=>{me(_===null?x:Number(_))},wrapper:_=>{var S;Ke((S=_)!==null&&S!==void 0?S:a)},events:_=>{const S=_==null?void 0:_.split(" ");Ee(S??p)},"position-strategy":_=>{var S;Ce((S=_)!==null&&S!==void 0?S:i)},"delay-show":_=>{$(_===null?y:Number(_))},"delay-hide":_=>{Ve(_===null?w:Number(_))},float:_=>{Me(_===null?E:_==="true")},hidden:_=>{Se(_===null?A:_==="true")},"class-name":_=>{se(_)}};Object.values(W).forEach(_=>_(null)),Object.entries(z).forEach(([_,S])=>{var J;(J=W[_])===null||J===void 0||J.call(W,S)})};d.useEffect(()=>{we(h)},[h]),d.useEffect(()=>{oe(v)},[v]),d.useEffect(()=>{ce(g)},[g]),d.useEffect(()=>{G(f)},[f]),d.useEffect(()=>{me(x)},[x]),d.useEffect(()=>{$(y)},[y]),d.useEffect(()=>{Ve(w)},[w]),d.useEffect(()=>{Me(E)},[E]),d.useEffect(()=>{Se(A)},[A]),d.useEffect(()=>{Ce(i)},[i]),d.useEffect(()=>{Ue.current!==k&&console.warn("[react-tooltip] Do not change `disableStyleInjection` dynamically.")},[k]),d.useEffect(()=>{typeof window<"u"&&window.dispatchEvent(new CustomEvent("react-tooltip-inject-styles",{detail:{disableCore:k==="core",disableBase:k}}))},[]),d.useEffect(()=>{var z;const W=new Set(qe);let _=l;if(!_&&s&&(_=`[data-tooltip-id='${s.replace(/'/g,"\\'")}']`),_)try{document.querySelectorAll(_).forEach(j=>{W.add({current:j})})}catch{console.warn(`[react-tooltip] "${_}" is not a valid CSS selector`)}const S=document.querySelector(`[id='${r}']`);if(S&&W.add({current:S}),!W.size)return()=>null;const J=(z=O??S)!==null&&z!==void 0?z:Ye.current,ve=new MutationObserver(j=>{j.forEach(N=>{var V;if(!J||N.type!=="attributes"||!(!((V=N.attributeName)===null||V===void 0)&&V.startsWith("data-tooltip-")))return;const M=Ae(J);Pe(M)})}),b={attributes:!0,childList:!1,subtree:!1};if(J){const j=Ae(J);Pe(j),ve.observe(J,b)}return()=>{ve.disconnect()}},[qe,Ye,O,r,l]),d.useEffect(()=>{re!=null&&re.border&&console.warn("[react-tooltip] Do not set `style.border`. Use `border` prop instead."),_e&&!Fs("border",`${_e}`)&&console.warn(`[react-tooltip] "${_e}" is not a valid \`border\`.`),re!=null&&re.opacity&&console.warn("[react-tooltip] Do not set `style.opacity`. Use `opacity` prop instead."),pe&&!Fs("opacity",`${pe}`)&&console.warn(`[react-tooltip] "${pe}" is not a valid \`opacity\`.`)},[]);let $e=n;const Qe=d.useRef(null);if(o){const z=o({content:(O==null?void 0:O.getAttribute("data-tooltip-content"))||Y||null,activeAnchor:O});$e=z?fe.createElement("div",{ref:Qe,className:"react-tooltip-content-wrapper"},z):null}else Y&&($e=Y);ee&&($e=fe.createElement(jt,{content:ee}));const as={forwardRef:Ie,id:s,anchorId:r,anchorSelect:l,className:gs(m,ge),classNameArrow:u,content:$e,contentWrapperRef:Qe,place:Le,variant:ds,offset:ss,wrapper:de,events:be,openOnClick:t,positionStrategy:us,middlewares:c,delayShow:he,delayHide:De,float:ze,hidden:ts,noArrow:B,clickable:R,closeOnEsc:q,closeOnScroll:L,closeOnResize:te,openEvents:Re,closeEvents:We,globalCloseEvents:Xe,imperativeModeOnly:Ze,style:re,position:xe,isOpen:Oe,defaultIsOpen:ue,border:_e,opacity:pe,arrowColor:D,arrowSize:je,setIsOpen:He,afterShow:ke,afterHide:es,disableTooltip:Ne,activeAnchor:O,setActiveAnchor:z=>rs(z),role:cs};return fe.createElement(_t,{...as})});typeof window<"u"&&window.addEventListener("react-tooltip-inject-styles",s=>{s.detail.disableCore||Ps({css:":root{--rt-color-white:#fff;--rt-color-dark:#222;--rt-color-success:#8dc572;--rt-color-error:#be6464;--rt-color-warning:#f0ad4e;--rt-color-info:#337ab7;--rt-opacity:0.9;--rt-transition-show-delay:0.15s;--rt-transition-closing-delay:0.15s;--rt-arrow-size:8px}.core-styles-module_tooltip__3vRRp{position:absolute;top:0;left:0;pointer-events:none;opacity:0;will-change:opacity}.core-styles-module_fixed__pcSol{position:fixed}.core-styles-module_arrow__cvMwQ{position:absolute;background:inherit;z-index:-1}.core-styles-module_noArrow__xock6{display:none}.core-styles-module_clickable__ZuTTB{pointer-events:auto}.core-styles-module_show__Nt9eE{opacity:var(--rt-opacity);transition:opacity var(--rt-transition-show-delay)ease-out}.core-styles-module_closing__sGnxF{opacity:0;transition:opacity var(--rt-transition-closing-delay)ease-in}",type:"core"}),s.detail.disableBase||Ps({css:`
.styles-module_tooltip__mnnfp{padding:8px 16px;border-radius:3px;font-size:90%;width:max-content}.styles-module_arrow__K0L3T{width:var(--rt-arrow-size);height:var(--rt-arrow-size)}[class*='react-tooltip__place-top']>.styles-module_arrow__K0L3T{transform:rotate(45deg)}[class*='react-tooltip__place-right']>.styles-module_arrow__K0L3T{transform:rotate(135deg)}[class*='react-tooltip__place-bottom']>.styles-module_arrow__K0L3T{transform:rotate(225deg)}[class*='react-tooltip__place-left']>.styles-module_arrow__K0L3T{transform:rotate(315deg)}.styles-module_dark__xNqje{background:var(--rt-color-dark);color:var(--rt-color-white)}.styles-module_light__Z6W-X{background-color:var(--rt-color-white);color:var(--rt-color-dark)}.styles-module_success__A2AKt{background-color:var(--rt-color-success);color:var(--rt-color-white)}.styles-module_warning__SCK0X{background-color:var(--rt-color-warning);color:var(--rt-color-white)}.styles-module_error__JvumD{background-color:var(--rt-color-error);color:var(--rt-color-white)}.styles-module_info__BWdHW{background-color:var(--rt-color-info);color:var(--rt-color-white)}`,type:"base"})});async function Nt(){try{const r=(await ye.get("/addons")).data;return Array.isArray(r)?r:(console.warn("Unexpected response shape:",r),[])}catch(s){return console.error("Failed to fetch categories:",s),[]}}const Js=({name:s,errors:r,touched:l,onBlur:h,onChange:v,setFieldValue:o,setFieldTouched:m,initialAddons:u=[]})=>{const{values:f}=st(),[g,x]=d.useState([]),[a,n]=d.useState([]);d.useEffect(()=>{Nt().then(t=>{x(t.map(i=>({id:String(i.id),name:i.name,base_price:Number(i.base_price),is_freebies:i.is_freebies??"N"})))}).catch(console.error)},[]);const p=f[s]||[];return d.useEffect(()=>{u.length&&p.length===0&&o(s,u.map(t=>({...t,custom_price:t.is_freebies==="Y"?0:t.custom_price})))},[u,p.length,s,o]),e.jsx(Is,{name:s,render:t=>e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h5",{children:"Addons"}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>t.push({id:"",name:"",base_price:0,custom_price:"",is_freebies:"N"}),children:"Add Addon"}),(()=>{const i=a.filter(c=>c.id);return i.length>0&&e.jsxs("button",{type:"button",className:"btn btn-outline-primary d-inline-flex align-items-center",id:"tooltip-retrieve-addons",onClick:()=>{i.forEach(c=>t.push(c)),n(c=>c.filter(y=>!y.id))},children:[e.jsx("i",{className:"bi bi-arrow-counterclockwise fs-5"}),e.jsx(Je,{anchorId:"tooltip-retrieve-addons",place:"top",content:`Retrieve Existing (${i.length})`})]})})()]})]}),p.length===0&&e.jsxs("div",{className:"alert alert-secondary text-center rounded-3 py-4 shadow-sm",children:[e.jsx("i",{className:"bi bi-plus-circle fs-3 d-block mb-2 text-muted"}),e.jsx("span",{className:"fw-semibold text-muted",children:"No addons added yet."})]}),p.map((i,c)=>{const y=`addons[${c}].id`,w=`addons[${c}].custom_price`,E=r[y],A=r[w],B=typeof l.addons<"u"?l.addons[c]:l;return e.jsxs("div",{className:"row align-items-center mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs("select",{name:`${s}[${c}].id`,value:i.id||"",className:F("form-control",{"is-invalid":E&&((B==null?void 0:B.id)??!0)}),onChange:R=>{const q=R.target.value,L=g.find(te=>te.id===q);o(`${s}[${c}].id`,q),L&&(m(`${s}[${c}].id`,!1),o(`${s}[${c}].name`,L.name),o(`${s}[${c}].base_price`,L.base_price),o(`${s}[${c}].is_freebies`,L.is_freebies),o(`${s}[${c}].custom_price`,L.is_freebies==="Y"?0:""))},children:[e.jsx("option",{value:"",children:"Select Addon"}),g.map(R=>e.jsx("option",{value:R.id,children:R.name},R.id))]}),E&&((B==null?void 0:B.id)??!0)&&e.jsx("div",{className:"invalid-feedback",children:E})]}),e.jsx("div",{className:"col-md-3",children:e.jsx("input",{type:"number",placeholder:"Base Price",className:"form-control",value:i.base_price,readOnly:!0})}),e.jsx("div",{className:"col-md-3",children:i.is_freebies==="Y"?e.jsx("input",{type:"text",className:"form-control",value:"Freebie",readOnly:!0}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",name:`${s}[${c}].custom_price`,value:i.custom_price,min:0,step:.01,placeholder:"Custom Price",className:F("form-control",{"is-invalid":A&&((B==null?void 0:B.custom_price)??!0)}),onChange:R=>o(`${s}[${c}].custom_price`,R.target.value),onBlur:()=>m(`${s}[${c}].custom_price`,!1)}),A&&((B==null?void 0:B.custom_price)??!0)&&e.jsx("div",{className:"invalid-feedback",children:A})]})}),e.jsx("div",{className:"col-md-2",children:e.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>{n(R=>[...R,p[c]]),t.remove(c),m(`${s}[${c}].id`,!1),m(`${s}[${c}].custom_price`,!1)},children:"×"})})]},c)})]})})},wt=({name:s,formik:r,preview:l,setPreview:h,label:v="Upload Image",accept:o="image/*"})=>{const m=d.useRef(null),[u,f]=d.useState(0),g=["image/jpeg","image/jpg","image/png"],x=n=>{var i;const p=(i=n.target.files)==null?void 0:i[0];if(!p)return;if(!g.includes(p.type)){H.fire({icon:"info",title:"Only JPG, JPEG, PNG files are allowed."});return}r.setFieldValue(s,p),console.log(r.values),l&&l.startsWith("blob:")&&URL.revokeObjectURL(l);const t=URL.createObjectURL(p);h(t),f(100),r.setFieldValue(s.replace(".image",".image_preview"),t),n.target.value=""},a=()=>{l&&l.startsWith("blob:")&&URL.revokeObjectURL(l),r.setFieldValue(s,null),h(null),f(0)};return e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:v}),e.jsx("div",{className:"position-relative image-preview-container image-input-wrapper w-150px h-150px",children:l?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:l,alt:"Preview",className:"img-thumbnail preview-image"}),e.jsx("div",{className:"progress mt-1",style:{height:"5px"},children:e.jsx("div",{className:"progress-bar",role:"progressbar",style:{width:`${u}%`},"aria-valuenow":u,"aria-valuemin":0,"aria-valuemax":100})}),e.jsx("button",{type:"button",className:"btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-body shadow position-absolute top-0 end-0 m-1",onClick:a,children:"×"})]}):e.jsx("img",{src:"/media/default.jpg",alt:"Default Preview",className:"img-thumbnail preview-image"})}),e.jsx("button",{type:"button",className:"btn btn-secondary mt-2",onClick:()=>{var n;return(n=m.current)==null?void 0:n.click()},children:"Select Image"}),e.jsx("input",{type:"file",accept:o,onChange:x,ref:m,className:"d-none"}),r.touched[s]&&r.errors[s]&&e.jsx("div",{className:"invalid-feedback d-block",children:r.errors[s]})]})},Ws=({name:s,errors:r,touched:l,onBlur:h,onChange:v,setFieldValue:o,setFieldTouched:m,initialPreviews:u=[]})=>{const[f,g]=d.useState([]),[x,a]=d.useState([]);return d.useEffect(()=>{u.length>0&&g(u.map(n=>n.filter(Boolean)))},[u]),e.jsx(Is,{name:s,render:n=>e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("h5",{children:"Variants"}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>{n.push({id:"",sku:"",variant_name:"",quantity_on_hand:"",reorder_point:"",cost_price:"",selling_price:"",image:null,image_preview:null}),g(p=>[...p,[]])},children:"Add Variant"}),x.filter(p=>p.id).length>0&&e.jsxs("button",{type:"button",className:"btn btn-outline-primary d-inline-flex align-items-center",id:"tooltip-retrieve-variants",onClick:()=>{x.filter(t=>t.id).forEach(t=>n.push(t)),a(t=>t.filter(i=>!i.id))},children:[e.jsx("i",{className:"bi bi-arrow-counterclockwise fs-5"}),e.jsx(Je,{anchorId:"tooltip-retrieve-variants",place:"top",content:`Retrieve Existing (${x.filter(p=>p.id).length})`})]})]})]}),n.form.values[s].length===0&&e.jsxs("div",{className:"alert alert-secondary text-center rounded-3 py-4 shadow-sm",children:[e.jsx("i",{className:"bi bi-plus-circle fs-3 d-block mb-2 text-muted"}),e.jsx("span",{className:"fw-semibold text-muted",children:"No variant added yet."})]}),e.jsx("div",{className:"row",children:n.form.values[s].map((p,t)=>{const i=`variants[${t}].quantity_on_hand`,c=`variants[${t}].sku`,y=`variants[${t}].variant_name`,w=`variants[${t}].image`,E=r[i],A=r[c],B=r[y],R=r[w],q=typeof l.variants<"u"?l.variants[t]:l;return e.jsx("div",{className:"col-md-3 mb-4",children:e.jsxs("div",{className:"border rounded p-3 mb-3",children:[e.jsx(wt,{name:`variants.${t}.image`,formik:n.form,preview:typeof p.image_preview=="string"?p.image_preview:null,setPreview:L=>{const te=[...n.form.values.variants];te[t].image_preview=L,n.form.setFieldValue(`variants.${t}.image_preview`,L)},label:"Variant Image"}),R&&((q==null?void 0:q.image)??!0)&&e.jsx("div",{className:"text-danger",children:R}),e.jsx("label",{className:"form-label required",children:"Variant SKU"}),e.jsx("input",{type:"text",className:F("form-control mb-2",{"is-invalid":A&&((q==null?void 0:q.sku)??!0)}),placeholder:"Variant SKU",...n.form.getFieldProps(c),onBlur:()=>m(c,!1)}),e.jsx("label",{className:"form-label required",children:"Variant Name"}),e.jsx("input",{type:"text",className:F("form-control mb-2",{"is-invalid":B&&((q==null?void 0:q.variant_name)??!0)}),placeholder:"Variant Name",...n.form.getFieldProps(y),onBlur:()=>m(y,!1)}),e.jsx("label",{className:"form-label required",children:"Quantity"}),e.jsx("input",{type:"number",className:F("form-control mb-2",{"is-invalid":E&&((q==null?void 0:q.quantity_on_hand)??!0)}),placeholder:"Quantity on Hand",...n.form.getFieldProps(i),onBlur:()=>m(i,!1)}),e.jsxs("label",{className:"form-label",children:["Reorder Point (optional)",e.jsx("span",{id:`tooltip-reorders-${t}`,className:"ms-2 cursor-pointer text-primary",children:"ℹ️"}),e.jsx(Je,{anchorId:`tooltip-reorders-${t}`,place:"right",content:"If Reorder point is 0 or empty, the main product re order points will be used."})]}),e.jsx("input",{type:"number",className:"form-control mb-2",placeholder:"Reorder Point",...n.form.getFieldProps(`${s}[${t}].reorder_point`)}),e.jsxs("label",{className:"form-label",children:["Cost Price (optional)",e.jsx("span",{id:`tooltip-cost-${t}`,className:"ms-2 cursor-pointer text-primary",children:"ℹ️"}),e.jsx(Je,{anchorId:`tooltip-cost-${t}`,place:"right",content:"If Cost Price is 0 or empty, the main product price will be used."})]}),e.jsx("input",{type:"number",className:"form-control mb-2",placeholder:"Cost Price",...n.form.getFieldProps(`${s}[${t}].cost_price`)}),e.jsxs("label",{className:"form-label",children:["Selling Price (optional)",e.jsx("span",{id:`tooltip-selling-${t}`,className:"ms-2 cursor-pointer text-primary",children:"ℹ️"}),e.jsx(Je,{anchorId:`tooltip-selling-${t}`,place:"right",content:"If Selling Price is 0 or empty, the main product price will be used."})]}),e.jsx("input",{type:"number",className:"form-control mb-2",placeholder:"Selling Price",...n.form.getFieldProps(`${s}[${t}].selling_price`)}),e.jsx("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>{p.id&&a(L=>[...L,p]),n.remove(t),g(L=>L.filter((te,Re)=>Re!==t)),m(c,!1),m(y,!1),m(w,!1),m(i,!1)},children:"Remove Variant"})]})},t)})})]})})};async function St(){try{const r=(await ye.get("/brands")).data;return Array.isArray(r)?r:(console.warn("Unexpected response shape:",r),[])}catch(s){return console.error("Failed to fetch categories:",s),[]}}const Xs=({setClass:s,name:r,value:l,onChange:h,onBlur:v,error:o,touched:m})=>{const[u,f]=d.useState([]);return d.useEffect(()=>{St().then(g=>{const x=g.map(a=>({value:a.id,label:a.name}));f(x)}).catch(console.error)},[]),e.jsxs("div",{className:s,children:[e.jsx("label",{className:"form-label required",children:"Brands"}),e.jsx(xs,{name:r,options:u,value:u.find(g=>g.value===l)||null,onChange:g=>h({target:{name:r,value:(g==null?void 0:g.value)||""}}),onBlur:v,className:F("form-select-solid text-dark",{"is-invalid":o&&m},{})}),o&&m&&e.jsx("div",{className:"invalid-feedback",children:o})]})},K=[U().shape({sku:T().min(1).max(50).required("SKU is required"),name:T().min(1).max(50).required("Product name is required"),description:T().min(1).required("Description is required"),brand_id:T().required("Product Brand is required"),category_id:T().required("Category is required"),supplier_id:T().required("Supplier is required")}),U().shape({quantity_on_hand:I().required("Quantity is required").min(1),reorder_point:I().required("Reorder point is required").min(0),cost_price:I().required("Cost price is required").min(0),selling_price:I().required("Selling price is required").min(0)}),U().shape({images:Te().of(is().test("fileType","Only JPG, JPEG, PNG files are allowed",s=>s?s instanceof File?["image/jpeg","image/jpg","image/png"].includes(s.type):!1:!0).test("fileSize","File size is too large (max 5MB)",s=>s?s instanceof File?s.size<=5*1024*1024:!1:!0)).test("images","At least one image required",function(s){var l;const r=(l=this.options.context)==null?void 0:l.imagePreviews;return Array.isArray(s)&&s.length>0||r&&r.length>0})}),U().shape({addons:Te().min(0,"At least one addon is required").of(U().shape({id:T().required("Addon is required"),is_freebies:T().oneOf(["Y","N"],"Must be Y or N").required("is_freebies is required"),base_price:I().transform((s,r)=>r===""?null:s).min(0,"Base price cannot be negative").when("is_freebies",{is:"Y",then:s=>s.notRequired().nullable(),otherwise:s=>s.required("Base price is required")}),custom_price:I().transform((s,r)=>r===""?null:s).required("Custom price is required").min(0,"Custom price cannot be negative").when("is_freebies",{is:"Y",then:s=>s.test("must-be-zero-if-freebie","Custom price must be 0 for freebies",r=>r===0||r===null||r===void 0),otherwise:s=>s.test("custom-vs-base","Custom price cannot be less than base price",function(r){const{base_price:l}=this.parent;return r==null?!0:r>=l})})}))}),U().shape({variants:Te().of(U().shape({sku:T().required("Variant SKU is required"),variant_name:T().required("Variant name is required"),quantity_on_hand:I().required("Quantity on hand is required").min(0),reorder_point:I().transform((s,r)=>r===""?null:s).nullable(),cost_price:I().transform((s,r)=>r===""?null:s).nullable(),selling_price:I().transform((s,r)=>r===""?null:s).nullable(),image:is().nullable().test("required","Variant image is required",function(s){const l=this.parent??{};return l.image_preview&&typeof l.image_preview=="string"&&l.image_preview.trim()!==""?!0:s?Array.isArray(s)?s.length===0?!1:s.some(h=>typeof h=="string"||h instanceof File):typeof s=="string"||s instanceof File:!1}).test("fileType","Only JPG, JPEG, PNG files are allowed",s=>s?Array.isArray(s)?s.every(r=>typeof r=="string"||r instanceof File&&["image/jpeg","image/jpg","image/png"].includes(r.type)):typeof s=="string"?!0:s instanceof File?["image/jpeg","image/jpg","image/png"].includes(s.type):!1:!0).test("fileSize","File size is too large (max 5MB)",s=>s?Array.isArray(s)?s.every(r=>typeof r=="string"||r instanceof File&&r.size<=5*1024*1024):typeof s=="string"?!0:s instanceof File?s.size<=5*1024*1024:!0:!0)}))})],ns=[{label:"Basic Info"},{label:"Inventory & Pricing"},{label:"Images"},{label:"Addons"},{label:"Variants"}],Et=({setPage:s,setRefreshTable:r,onSubmit:l})=>{const[h,v]=d.useState([]),[o,m]=d.useState(1),{createProduct:u}=os(),f=async(a,n)=>{const p=await n();Object.keys(p).length>0||m(t=>Math.min(t+1,ns.length))},g=()=>m(a=>Math.max(a-1,1)),x=(a,n)=>{const p={};if(a===4){const t=Array.isArray(n.addons)?n.addons:[];p.addons=t.map(()=>({id:!0,name:!0,base_price:!0,custom_price:!0,is_freebies:!0}))}else(K[a-1]&&K[a-1].fields?Object.keys(K[a-1].fields):[]).forEach(i=>p[i]=!0);return p};return e.jsx(Ls,{initialValues:{sku:"",name:"",description:"",brand_id:"",category_id:"",supplier_id:"",quantity_on_hand:"",reorder_point:"",cost_price:"",selling_price:"",images:[],primary_index:0,addons:[],variants:[]},validationSchema:U(),validateOnChange:!1,validateOnBlur:!1,onSubmit:async(a,{resetForm:n})=>{await u(a,n,r,s),l==null||l(a)},children:a=>e.jsxs("form",{noValidate:!0,onSubmit:a.handleSubmit,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"d-flex justify-content-between align-items-center mb-2",children:ns.map((n,p)=>e.jsx("div",{className:`flex-fill text-center ${o===p+1?"fw-bold text-primary":"text-muted"}`,children:n.label},p))}),e.jsx("div",{className:"progress",style:{height:"6px"},children:e.jsx("div",{className:"progress-bar bg-primary",role:"progressbar",style:{width:`${o/ns.length*100}%`}})})]}),o===1&&e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label required",children:"SKU"}),e.jsx("input",{type:"text",className:F("form-control",{"is-invalid":a.touched.sku&&a.errors.sku}),...a.getFieldProps("sku"),onChange:n=>{a.handleChange(n),K[o-1].validateAt("sku",a.values).then(()=>a.setFieldError("sku","")).catch(t=>a.setFieldError("sku",t.message))}}),a.touched.sku&&a.errors.sku&&e.jsx("div",{className:"invalid-feedback",children:a.errors.sku})]}),e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label required",children:"Product Name"}),e.jsx("input",{type:"text",className:F("form-control",{"is-invalid":a.touched.name&&a.errors.name}),...a.getFieldProps("name"),onChange:n=>{a.handleChange(n),K[o-1].validateAt("name",a.values).then(()=>a.setFieldError("name","")).catch(t=>a.setFieldError("name",t.message))}}),a.touched.name&&a.errors.name&&e.jsx("div",{className:"invalid-feedback",children:a.errors.name})]}),e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label required",children:"Description"}),e.jsx("textarea",{className:F("form-control",{"is-invalid":a.touched.description&&a.errors.description}),rows:4,...a.getFieldProps("description"),onChange:n=>{a.handleChange(n),K[o-1].validateAt("description",a.values).then(()=>a.setFieldError("description","")).catch(t=>a.setFieldError("description",t.message))}}),a.touched.description&&a.errors.description&&e.jsx("div",{className:"invalid-feedback",children:a.errors.description})]}),e.jsx("div",{className:"col-md-6",children:e.jsx(Xs,{setClass:"mb-3",name:"brand_id",value:a.values.brand_id,onChange:n=>{a.handleChange(n),K[o-1].validateAt("brand_id",{...a.values,[n.target.name]:n.target.value}).then(()=>a.setFieldError("brand_id","")).catch(t=>a.setFieldError("brand_id",t.message))},onBlur:n=>{a.handleBlur(n)},error:a.errors.brand_id,touched:a.touched.brand_id})}),e.jsx("div",{className:"col-md-6",children:e.jsx(Ys,{setClass:"mb-3",name:"category_id",value:a.values.category_id,onChange:n=>{a.handleChange(n),K[o-1].validateAt("category_id",{...a.values,[n.target.name]:n.target.value}).then(()=>a.setFieldError("category_id","")).catch(t=>a.setFieldError("category_id",t.message))},onBlur:n=>{a.handleBlur(n)},error:a.errors.category_id,touched:a.touched.category_id})}),e.jsx("div",{className:"col-md-6 mb-3",children:e.jsx(Qs,{setClass:"mb-3",name:"supplier_id",value:a.values.supplier_id,onChange:n=>{a.handleChange(n),K[o-1].validateAt("supplier_id",{...a.values,[n.target.name]:n.target.value}).then(()=>a.setFieldError("supplier_id","")).catch(t=>a.setFieldError("supplier_id",t.message))},onBlur:n=>{a.handleBlur(n)},error:a.errors.supplier_id,touched:a.touched.supplier_id})})]}),o===2&&e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label required",children:"Quantity on Hand"}),e.jsx("input",{type:"number",className:F("form-control",{"is-invalid":a.touched.quantity_on_hand&&a.errors.quantity_on_hand}),...a.getFieldProps("quantity_on_hand"),onBlur:n=>{a.handleBlur(n),K[o-1].validateAt("quantity_on_hand",a.values).then(()=>a.setFieldError("quantity_on_hand","")).catch(t=>a.setFieldError("quantity_on_hand",t.message))}})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label required",children:"Reorder Point"}),e.jsx("input",{type:"number",className:F("form-control",{"is-invalid":a.touched.reorder_point&&a.errors.reorder_point}),...a.getFieldProps("reorder_point"),onBlur:n=>{a.handleBlur(n),K[o-1].validateAt("reorder_point",a.values).then(()=>a.setFieldError("reorder_point","")).catch(t=>a.setFieldError("reorder_point",t.message))}})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label required",children:"Cost Price"}),e.jsx("input",{type:"number",className:F("form-control",{"is-invalid":a.touched.cost_price&&a.errors.cost_price}),...a.getFieldProps("cost_price"),onBlur:n=>{a.handleBlur(n),K[o-1].validateAt("cost_price",a.values).then(()=>a.setFieldError("cost_price","")).catch(t=>a.setFieldError("cost_price",t.message))}})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label required",children:"Selling Price"}),e.jsx("input",{type:"number",className:F("form-control",{"is-invalid":a.touched.selling_price&&a.errors.selling_price}),...a.getFieldProps("selling_price"),onBlur:n=>{a.handleBlur(n),K[o-1].validateAt("selling_price",a.values).then(()=>a.setFieldError("selling_price","")).catch(t=>a.setFieldError("selling_price",t.message))}})]})]}),o===3&&e.jsx(e.Fragment,{children:e.jsx(Us,{name:"images",formik:a,previews:h,setPreviews:v,label:"Product Images",maxFiles:5})}),o===4&&e.jsx(e.Fragment,{children:e.jsx(Js,{name:"addons",errors:a.errors,touched:a.touched,onBlur:n=>{a.handleBlur(n)},onChange:n=>{a.handleChange(n)},setFieldValue:a.setFieldValue,setFieldTouched:a.setFieldTouched})}),o===5&&e.jsx(Ws,{name:"variants",errors:a.errors,touched:a.touched,onBlur:n=>{a.handleBlur(n)},onChange:n=>{a.handleChange(n)},setFieldValue:a.setFieldValue,setFieldTouched:a.setFieldTouched}),e.jsxs("div",{className:"d-flex justify-content-between mt-4",children:[o>1&&e.jsx("button",{type:"button",className:"btn btn-light",onClick:g,children:"Back"}),o<ns.length?e.jsx("button",{type:"button",className:"btn btn-primary",onClick:async()=>{try{Object.fromEntries(Object.keys(K[o-1].fields).map(n=>[n,!0])),await K[o-1].validate(a.values,{abortEarly:!1}),f(a.values,a.validateForm)}catch(n){const p={};n.inner.forEach(i=>{p[i.path]=i.message}),a.setErrors(p);const t=x(o,a.values);a.setTouched({...a.touched||{},...t})}},children:"Next"}):e.jsx("button",{type:"button",className:"btn btn-success",onClick:async()=>{try{await K[o-1].validate(a.values,{abortEarly:!1}),console.log(a.values),a.handleSubmit()}catch(n){const p={};n.inner.forEach(i=>{p[i.path]=i.message}),console.log(p),a.setErrors(p);const t=x(o,a.values);a.setTouched({...a.touched||{},...t})}},children:"Submit"})]})]})})},ls=[{label:"Basic Info"},{label:"Inventory & Pricing"},{label:"Images"},{label:"Addons"},{label:"Variants"}],bs=[U().shape({sku:T().min(1).max(50).required("SKU is required"),name:T().min(1).max(50).required("Product name is required"),description:T().min(1).required("Description is required"),brand_id:T().required("Brand is required"),category_id:T().required("Category is required"),supplier_id:T().required("Supplier is required")}),U().shape({add_new_stocks:I().min(0),reorder_point:I().required("Reorder point is required").min(0),cost_price:I().required("Cost price is required").min(0),selling_price:I().required("Selling price is required").min(0)}),U().shape({images:Te().of(is().test("fileType","Only JPG, JPEG, PNG files are allowed",s=>s?s instanceof File?["image/jpeg","image/jpg","image/png"].includes(s.type):!1:!0).test("fileSize","File size is too large (max 5MB)",s=>s?s instanceof File?s.size<=5*1024*1024:!1:!0)).test("images","At least one image required",function(s){var l;const r=(l=this.options.context)==null?void 0:l.imagePreviews;return Array.isArray(s)&&s.length>0||r&&r.length>0})}),U().shape({addons:Te().min(0,"At least one addon is required").of(U().shape({id:T().required("Addon is required"),is_freebies:T().oneOf(["Y","N"],"Must be Y or N").required("is_freebies is required"),base_price:I().transform((s,r)=>r===""?null:s).min(0,"Base price cannot be negative").when("is_freebies",{is:"Y",then:s=>s.notRequired().nullable(),otherwise:s=>s.required("Base price is required")}),custom_price:I().transform((s,r)=>r===""?null:s).required("Custom price is required").min(0,"Custom price cannot be negative").when("is_freebies",{is:"Y",then:s=>s.test("must-be-zero-if-freebie","Custom price must be 0 for freebies",r=>r===0||r===null||r===void 0),otherwise:s=>s.test("custom-vs-base","Custom price cannot be less than base price",function(r){const{base_price:l}=this.parent;return r==null?!0:r>=l})})}))}),U().shape({variants:Te().of(U().shape({sku:T().required("Variant SKU is required"),variant_name:T().required("Variant name is required"),quantity_on_hand:I().required("Quantity on hand is required").min(0),reorder_point:I().transform((s,r)=>r===""?null:s).nullable(),cost_price:I().transform((s,r)=>r===""?null:s).nullable(),selling_price:I().transform((s,r)=>r===""?null:s).nullable(),image_preview:T(),image:is().nullable().test("required","Variant image is required",function(s){const l=this.parent??{};return l.image_preview&&typeof l.image_preview=="string"&&l.image_preview.trim()!==""?!0:s?Array.isArray(s)?s.length===0?!1:s.some(h=>typeof h=="string"||h instanceof File):typeof s=="string"||s instanceof File:!1}).test("fileType","Only JPG, JPEG, PNG files are allowed",s=>s?Array.isArray(s)?s.every(r=>typeof r=="string"||r instanceof File&&["image/jpeg","image/jpg","image/png"].includes(r.type)):typeof s=="string"?!0:s instanceof File?["image/jpeg","image/jpg","image/png"].includes(s.type):!1:!0).test("fileSize","File size is too large (max 5MB)",s=>s?Array.isArray(s)?s.every(r=>typeof r=="string"||r instanceof File&&r.size<=5*1024*1024):typeof s=="string"?!0:s instanceof File?s.size<=5*1024*1024:!0:!0)}))})],Ct=({productID:s,data:r,setRefreshTable:l,onSubmit:h})=>{var a,n,p;const[v,o]=d.useState(1),[m,u]=d.useState(((a=r==null?void 0:r.images)==null?void 0:a.map(t=>t.image_cover))||[]),f=os(),g=async(t,i)=>{const c=await i();Object.keys(c).length>0||o(y=>Math.min(y+1,ls.length))},x=()=>o(t=>Math.max(t-1,1));return e.jsx(Ls,{initialValues:{sku:r.sku,name:r.name,description:r.description,category_id:r.category_id,brand_id:r.brand_id,supplier_id:r.supplier_id,quantity_on_hand:r.quantity_on_hand,add_new_stocks:0,reorder_point:r.reorder_point,cost_price:r.cost_price,selling_price:r.selling_price,images:[],addons:((n=r.product_addons)==null?void 0:n.map(t=>{var i;return{id:t.addon_id,base_price:t.base_price??"",custom_price:t.custom_price??"",is_freebies:((i=t.addon)==null?void 0:i.is_freebies)??"N"}}))||[],variants:((p=r.variants)==null?void 0:p.map(t=>({id:t.id_encrypted,sku:t.sku??"",variant_name:t.variant_name??"",quantity_on_hand:t.quantity_on_hand??"",reorder_point:t.reorder_point??"",cost_price:t.cost_price??"",selling_price:t.selling_price??"",image:"",image_preview:t.image_cover??null})))||[]},validationSchema:U(),validateOnChange:!0,validateOnBlur:!0,onSubmit:async(t,{resetForm:i})=>{await f.updateProduct(t,s,l),h==null||h(t)},context:{imagePreviews:m},children:t=>{var i;return e.jsxs("form",{noValidate:!0,onSubmit:t.handleSubmit,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"d-flex justify-content-between align-items-center mb-2",children:ls.map((c,y)=>e.jsx("div",{onClick:()=>o(y+1),className:`flex-fill text-center cursor-pointer ${v===y+1?"fw-bold text-primary":"text-muted"}`,children:c.label},y))}),e.jsx("div",{className:"progress",style:{height:"6px"},children:e.jsx("div",{className:"progress-bar bg-primary",role:"progressbar",style:{width:`${v/ls.length*100}%`}})})]}),v===1&&e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label required",children:"SKU"}),e.jsx("input",{type:"text",className:F("form-control ",{"is-invalid":t.touched.sku&&t.errors.sku}),...t.getFieldProps("sku")}),t.touched.sku&&typeof t.errors.sku=="string"&&e.jsx("div",{className:"invalid-feedback",children:t.errors.sku})]}),e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label required",children:"Product Name"}),e.jsx("input",{type:"text",className:F("form-control",{"is-invalid":t.touched.name&&t.errors.name}),...t.getFieldProps("name")}),t.touched.name&&typeof t.errors.name=="string"&&e.jsx("div",{className:"invalid-feedback",children:t.errors.name})]}),e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label required",children:"Description"}),e.jsx("textarea",{className:F("form-control",{"is-invalid":t.touched.description&&t.errors.description}),rows:4,...t.getFieldProps("description")}),t.touched.description&&typeof t.errors.description=="string"&&e.jsx("div",{className:"invalid-feedback",children:t.errors.description})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(Xs,{setClass:"mb-3",name:"brand_id",value:t.values.brand_id,onChange:t.handleChange,onBlur:t.handleBlur,error:t.errors.brand_id&&typeof t.errors.brand_id=="string"?t.errors.brand_id:void 0,touched:!!t.touched.brand_id}),t.touched.brand_id&&typeof t.errors.brand_id=="string"&&e.jsx("div",{className:"invalid-feedback",children:t.errors.brand_id})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(Ys,{setClass:"mb-3",name:"category_id",value:t.values.category_id,onChange:t.handleChange,onBlur:t.handleBlur,error:t.errors.category_id&&typeof t.errors.category_id=="string"?t.errors.category_id:void 0,touched:!!t.touched.category_id}),t.touched.category_id&&typeof t.errors.category_id=="string"&&e.jsx("div",{className:"invalid-feedback",children:t.errors.category_id})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx(Qs,{setClass:"mb-3",name:"supplier_id",value:t.values.supplier_id,onChange:t.handleChange,onBlur:t.handleBlur,error:t.errors.supplier_id&&typeof t.errors.supplier_id=="string"?t.errors.supplier_id:void 0,touched:!!t.touched.supplier_id}),t.touched.supplier_id&&typeof t.errors.supplier_id=="string"&&e.jsx("div",{className:"invalid-feedback",children:t.errors.supplier_id})]})]}),v===2&&e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Quantity on Hand"}),e.jsx("input",{type:"number",className:"form-control",...t.getFieldProps("quantity_on_hand"),readOnly:!0})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Add New Stocks"}),e.jsx("input",{type:"number",className:F("form-control",{"is-invalid":t.touched.add_new_stocks&&t.errors.add_new_stocks}),...t.getFieldProps("add_new_stocks")})]}),e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label",children:"Reorder Point"}),e.jsx("input",{type:"number",className:F("form-control",{"is-invalid":t.touched.reorder_point&&t.errors.reorder_point}),...t.getFieldProps("reorder_point")})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Cost Price"}),e.jsx("input",{type:"number",className:F("form-control",{"is-invalid":t.touched.cost_price&&t.errors.cost_price}),...t.getFieldProps("cost_price")})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Selling Price"}),e.jsx("input",{type:"number",className:F("form-control",{"is-invalid":t.touched.selling_price&&t.errors.selling_price}),...t.getFieldProps("selling_price")})]})]}),v===3&&e.jsx(Us,{name:"images",formik:t,previews:m,setPreviews:u,label:"Product Images",maxFiles:5,getPrimaryIndex:(r==null?void 0:r.primary_index)??0}),v===4&&e.jsx(Js,{name:"addons",errors:t.errors,touched:t.touched,onBlur:c=>{t.handleBlur(c)},onChange:c=>{t.handleChange(c)},setFieldValue:t.setFieldValue,setFieldTouched:t.setFieldTouched}),v===5&&e.jsx(Ws,{name:"variants",errors:t.errors,touched:t.touched,onBlur:c=>{t.handleBlur(c)},onChange:c=>{t.handleChange(c)},setFieldValue:t.setFieldValue,setFieldTouched:t.setFieldTouched,initialPreviews:((i=r.variants)==null?void 0:i.map(c=>[c.image]))||[]}),e.jsxs("div",{className:"d-flex justify-content-between mt-4",children:[v>1&&e.jsx("button",{type:"button",className:"btn btn-light",onClick:x,children:"Back"}),v<ls.length?e.jsx("button",{type:"button",className:"btn btn-primary",onClick:async()=>{try{Object.keys(bs[v-1].fields).forEach(c=>{t.setFieldTouched(c,!0,!1)}),await bs[v-1].validate(t.values,{abortEarly:!1,context:{imagePreviews:m}}),g(t.values,t.validateForm)}catch(c){const y={};c.inner.forEach(w=>{y[w.path]=w.message}),t.setErrors(y)}},children:"Next"}):e.jsx("button",{type:"button",className:"btn btn-success",onClick:async()=>{try{await bs[v-1].validate(t.values,{abortEarly:!1,context:{imagePreviews:m}}),t.handleSubmit()}catch(c){const y={};c.inner.forEach(w=>{y[w.path]=w.message}),console.log(y),t.setErrors(y)}},children:"Submit"})]})]})}})},qt=({data:s,loading:r,pagination:l,sortColumn:h,sortDirection:v,onPageChange:o,onSortChange:m,onRestore:u,onSearchChange:f,setRefreshTable:g,setRefreshFirstTable:x})=>{const{currentUser:a}=fs(),n=a==null?void 0:a.permissions,p=[{title:"#",key:"row_number",sortable:!0},{title:"Items",key:"image_cover",render:t=>{var i;return e.jsx(Ms,{image:((i=t.primary_image)==null?void 0:i.image_cover)??ys("media/products/default.jpg"),mainTitle:t.name,subTitle:t.sku})}},{title:"QTY on hand",key:"quantity_on_hand",sortable:!0,render:t=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"d-flex flex-column align-items-start",children:[e.jsxs("span",{className:"mb-2",children:["QTY: ",t.quantity_on_hand]}),e.jsx(Ks,{color:t.stock_status.color,title:t.stock_status.title})]})})},{title:"Price",key:"cost_price",sortable:!0,render:t=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"d-flex flex-column align-items-start",children:[e.jsxs("span",{className:"mb-2",children:["Cost: ",e.jsx(ie,{value:t.cost_price||0})]}),e.jsxs("span",{className:"mb-2",children:["Selling: ",e.jsx(ie,{value:t.selling_price||0})]})]})})},{title:"Variants",key:"variants",render:t=>e.jsx("div",{className:"d-flex flex-column gap-1",children:t.variants&&t.variants.length>0?t.variants.map((i,c)=>e.jsxs("div",{className:"border rounded p-2 bg-light",children:[e.jsxs("div",{className:"fw-semibold small",children:["SKU: ",e.jsx("span",{className:"text-primary",children:i.sku})]}),e.jsxs("div",{className:"small",children:["Name: ",i.variant_name??"-"]}),e.jsxs("div",{className:"small",children:["Qty: ",e.jsx("span",{className:"fw-bold",children:i.quantity_on_hand??0})]})]},c)):e.jsx("span",{className:"text-muted small",children:"No variants"})})},{title:"Created At",key:"created_at_format",sortable:!0},{title:"Action",key:"id_encrypted",render:t=>e.jsx(zs,{restoreAction:n.includes("restore_product")?()=>u(t.id_encrypted,g,x):void 0})}];return e.jsx("div",{className:"table-responsive",children:r?e.jsx("div",{className:"alert alert-info",children:"Loading..."}):e.jsx(Vs,{data:s,columns:p,loading:r,pagination:l,sortColumn:h,sortDirection:v,onPageChange:o,onSortChange:m,onSearchChange:f})})},At=({onRefreshFirstTable:s})=>{const r=Ds("/admin/product/archived/list"),{restoreProduct:l}=os();return e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsx(qt,{data:r.data,loading:r.loading,pagination:r.pagination,sortColumn:r.sortColumn,sortDirection:r.sortDirection,onPageChange:r.setPage,onSortChange:(h,v)=>{r.setSortColumn(h),r.setSortDirection(v)},onRestore:l,onSearchChange:h=>{r.setPage(1),r.setSearch(h)},setRefreshTable:r.setRefreshTable,setRefreshFirstTable:s})})})},Pt=({preview:s,index:r,allImages:l})=>{const[h,v]=d.useState(null);return e.jsxs("div",{children:[e.jsx("img",{src:s,alt:`Preview ${r}`,className:"img-thumbnail preview-image",onClick:()=>v(r),style:{width:130,height:130,objectFit:"cover",borderRadius:8,cursor:"pointer"}}),h!==null&&e.jsx(nt,{open:h!==null,close:()=>v(null),index:h,slides:l.filter(Boolean).map(o=>({src:o}))})]})},Os=[{label:"Basic Info"},{label:"Inventory & Pricing"},{label:"Images"},{label:"Addons"},{label:"Variants"}],$t=({data:s})=>{var h,v,o;const[r,l]=d.useState(1);return d.useState(((h=s==null?void 0:s.images)==null?void 0:h.map(m=>m.image_cover))||[]),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"d-flex justify-content-between align-items-center mb-2",children:Os.map((m,u)=>e.jsx("div",{onClick:()=>l(u+1),className:`flex-fill text-center cursor-pointer ${r===u+1?"fw-bold text-primary":"text-muted"}`,children:m.label},u))}),e.jsx("div",{className:"progress",style:{height:"6px"},children:e.jsx("div",{className:"progress-bar bg-primary",role:"progressbar",style:{width:`${r/Os.length*100}%`}})})]}),r===1&&e.jsxs("div",{className:"row",children:[e.jsx("hr",{}),e.jsx("div",{className:"col-md-12 mb-3",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("span",{className:"fw-bold me-2",children:"SKU:"}),e.jsx("span",{children:s.sku||"-"})]})}),e.jsx("div",{className:"col-md-12 mb-3",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("span",{className:"fw-bold me-2",children:"Product Name:"}),e.jsx("span",{children:s.name||"-"})]})}),e.jsx("div",{className:"col-md-12 mb-3",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("span",{className:"fw-bold me-2",children:"Supplier:"}),e.jsx("span",{children:s.supplier.name||"-"})]})}),e.jsx("div",{className:"col-md-12 mb-3",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("span",{className:"fw-bold me-2",children:"Brand:"}),e.jsx("span",{children:s.brand.name||"-"})]})}),e.jsx("div",{className:"col-md-12 mb-3",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("span",{className:"fw-bold me-2",children:"Category:"}),e.jsx("span",{children:s.category.name||"-"})]})}),e.jsx("hr",{}),e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("span",{className:"fw-bold me-2",children:"Description:"}),e.jsx("div",{className:"form-control-plaintext",children:s.description||"-"})]})]}),r===2&&e.jsxs("div",{className:"row",children:[e.jsx("hr",{}),e.jsx("div",{className:"col-md-12 mb-3",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("span",{className:"fw-bold me-2",children:"Quantity on Hand:"}),e.jsx("span",{children:s.quantity_on_hand||"-"})]})}),e.jsx("div",{className:"col-md-12 mb-3",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("span",{className:"fw-bold me-2",children:"Reorder Point:"}),e.jsx("span",{children:s.reorder_point||"-"})]})}),e.jsx("div",{className:"col-md-12 mb-3",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("span",{className:"fw-bold me-2",children:"Cost Price:"}),e.jsx("span",{children:e.jsx(ie,{value:s.cost_price})})]})}),e.jsx("div",{className:"col-md-12 mb-3",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("span",{className:"fw-bold me-2",children:"Selling Price:"}),e.jsx("span",{children:e.jsx(ie,{value:s.selling_price})})]})}),e.jsx("hr",{})]}),r===3&&(s.images.length>0?e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("hr",{}),e.jsx("label",{className:"form-label fw-bold",children:"Images"}),e.jsx("div",{className:"d-flex gap-2 flex-wrap",children:s.images.map((m,u)=>e.jsx(Pt,{preview:m.image_cover,index:u,allImages:s.images.map(f=>f.image_cover)},u))}),e.jsx("hr",{})]}):e.jsx("div",{className:"col-md-12 mb-3",children:e.jsxs("div",{className:"alert alert-secondary text-center rounded-3 py-4 shadow-sm",children:[e.jsx("i",{className:"bi bi-plus-circle fs-3 d-block mb-2 text-muted"}),e.jsx("span",{className:"fw-semibold text-muted",children:"No images added yet."})]})})),r===4&&e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("h6",{className:"fw-bold mb-3",children:"Addons"}),((v=s.product_addons)==null?void 0:v.length)>0?e.jsx("div",{className:"list-group shadow-sm rounded-3",children:s.product_addons.map((m,u)=>{var f;return e.jsxs("div",{children:[e.jsxs("div",{className:"list-group-item d-flex justify-content-between align-items-center  border-success",children:[e.jsx("div",{children:e.jsx("div",{className:"fw-semibold text-dark",children:((f=m.addon)==null?void 0:f.name)||`Addon #${u+1}`})}),e.jsx("div",{className:"fw-semibold",children:m.addon.is_freebies==="Y"?e.jsx("span",{className:"badge bg-success",children:"Freebie"}):e.jsx("span",{className:"text-dark",children:e.jsx(ie,{value:m.custom_price||m.addon.base_price||0})})})]}),u<s.product_addons.length-1&&e.jsx("hr",{className:"my-1 text-muted opacity-25"})]},u)})}):e.jsxs("div",{className:"alert alert-secondary text-center rounded-3 py-4 shadow-sm",children:[e.jsx("i",{className:"bi bi-gift fs-3 d-block mb-2 text-muted"}),e.jsx("span",{className:"fw-semibold text-muted",children:"No addons added yet."})]})]}),r===5&&e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("h6",{className:"fw-bold mb-3",children:"Variants"}),((o=s.variants)==null?void 0:o.length)>0?e.jsx("div",{className:"row g-3",children:s.variants.map((m,u)=>e.jsx("div",{className:"col-md-6",children:e.jsx("div",{className:"card shadow-sm h-100 border-success",children:e.jsxs("div",{className:"card-body d-flex justify-content-between align-items-start",children:[e.jsxs("div",{className:"flex-grow-1 pe-3",children:[e.jsx("h6",{className:"fw-semibold mb-1",children:m.variant_name||"-"}),e.jsxs("p",{className:"text-muted small mb-2",children:["SKU: ",m.sku||"-"]}),e.jsxs("div",{className:"d-flex justify-content-between small mb-1",children:[e.jsx("span",{className:"text-muted",children:"Quantity:"}),e.jsx("span",{className:"fw-semibold",children:m.quantity_on_hand??0})]}),e.jsxs("div",{className:"d-flex justify-content-between small mb-1",children:[e.jsx("span",{className:"text-muted",children:"Cost Price:"}),e.jsx("span",{className:"fw-semibold",children:e.jsx(ie,{value:m.cost_price||0})})]}),e.jsxs("div",{className:"d-flex justify-content-between small",children:[e.jsx("span",{className:"text-muted",children:"Selling Price:"}),e.jsx("span",{className:"fw-semibold",children:e.jsx(ie,{value:m.selling_price||0})})]})]}),e.jsx("div",{className:"ms-auto",children:e.jsx("img",{src:m.image_cover??ys("media/default.jpg"),alt:m.variant_name||"Variant Image",className:"rounded border",style:{width:"70px",height:"70px",objectFit:"cover"}})})]})})},u))}):e.jsxs("div",{className:"alert alert-secondary text-center rounded-3 py-4 shadow-sm",children:[e.jsx("i",{className:"bi bi-box-seam fs-3 d-block mb-2 text-muted"}),e.jsx("span",{className:"fw-semibold text-muted",children:"No variants added yet."})]})]})]})},Ft=()=>{const{currentUser:s}=fs(),r=s==null?void 0:s.permissions,l=Ds("/admin/product/list"),{viewProductDetails:h,archivedProduct:v}=os(),[o,m]=d.useState({visible:!1,title:"",body:e.jsx(e.Fragment,{}),className:"modal-xl",alignment:"centered"}),u=()=>{m({visible:!0,title:"Create Product",body:e.jsx(Et,{setPage:l.setPage,setRefreshTable:l.setRefreshTable}),className:"modal-xl",alignment:"centered"})},f=async a=>{const n=await h(a);n&&m({visible:!0,title:"Edit Product",body:e.jsx(Ct,{productID:a,data:n,setRefreshTable:l.setRefreshTable}),className:"modal-xl",alignment:"centered"})},g=async a=>{const n=await h(a);n&&m({visible:!0,title:"View Product Details",body:e.jsx($t,{data:n}),className:"modal-lg",alignment:"centered"})},x=async()=>{m({visible:!0,title:"Archived",body:e.jsx(At,{onRefreshFirstTable:l.setRefreshTable}),className:"modal-xl",alignment:"centered"})};return e.jsx(e.Fragment,{children:e.jsxs(tt,{children:[e.jsxs("div",{className:"card mb-5 mb-xl-8",children:[e.jsxs("div",{className:"card-header border-0 pt-5",children:[e.jsx("h3",{className:"card-title align-items-start flex-column",children:e.jsx("span",{className:"card-label fw-bold fs-3 mb-1",children:"Products"})}),e.jsxs("div",{className:"card-toolbar","data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-trigger":"hover",title:"Click to add a user",children:[r.includes("archived_product")&&e.jsxs("button",{onClick:()=>x(),className:"btn btn-sm btn-light-danger me-3",children:[e.jsx(Es,{iconName:"delete-files",className:"fs-3"}),"Archived"]}),r.includes("create_product")&&e.jsxs("button",{onClick:()=>u(),className:"btn btn-sm btn-light-primary",children:[e.jsx(Es,{iconName:"plus",className:"fs-3"}),"New Product"]})]})]}),e.jsx("div",{className:"card-body py-3",children:e.jsx("div",{className:"table-responsive",children:e.jsx(ut,{data:l.data,loading:l.loading,pagination:l.pagination,sortColumn:l.sortColumn,sortDirection:l.sortDirection,onPageChange:l.setPage,onSortChange:(a,n)=>{l.setSortColumn(a),l.setSortDirection(n)},onEdit:f,onView:g,onArchive:v,onSearchChange:a=>{l.setPage(1),l.setSearch(a)},setRefreshTable:l.setRefreshTable})})})]}),o.visible&&e.jsx(at,{title:o.title,body:o.body,modalClass:o.className,alignment:o.alignment,onClose:()=>m({visible:!1,title:"",body:e.jsx(e.Fragment,{}),className:"",alignment:"center"})})]})})},Bt=[{title:"Product List",path:"/product/list",isSeparator:!1,isActive:!1}],Kt=()=>e.jsxs(e.Fragment,{children:[e.jsx(rt,{breadcrumbs:Bt}),e.jsx(Ft,{})]});export{Kt as default};
