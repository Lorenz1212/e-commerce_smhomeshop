import{b as V,c as y,S as b,r as w,j as e,i as g,d as P,e as N,k as E,l as S,m as L,F as G,K as C,t as I,n as F,C as T,o as Y,g as H,R as W,h as D,O as X,P as R}from"./index-716f35f1.js";import{M as K}from"./ModalHandler-0e663310.js";import{a as B}from"./apiMultipart-e17508ae.js";import{M as O}from"./MulitpleImageUploader-c0e59034.js";import{P as z}from"./phoneNumber-91d548a9.js";import{S as Z}from"./react-select.esm-36797614.js";import{D as A,A as q}from"./ActionsCell-1ea9e971.js";import{I as _}from"./ImageTitleCell-de4f184b.js";const U=()=>{const{showLoader:n,hideLoader:s}=V();return{viewUserDetails:async d=>{var a,l;try{return n(),(await y.get(`/core/user/${d}/edit`)).data}catch(t){return b.fire({icon:"error",title:(l=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:l.message}),null}finally{s()}},createUser:async(d,a,l,t)=>{var c,o,i,x,v;try{n();const f=await B.post("/core/user/store",d);b.fire({icon:(c=f.data)==null?void 0:c.status,title:(o=f.data)==null?void 0:o.message}),((i=f.data)==null?void 0:i.status)=="success"&&(a(),l==null||l(!0),t==null||t(1))}catch(f){b.fire({icon:"error",title:(v=(x=f==null?void 0:f.response)==null?void 0:x.data)==null?void 0:v.message})}finally{s()}},updateUser:async(d,a,l)=>{var t,c,o,i;try{n();const x=await B.post(`/core/user/${a}/update`,d);b.fire({icon:(t=x.data)==null?void 0:t.status,title:(c=x.data)==null?void 0:c.message}),l==null||l(!0)}catch(x){console.log(x),b.fire({icon:"error",title:(i=(o=x==null?void 0:x.response)==null?void 0:o.data)==null?void 0:i.message})}finally{s()}},archivedUser:async(d,a)=>{var t,c,o,i;if((await b.fire({title:"Are you sure?",text:"This action will archive the user.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, archive it!"})).isConfirmed)try{n();const x=await y.delete(`/core/user/${d}/archive`);b.fire({icon:((t=x.data)==null?void 0:t.status)||"success",title:(c=x.data)==null?void 0:c.message}),a==null||a(!0)}catch(x){b.fire({icon:"error",title:((i=(o=x==null?void 0:x.response)==null?void 0:o.data)==null?void 0:i.message)||"An error occurred."})}finally{s()}},restoreUser:async(d,a,l)=>{var c,o,i,x;if((await b.fire({title:"Are you sure?",text:"This will restore the archived user.",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, restore it!"})).isConfirmed)try{n();const v=await y.post(`/core/user/${d}/restore`);b.fire({icon:((c=v.data)==null?void 0:c.status)||"success",title:((o=v.data)==null?void 0:o.message)||"User restored successfully."}),a==null||a(!0),l==null||l(!0)}catch(v){b.fire({icon:"error",title:((x=(i=v==null?void 0:v.response)==null?void 0:i.data)==null?void 0:x.message)||"Something went wrong."})}finally{s()}},resetPasswordUser:async(d,a)=>{var t,c,o,i;if((await b.fire({title:"Are you sure?",text:"This user will be reset password.",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, reset it!"})).isConfirmed)try{n();const x=await y.post(`/core/user/${d}/reset`);b.fire({icon:((t=x.data)==null?void 0:t.status)||"success",title:((c=x.data)==null?void 0:c.message)||"User reset password successfully."}),a==null||a(!0)}catch(x){b.fire({icon:"error",title:((i=(o=x==null?void 0:x.response)==null?void 0:o.data)==null?void 0:i.message)||"Something went wrong."})}finally{s()}}}};async function k(){try{const s=(await y.get("/core/roles")).data;return Array.isArray(s)?s:(console.warn("Unexpected response shape:",s),[])}catch(n){return console.error("Failed to fetch categories:",n),[]}}const J=({setClass:n,name:s,value:p,onChange:j,onBlur:m,error:u,touched:r})=>{const[h,d]=w.useState([]);return w.useEffect(()=>{k().then(a=>{const l=a.map(t=>({value:t.id,label:t.name}));d(l)}).catch(console.error)},[]),e.jsxs("div",{className:n,children:[e.jsx("label",{className:"form-label",children:"Roles"}),e.jsx(Z,{name:s,options:h,value:h.find(a=>a.value===p)||null,onChange:a=>j({target:{name:s,value:(a==null?void 0:a.value)||""}}),onBlur:m,className:g("form-select-solid text-dark",{"is-invalid":u&&r},{})}),u&&r&&e.jsx("div",{className:"invalid-feedback",children:u})]})},ee=P().shape({fname:N().required("First name is required"),lname:N().required("Last name is required"),contact_no:N().required("Contact number is required"),email:N().required("Email address is required"),gender:N().oneOf(["M","F"]).required("Gender is required"),birthdate:E().required("Birthdate is required"),modules:S().of(N()).min(1,"At least one module must be selected"),role_id:N().test("role-required-if-core","Role is required when Core module is selected",function(n){const{modules:s}=this.parent;return s!=null&&s.includes("core")?!!n:!0}),images:L().test("required","Image is required",n=>Array.isArray(n)&&n.length>0)}),se=({setPage:n,setRefreshTable:s,onSubmit:p})=>{const[j,m]=w.useState([]),{createUser:u}=U();return e.jsx(G,{initialValues:{fname:"",lname:"",mname:"",suffix:"",contact_no:"",email:"",gender:"",birthdate:"",address:"",role_id:"",modules:[],images:[]},validationSchema:ee,onSubmit:async(r,{resetForm:h})=>{await u(r,h,s,n),p==null||p(r)},children:r=>e.jsxs("form",{noValidate:!0,onSubmit:r.handleSubmit,children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-12",children:e.jsx("div",{className:"mb-3",children:e.jsx(O,{name:"images",formik:r,previews:j,setPreviews:m,label:"Profile Image",maxFiles:1})})}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"First Name"}),e.jsx("input",{type:"text",className:g("form-control",{"is-invalid":r.touched.fname&&r.errors.fname}),...r.getFieldProps("fname")}),r.touched.fname&&r.errors.fname&&e.jsx("div",{className:"invalid-feedback",children:r.errors.fname})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Middle Name"}),e.jsx("input",{type:"text",className:"form-control",...r.getFieldProps("mname")})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Last Name"}),e.jsx("input",{type:"text",className:g("form-control",{"is-invalid":r.touched.lname&&r.errors.lname}),...r.getFieldProps("lname")}),r.touched.lname&&r.errors.lname&&e.jsx("div",{className:"invalid-feedback",children:r.errors.lname})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Suffix"}),e.jsx("input",{type:"text",className:"form-control",...r.getFieldProps("suffix")})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Gender"}),e.jsxs("select",{className:g("form-select",{"is-invalid":r.touched.gender&&r.errors.gender}),...r.getFieldProps("gender"),children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"M",children:"Male"}),e.jsx("option",{value:"F",children:"Female"})]}),r.touched.gender&&typeof r.errors.gender=="string"&&e.jsx("div",{className:"invalid-feedback",children:r.errors.gender})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Birthdate"}),e.jsx("input",{type:"date",className:g("form-control",{"is-invalid":r.touched.birthdate&&r.errors.birthdate}),...r.getFieldProps("birthdate")}),r.touched.birthdate&&typeof r.errors.birthdate=="string"&&e.jsx("div",{className:"invalid-feedback",children:r.errors.birthdate})]}),e.jsx(z,{setClass:"col-md-12 mb-3",labelName:"Contact Number",name:"contact_no",data:r.values.contact_no,setFieldValue:r.setFieldValue,error:r.errors.contact_no,touched:r.touched.contact_no}),e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label",children:"Email Address"}),e.jsx("input",{type:"email",className:g("form-control",{"is-invalid":r.touched.email&&r.errors.email}),...r.getFieldProps("email")}),r.touched.email&&r.errors.email&&e.jsx("div",{className:"invalid-feedback",children:r.errors.email})]}),e.jsxs("div",{className:"col-md-12 mb-5",children:[e.jsx("label",{className:"form-label",children:"Address"}),e.jsx("textarea",{rows:3,className:g("form-control"),...r.getFieldProps("address")})]})]}),e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("div",{children:e.jsx("label",{className:"form-label fw-bold me-5",children:"Modules"})}),e.jsxs("div",{className:"form-check form-check-inline",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"module-cashier",value:"cashier",checked:r.values.modules.includes("cashier"),onChange:()=>{const h=[...r.values.modules];h.includes("cashier")?r.setFieldValue("modules",h.filter(d=>d!=="cashier")):(h.push("cashier"),r.setFieldValue("modules",h))}}),e.jsx("label",{className:"form-check-label",htmlFor:"module-cashier",children:"Cashier"}),e.jsx("div",{className:"form-text",children:"Grants access to the cashier portal for handling transactions."})]}),e.jsxs("div",{className:"form-check form-check-inline",children:[e.jsx("input",{className:"form-check-input mb-10",type:"checkbox",id:"module-core",value:"core",checked:r.values.modules.includes("core"),onChange:()=>{const h=[...r.values.modules];h.includes("core")?r.setFieldValue("modules",h.filter(d=>d!=="core")):(h.push("core"),r.setFieldValue("modules",h))}}),e.jsx("label",{className:"form-check-label",htmlFor:"module-core",children:"Core"}),e.jsx("div",{className:"form-text",children:"Grants access to core system features. Selecting this will enable Role selection."})]}),r.touched.modules&&r.errors.modules&&e.jsx("div",{className:"text-danger small",children:r.errors.modules})]}),r.values.modules.includes("core")&&e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx(J,{setClass:"mb-3",name:"role_id",value:r.values.role_id,onChange:r.handleChange,onBlur:r.handleBlur,error:r.errors.role_id,touched:r.touched.role_id}),r.touched.role_id&&r.errors.role_id&&e.jsx("div",{className:"invalid-feedback",children:r.errors.role_id})]})]}),e.jsx("div",{className:"d-flex justify-content-end mt-4",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Submit"})})]})})},ae=({userID:n,data:s,setRefreshTable:p,onSubmit:j})=>{var d;const[m,u]=w.useState((d=s==null?void 0:s.personal_info)!=null&&d.image_cover?[s.personal_info.image_cover]:[]),{updateUser:r}=U(),h=P().shape({fname:N().required("First name is required"),lname:N().required("Last name is required"),contact_no:N().required("Contact number is required"),email:N().required("Email address is required"),gender:N().oneOf(["M","F"]).required("Gender is required"),birthdate:E().required("Birthdate is required"),modules:S().of(N()).min(1,"At least one module must be selected"),role_id:N().test("role-required-if-core","Role is required when Core module is selected",function(a){const{modules:l}=this.parent;return l!=null&&l.includes("core")?!!a:!0}),images:L()});return e.jsx(G,{initialValues:{fname:s.personal_info.fname||"",lname:s.personal_info.lname||"",mname:s.personal_info.mname||"",suffix:s.personal_info.suffix||"",contact_no:s.personal_info.contact_no||"",email:s.user.email||"",gender:s.personal_info.gender||"",birthdate:s.personal_info.birthdate||"",address:s.personal_info.address||"",role_id:s.role?s.role:"",modules:[...s.modules,...s.role?["core"]:[]],images:[]},validationSchema:h,onSubmit:async(a,{resetForm:l})=>{await r(a,n,p),j==null||j(a)},children:a=>e.jsxs("form",{noValidate:!0,onSubmit:a.handleSubmit,children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-12",children:e.jsx("div",{className:"mb-3",children:e.jsx(O,{name:"images",formik:a,previews:m,setPreviews:u,label:"Profile Image",maxFiles:1})})}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"First Name"}),e.jsx("input",{type:"text",className:g("form-control",{"is-invalid":a.touched.fname&&a.errors.fname}),...a.getFieldProps("fname")}),a.touched.fname&&typeof a.errors.fname=="string"&&e.jsx("div",{className:"invalid-feedback",children:a.errors.fname})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Middle Name"}),e.jsx("input",{type:"text",className:"form-control",...a.getFieldProps("mname")})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Last Name"}),e.jsx("input",{type:"text",className:g("form-control",{"is-invalid":a.touched.lname&&a.errors.lname}),...a.getFieldProps("lname")}),a.touched.lname&&typeof a.errors.lname=="string"&&e.jsx("div",{className:"invalid-feedback",children:a.errors.lname})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Suffix"}),e.jsx("input",{type:"text",className:"form-control",...a.getFieldProps("suffix")})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Gender"}),e.jsxs("select",{className:g("form-select",{"is-invalid":a.touched.gender&&a.errors.gender}),...a.getFieldProps("gender"),children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"M",children:"Male"}),e.jsx("option",{value:"F",children:"Female"})]}),a.touched.gender&&typeof a.errors.gender=="string"&&e.jsx("div",{className:"invalid-feedback",children:a.errors.gender})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Birthdate"}),e.jsx("input",{type:"date",className:g("form-control",{"is-invalid":a.touched.birthdate&&a.errors.birthdate}),...a.getFieldProps("birthdate")}),a.touched.birthdate&&typeof a.errors.birthdate=="string"&&e.jsx("div",{className:"invalid-feedback",children:a.errors.birthdate})]}),e.jsx(z,{setClass:"col-md-12 mb-3",labelName:"Contact Number",name:"contact_no",data:a.values.contact_no,setFieldValue:a.setFieldValue,error:a.errors.contact_no,touched:!!a.touched.contact_no}),e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label",children:"Email Address"}),e.jsx("input",{type:"email",className:g("form-control",{"is-invalid":a.touched.email&&a.errors.email}),...a.getFieldProps("email")}),a.touched.email&&typeof a.errors.email=="string"&&e.jsx("div",{className:"invalid-feedback",children:a.errors.email})]}),e.jsxs("div",{className:"col-md-12 mb-5",children:[e.jsx("label",{className:"form-label",children:"Address"}),e.jsx("textarea",{rows:3,className:g("form-control"),...a.getFieldProps("address")})]})]}),e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("div",{children:e.jsx("label",{className:"form-label fw-bold me-5",children:"Modules"})}),e.jsxs("div",{className:"form-check form-check-inline",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"module-cashier",value:"cashier",checked:a.values.modules.includes("cashier"),onChange:()=>{const l=[...a.values.modules];l.includes("cashier")?a.setFieldValue("modules",l.filter(t=>t!=="cashier")):(l.push("cashier"),a.setFieldValue("modules",l))}}),e.jsx("label",{className:"form-check-label",htmlFor:"module-cashier",children:"Cashier"}),e.jsx("div",{className:"form-text",children:"Grants access to the cashier portal for handling transactions."})]}),e.jsxs("div",{className:"form-check form-check-inline",children:[e.jsx("input",{className:"form-check-input mb-10",type:"checkbox",id:"module-core",value:"core",checked:a.values.modules.includes("core"),onChange:()=>{const l=[...a.values.modules];l.includes("core")?a.setFieldValue("modules",l.filter(t=>t!=="core")):(l.push("core"),a.setFieldValue("modules",l))}}),e.jsx("label",{className:"form-check-label",htmlFor:"module-core",children:"Core"}),e.jsx("div",{className:"form-text",children:"Grants access to core system features. Selecting this will enable Role selection."})]}),a.touched.modules&&a.errors.modules&&e.jsx("div",{className:"text-danger small",children:a.errors.modules})]}),a.values.modules.includes("core")&&e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx(J,{setClass:"mb-3",name:"role_id",value:a.values.role_id,onChange:a.handleChange,onBlur:a.handleBlur,error:a.errors.role_id&&typeof a.errors.role_id=="string"?a.errors.role_id:void 0,touched:!!a.touched.role_id}),a.touched.role_id&&typeof a.errors.role_id=="string"&&e.jsx("div",{className:"invalid-feedback",children:a.errors.role_id})]})]}),e.jsx("div",{className:"d-flex justify-content-end mt-4",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Submit"})})]})})},re=({data:n})=>{const{personal_info:s,user:p,modules:j,role_name:m}=n;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex align-items-center mb-4",children:[e.jsx("img",{src:s.image_cover||"/placeholder-profile.png",alt:"Profile",className:"rounded-circle me-3",style:{width:80,height:80,objectFit:"cover"}}),e.jsxs("div",{children:[e.jsx("h5",{className:"mb-0",children:s.full_name}),e.jsx("small",{className:"text-muted",children:m??"Cashier"})]})]}),e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-sm-4 text-muted",children:"Email"}),e.jsx("div",{className:"col-sm-8 fw-semibold",children:p.email})]}),e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-sm-4 text-muted",children:"Contact No"}),e.jsx("div",{className:"col-sm-8 fw-semibold",children:s.contact_no})]}),e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-sm-4 text-muted",children:"Birthdate"}),e.jsx("div",{className:"col-sm-8 fw-semibold",children:s.birth_date_format})]}),e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-sm-4 text-muted",children:"Gender"}),e.jsx("div",{className:"col-sm-8 fw-semibold",children:s.gender==="M"?"Male":"Female"})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-sm-4 text-muted",children:"Address"}),e.jsx("div",{className:"col-sm-8 fw-semibold",children:s.address})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-sm-4 text-muted",children:"Cashier"}),e.jsx("div",{className:"col-sm-8",children:j.length?e.jsx(C,{iconName:"check-circle",className:"fs-2 text-success"}):e.jsx("span",{className:"text-muted",children:"None"})})]})]})},le=({data:n,loading:s,pagination:p,sortColumn:j,sortDirection:m,onPageChange:u,onSortChange:r,onRestore:h,onSearchChange:d,setRefreshTable:a,setRefreshFirstTable:l})=>{const t=[{title:"#",key:"row_number",sortable:!0},{title:"User",key:"image_cover",render:c=>e.jsx(_,{image:c.image_cover??I("media/products/default.jpg"),mainTitle:c.full_name,subTitle:c.account_no})},{title:"Contact Info",key:"email",sortable:!0,render:c=>e.jsx(_,{mainTitle:c.user.email,subTitle:c.contant_no??"No Mobile Number Available"})},{title:"Gender",key:"gender_text_format",sortable:!0},{title:"Birth Date",key:"birth_date_format",sortable:!0},{title:"Action",key:"id_encrypted",render:c=>e.jsx(q,{restoreAction:()=>h(c.id_encrypted,a,l)})}];return e.jsx("div",{className:"table-responsive",children:s?e.jsx("div",{className:"alert alert-info",children:"Loading..."}):e.jsx(A,{data:n,columns:t,loading:s,pagination:p,sortColumn:j,sortDirection:m,onPageChange:u,onSortChange:r,onSearchChange:d})})},te=({onRefreshFirstTable:n})=>{const s=F("/core/user/archived/list"),{restoreUser:p}=U();return e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsx(le,{data:s.data,loading:s.loading,pagination:s.pagination,sortColumn:s.sortColumn,sortDirection:s.sortDirection,onPageChange:s.setPage,onSortChange:(j,m)=>{s.setSortColumn(j),s.setSortDirection(m)},onRestore:p,onSearchChange:j=>{s.setPage(1),s.setSearch(j)},setRefreshTable:s.setRefreshTable,setRefreshFirstTable:n})})})},ie=({data:n,loading:s,pagination:p,sortColumn:j,sortDirection:m,onPageChange:u,onSortChange:r,onEdit:h,onView:d,onArchive:a,onResetPassword:l,onSearchChange:t,setRefreshTable:c})=>{const o=[{title:"#",key:"row_number",sortable:!0},{title:"User",key:"image_cover",render:i=>e.jsx(_,{image:i.image_cover??I("media/products/default.jpg"),mainTitle:i.full_name,subTitle:i.account_no})},{title:"Contact Info",key:"email",sortable:!0,render:i=>e.jsx(_,{mainTitle:i.user.email,subTitle:i.contant_no??"No Mobile Number Available"})},{title:"Gender",key:"gender_text_format",sortable:!0},{title:"Birth Date",key:"birth_date_format",sortable:!0},{title:"Action",key:"id_encrypted",render:i=>e.jsx(q,{openDetailsModal:()=>d(i.id_encrypted),openEditModal:()=>h(i.id_encrypted),archiveAction:()=>a(i.id_encrypted,c),resetAction:()=>l(i.id_encrypted,c)})}];return e.jsx("div",{className:"table-responsive",children:s?e.jsx("div",{className:"alert alert-info",children:"Loading..."}):e.jsx(A,{data:n,columns:o,loading:s,pagination:p,sortColumn:j,sortDirection:m,onPageChange:u,onSortChange:r,onSearchChange:t})})},ne=({title:n})=>{const s=F("/core/user/list"),{viewUserDetails:p,archivedUser:j,resetPasswordUser:m}=U(),[u,r]=w.useState({visible:!1,title:"",body:e.jsx(e.Fragment,{}),className:"modal-xl",alignment:"centered"}),h=()=>{r({visible:!0,title:`Create ${n}`,body:e.jsx(se,{setPage:s.setPage,setRefreshTable:s.setRefreshTable}),className:"modal-xl",alignment:"centered"})},d=async t=>{const c=await p(t);c&&r({visible:!0,title:`Edit ${n}`,body:e.jsx(ae,{userID:t,data:c,setRefreshTable:s.setRefreshTable}),className:"modal-xl",alignment:"centered"})},a=async t=>{const c=await p(t);c&&r({visible:!0,title:`View ${n} Details`,body:e.jsx(re,{data:c}),className:"modal-md",alignment:"centered"})},l=async()=>{r({visible:!0,title:"Archived",body:e.jsx(te,{onRefreshFirstTable:s.setRefreshTable}),className:"modal-xl",alignment:"centered"})};return e.jsx(e.Fragment,{children:e.jsxs(T,{children:[e.jsxs("div",{className:"card mb-5 mb-xl-8",children:[e.jsxs("div",{className:"card-header border-0 pt-5",children:[e.jsx("h3",{className:"card-title align-items-start flex-column",children:e.jsxs("span",{className:"card-label fw-bold fs-3 mb-1",children:[n,"s"]})}),e.jsxs("div",{className:"card-toolbar","data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-trigger":"hover",title:`Click to add a ${n.toLowerCase()}`,children:[e.jsxs("button",{onClick:()=>l(),className:"btn btn-sm btn-light-danger me-3",children:[e.jsx(C,{iconName:"delete-files",className:"fs-3"}),"Archived"]}),e.jsxs("button",{onClick:()=>h(),className:"btn btn-sm btn-light-primary",children:[e.jsx(C,{iconName:"plus",className:"fs-3"}),"New ",n]})]})]}),e.jsx("div",{className:"card-body py-3",children:e.jsx("div",{className:"table-responsive",children:e.jsx(ie,{data:s.data,loading:s.loading,pagination:s.pagination,sortColumn:s.sortColumn,sortDirection:s.sortDirection,onPageChange:s.setPage,onSortChange:(t,c)=>{s.setSortColumn(t),s.setSortDirection(c)},onEdit:d,onView:a,onArchive:j,onResetPassword:m,onSearchChange:t=>{s.setPage(1),s.setSearch(t)},setRefreshTable:s.setRefreshTable})})})]}),u.visible&&e.jsx(K,{title:u.title,body:u.body,modalClass:u.className,alignment:u.alignment,onClose:()=>r({visible:!1,title:"",body:e.jsx(e.Fragment,{}),className:"",alignment:"center"})})]})})},M=()=>{const{showLoader:n,hideLoader:s}=V();return{viewRoleDetails:async h=>{var d,a;try{return n(),(await y.get(`/core/role/${h}/edit`)).data}catch(l){return b.fire({icon:"error",title:(a=(d=l==null?void 0:l.response)==null?void 0:d.data)==null?void 0:a.message}),null}finally{s()}},createRole:async(h,d,a,l)=>{var t,c,o,i,x;try{n();const v=await B.post("/core/role/store",h);b.fire({icon:(t=v.data)==null?void 0:t.status,title:(c=v.data)==null?void 0:c.message}),((o=v.data)==null?void 0:o.status)=="success"&&(d(),a==null||a(!0),l==null||l(1))}catch(v){b.fire({icon:"error",title:(x=(i=v==null?void 0:v.response)==null?void 0:i.data)==null?void 0:x.message})}finally{s()}},updateRole:async(h,d,a)=>{var l,t,c,o;try{n();const i=await y.put(`/core/role/${d}/update`,h);b.fire({icon:(l=i.data)==null?void 0:l.status,title:(t=i.data)==null?void 0:t.message}),a==null||a(!0)}catch(i){console.log(i),b.fire({icon:"error",title:(o=(c=i==null?void 0:i.response)==null?void 0:c.data)==null?void 0:o.message})}finally{s()}},archivedRole:async(h,d)=>{var l,t,c,o;if((await b.fire({title:"Are you sure?",text:"This action will archive the role.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, archive it!"})).isConfirmed)try{n();const i=await y.delete(`/core/role/${h}/archive`);b.fire({icon:((l=i.data)==null?void 0:l.status)||"success",title:(t=i.data)==null?void 0:t.message}),d==null||d(!0)}catch(i){b.fire({icon:"error",title:((o=(c=i==null?void 0:i.response)==null?void 0:c.data)==null?void 0:o.message)||"An error occurred."})}finally{s()}},restoreRole:async(h,d,a)=>{var t,c,o,i;if((await b.fire({title:"Are you sure?",text:"This will restore the archived role.",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, restore it!"})).isConfirmed)try{n();const x=await y.post(`/core/role/${h}/restore`);b.fire({icon:((t=x.data)==null?void 0:t.status)||"success",title:((c=x.data)==null?void 0:c.message)||"Role restored successfully."}),d==null||d(!0),a==null||a(!0)}catch(x){b.fire({icon:"error",title:((i=(o=x==null?void 0:x.response)==null?void 0:o.data)==null?void 0:i.message)||"Something went wrong."})}finally{s()}}}};async function ce(){try{const s=(await y.get("/core/permissions")).data;return Array.isArray(s)?s:(console.warn("Unexpected response shape:",s),[])}catch(n){return console.error("Failed to fetch categories:",n),[]}}const Q=({selected:n,onChange:s})=>{const[p,j]=w.useState([]),[m,u]=w.useState({}),[r,h]=w.useState({});w.useEffect(()=>{ce().then(l=>{const t=l.map(i=>({id:i.id,label:i.name,permissions:i.permissions||[]}));j(t);const c={},o={};t.forEach(i=>{const x=i.permissions.find(v=>v.name.toLowerCase()==="view list");if(x){const v=i.permissions.filter(f=>f.id!==x.id).map(f=>f.id);c[x.id]=v,v.forEach(f=>{o[f]=x.id})}}),u(c),h(o)}).catch(console.error)},[]);const d=l=>{let t=[...n];t.includes(l)?(t=t.filter(c=>c!==l),m[l]&&(t=t.filter(c=>!m[l].includes(c)))):(t.push(l),r[l]&&t.push(r[l])),t=[...new Set(t)],s(t)},a=l=>{const t=l.map(o=>o.id);if(t.every(o=>n.includes(o))){let o=n.filter(i=>!t.includes(i));t.forEach(i=>{m[i]&&(o=o.filter(x=>!m[i].includes(x)))}),s(o)}else{const o=[...new Set([...n,...t])];s(o)}};return e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Permissions"}),e.jsx("div",{className:"row",children:p.map(l=>{const t=l.permissions.map(i=>i.id),c=t.every(i=>n.includes(i)),o=t.some(i=>n.includes(i));return e.jsx("div",{className:"col-md-4 mb-3",children:e.jsxs("div",{className:"card shadow p-3 h-100",children:[e.jsxs("div",{className:"form-check mb-5",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:`group-${l.id}`,checked:c,ref:i=>{i&&(i.indeterminate=!c&&o)},onChange:()=>a(l.permissions)}),e.jsx("label",{className:"form-check-label fw-bold",htmlFor:`group-${l.id}`,children:l.label})]}),l.permissions.map(i=>e.jsxs("div",{className:"form-check ms-8 mb-4",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:`perm-${i.id}`,checked:n.includes(i.id),onChange:()=>d(i.id)}),e.jsx("label",{className:"form-check-label",htmlFor:`perm-${i.id}`,children:i.name})]},i.id))]})},l.id)})})]})},oe=P().shape({name:N().min(1,"Minimum 1 character").max(50,"Maximum 50 characters").required("Role name is required"),permissions:S().of(Y()).min(1,"At least 1 permission is required")}),de=({setPage:n,setRefreshTable:s,onSubmit:p})=>{const{createRole:j}=M(),m=H({initialValues:{name:"",permissions:[]},validationSchema:oe,onSubmit:async(u,{resetForm:r})=>{await j(u,r,s,n),p==null||p(u)}});return e.jsxs("form",{className:"form",noValidate:!0,onSubmit:m.handleSubmit,children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label",children:"Role Name"}),e.jsx("input",{type:"text",className:g("form-control",{"is-invalid":m.touched.name&&m.errors.name}),...m.getFieldProps("name")}),m.touched.name&&m.errors.name&&e.jsx("div",{className:"invalid-feedback",children:m.errors.name})]}),e.jsxs("div",{className:"col-md-12",children:[e.jsx(Q,{selected:m.values.permissions,onChange:u=>m.setFieldValue("permissions",u)}),m.touched.permissions&&m.errors.permissions&&e.jsx("div",{className:"text-danger small",children:m.errors.permissions})]})]}),e.jsx("div",{className:"d-flex justify-content-end mt-4",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Save"})})]})},me=P().shape({name:N().min(1,"Minimum 1 character").max(50,"Maximum 50 characters").required("Role name is required"),permissions:S().of(Y()).min(1,"At least 1 permission is required")}),ue=({roleID:n,data:s,setRefreshTable:p,onSubmit:j})=>{var r;const{updateRole:m}=M(),u=H({initialValues:{name:s.name,permissions:((r=s==null?void 0:s.permissions)==null?void 0:r.flatMap(h=>h.permissions.map(d=>d.id)))||[]},validationSchema:me,onSubmit:async(h,{resetForm:d})=>{await await m(h,n,p),j==null||j(h)}});return e.jsxs("form",{className:"form",noValidate:!0,onSubmit:u.handleSubmit,children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label",children:"Role Name"}),e.jsx("input",{type:"text",className:g("form-control",{"is-invalid":u.touched.name&&u.errors.name}),...u.getFieldProps("name")}),u.touched.name&&typeof u.errors.name=="string"&&e.jsx("div",{className:"invalid-feedback",children:u.errors.name})]}),e.jsxs("div",{className:"col-md-12",children:[e.jsx(Q,{selected:u.values.permissions,onChange:h=>u.setFieldValue("permissions",h)}),u.touched.permissions&&u.errors.permissions&&e.jsx("div",{className:"text-danger small",children:u.errors.permissions})]})]}),e.jsx("div",{className:"d-flex justify-content-end mt-4",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Save"})})]})},he=({data:n})=>e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"",children:["Role Name: ",e.jsx("span",{className:"fw-semibold fs-4",children:n.name})]})}),e.jsxs("div",{children:[e.jsx("h6",{className:"text-muted mb-3",children:"Permissions"}),e.jsxs("div",{className:"row g-3",children:[n.permissions.map(s=>e.jsx("div",{className:"col-md-6 col-lg-4",children:e.jsx("div",{className:"card shadow h-100 border-0",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h6",{className:"fw-bold mb-3",children:s.name}),e.jsx("div",{className:"d-flex flex-wrap gap-2",children:s.permissions.map(p=>e.jsx("span",{className:"badge bg-primary bg-opacity-75 text-white rounded-pill px-3 py-2",children:p.name},p.id))})]})})},s.id)),n.permissions.length===0&&e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"alert alert-secondary mb-0",children:"No permissions assigned to this role."})})]})]})]}),xe=({data:n,loading:s,pagination:p,sortColumn:j,sortDirection:m,onPageChange:u,onSortChange:r,onRestore:h,onSearchChange:d,setRefreshTable:a,setRefreshFirstTable:l})=>{const t=[{title:"#",key:"row_number",sortable:!0},{title:"Name",key:"name",sortable:!0},{title:"Permissions",key:"permissionParents",render:c=>!c.permissionParents||c.permissionParents.length===0?e.jsx("span",{className:"text-muted",children:"No permissions"}):e.jsx("div",{className:"d-flex flex-wrap gap-1",children:c.permissionParents.map((o,i)=>e.jsx("span",{className:"badge bg-primary",children:o.name},i))})},{title:"Action",key:"id_encrypted",render:c=>e.jsx(q,{restoreAction:()=>h(c.id_encrypted,a,l)})}];return e.jsx("div",{className:"table-responsive",children:s?e.jsx("div",{className:"alert alert-info",children:"Loading..."}):e.jsx(A,{data:n,columns:t,loading:s,pagination:p,sortColumn:j,sortDirection:m,onPageChange:u,onSortChange:r,onSearchChange:d})})},pe=({onRefreshFirstTable:n})=>{const s=F("/core/role/archived/list"),{restoreRole:p}=M();return e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsx(xe,{data:s.data,loading:s.loading,pagination:s.pagination,sortColumn:s.sortColumn,sortDirection:s.sortDirection,onPageChange:s.setPage,onSortChange:(j,m)=>{s.setSortColumn(j),s.setSortDirection(m)},onRestore:p,onSearchChange:j=>{s.setPage(1),s.setSearch(j)},setRefreshTable:s.setRefreshTable,setRefreshFirstTable:n})})})},je=({data:n,loading:s,pagination:p,sortColumn:j,sortDirection:m,onPageChange:u,onSortChange:r,onEdit:h,onView:d,onArchive:a,onSearchChange:l,setRefreshTable:t})=>{const c=[{title:"#",key:"row_number",sortable:!0},{title:"Name",key:"name",sortable:!0},{title:"Permissions",key:"permissionParents",render:o=>!o.permissionParents||o.permissionParents.length===0?e.jsx("span",{className:"text-muted",children:"No permissions"}):e.jsx("div",{className:"d-flex flex-wrap gap-1",children:o.permissionParents.map((i,x)=>e.jsx("span",{className:"badge bg-primary",children:i.name},x))})},{title:"Action",key:"id_encrypted",render:o=>e.jsx(q,{openDetailsModal:()=>d(o.id_encrypted),openEditModal:()=>h(o.id_encrypted),archiveAction:()=>a(o.id_encrypted,t)})}];return e.jsx("div",{className:"table-responsive",children:s?e.jsx("div",{className:"alert alert-info",children:"Loading..."}):e.jsx(A,{data:n,columns:c,loading:s,pagination:p,sortColumn:j,sortDirection:m,onPageChange:u,onSortChange:r,onSearchChange:l})})},be=({title:n})=>{const s=F("/core/role/list"),{viewRoleDetails:p,archivedRole:j}=M(),[m,u]=w.useState({visible:!1,title:"",body:e.jsx(e.Fragment,{}),className:"modal-xl",alignment:"centered"}),r=()=>{u({visible:!0,title:`Create ${n}`,body:e.jsx(de,{setPage:s.setPage,setRefreshTable:s.setRefreshTable}),className:"modal-xl",alignment:"centered"})},h=async l=>{const t=await p(l);t&&u({visible:!0,title:`Edit ${n}`,body:e.jsx(ue,{roleID:l,data:t,setRefreshTable:s.setRefreshTable}),className:"modal-xl",alignment:"centered"})},d=async l=>{const t=await p(l);t&&u({visible:!0,title:`View ${n} Details`,body:e.jsx(he,{data:t}),className:"modal-xl",alignment:"centered"})},a=async()=>{u({visible:!0,title:"Archived",body:e.jsx(pe,{onRefreshFirstTable:s.setRefreshTable}),className:"modal-xl",alignment:"centered"})};return e.jsx(e.Fragment,{children:e.jsxs(T,{children:[e.jsxs("div",{className:"card mb-5 mb-xl-8",children:[e.jsxs("div",{className:"card-header border-0 pt-5",children:[e.jsx("h3",{className:"card-title align-items-start flex-column",children:e.jsxs("span",{className:"card-label fw-bold fs-3 mb-1",children:[n,"s"]})}),e.jsxs("div",{className:"card-toolbar","data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-trigger":"hover",title:`Click to add a ${n.toLowerCase()}`,children:[e.jsxs("button",{onClick:()=>a(),className:"btn btn-sm btn-light-danger me-3",children:[e.jsx(C,{iconName:"delete-files",className:"fs-3"}),"Archived"]}),e.jsxs("button",{onClick:()=>r(),className:"btn btn-sm btn-light-primary",children:[e.jsx(C,{iconName:"plus",className:"fs-3"}),"New ",n]})]})]}),e.jsx("div",{className:"card-body py-3",children:e.jsx("div",{className:"table-responsive",children:e.jsx(je,{data:s.data,loading:s.loading,pagination:s.pagination,sortColumn:s.sortColumn,sortDirection:s.sortDirection,onPageChange:s.setPage,onSortChange:(l,t)=>{s.setSortColumn(l),s.setSortDirection(t)},onEdit:h,onView:d,onArchive:j,onSearchChange:l=>{s.setPage(1),s.setSearch(l)},setRefreshTable:s.setRefreshTable})})})]}),m.visible&&e.jsx(K,{title:m.title,body:m.body,modalClass:m.className,alignment:m.alignment,onClose:()=>u({visible:!1,title:"",body:e.jsx(e.Fragment,{}),className:"",alignment:"center"})})]})})},$=[{title:"Account",path:"/account-management",isSeparator:!1,isActive:!1},{title:"",path:"",isSeparator:!0,isActive:!1}],Pe=()=>e.jsx(W,{children:e.jsxs(D,{element:e.jsx(X,{}),children:[e.jsx(D,{path:"/user/list",element:e.jsxs(e.Fragment,{children:[e.jsx(R,{breadcrumbs:$,children:"Users"}),e.jsx(ne,{title:"User"})]})}),e.jsx(D,{path:"/role/list",element:e.jsxs(e.Fragment,{children:[e.jsx(R,{breadcrumbs:$,children:"Roles"}),e.jsx(be,{title:"Role"})]})})]})});export{Pe as default};
