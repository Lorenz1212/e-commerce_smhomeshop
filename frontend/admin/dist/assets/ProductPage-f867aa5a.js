import{j as e,t as fs,b as ks,c as ye,S as H,r as c,i as F,p as fe,y as gs,q as et,s as Os,d as U,e as T,o as I,l as Te,m as is,F as Is,n as Ls,C as st,K as Ss,P as tt}from"./index-716f35f1.js";import{M as rt}from"./ModalHandler-0e663310.js";import{D as Ds,A as Vs}from"./ActionsCell-1ea9e971.js";import{I as zs,L as at}from"./ImageTitleCell-de4f184b.js";import{S as Ms}from"./StatusCell-011dac1f.js";import{C as ie}from"./CurrencyText-dfd7429e.js";import{a as Es}from"./apiMultipart-e17508ae.js";import{S as ys,a as nt,b as lt,c as Cs,o as it,f as ot,s as ct}from"./react-select.esm-36797614.js";import{M as Ks}from"./MulitpleImageUploader-c0e59034.js";const dt=({data:s,loading:r,pagination:o,sortColumn:m,sortDirection:v,onPageChange:i,onSortChange:h,onEdit:d,onView:f,onArchive:p,onSearchChange:y,setRefreshTable:a})=>{const n=[{title:"#",key:"row_number",sortable:!0},{title:"Items",key:"image_cover",render:l=>{var t;return e.jsx(zs,{image:((t=l.primary_image)==null?void 0:t.image_cover)??fs("media/products/default.jpg"),mainTitle:l.name,subTitle:l.sku})}},{title:"QTY on hand",key:"quantity_on_hand",sortable:!0,render:l=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"d-flex flex-column align-items-start",children:[e.jsxs("span",{className:"mb-2",children:["QTY: ",l.quantity_on_hand]}),e.jsx(Ms,{color:l.stock_status.color,title:l.stock_status.title})]})})},{title:"Price",key:"cost_price",sortable:!0,render:l=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"d-flex flex-column align-items-start",children:[e.jsxs("span",{className:"mb-2",children:["Cost: ",e.jsx(ie,{value:l.cost_price||0})]}),e.jsxs("span",{className:"mb-2",children:["Selling: ",e.jsx(ie,{value:l.selling_price||0})]})]})})},{title:"Variants",key:"variants",render:l=>e.jsx("div",{className:"d-flex flex-column gap-1",children:l.variants&&l.variants.length>0?l.variants.map((t,g)=>e.jsxs("div",{className:"border rounded p-2 bg-light",children:[e.jsxs("div",{className:"fw-semibold small",children:["SKU: ",e.jsx("span",{className:"text-primary",children:t.sku})]}),e.jsxs("div",{className:"small",children:["Name: ",t.variant_name??"-"]}),e.jsxs("div",{className:"small",children:["Qty: ",e.jsx("span",{className:"fw-bold",children:t.quantity_on_hand??0})]})]},g)):e.jsx("span",{className:"text-muted small",children:"No variants"})})},{title:"Created At",key:"created_at_format",sortable:!0},{title:"Action",key:"id_encrypted",render:l=>e.jsx(Vs,{openDetailsModal:()=>f(l.id_encrypted),openEditModal:()=>d(l.id_encrypted),archiveAction:()=>p(l.id_encrypted,a)})}];return e.jsx("div",{className:"table-responsive",children:r?e.jsx("div",{className:"alert alert-info",children:"Loading..."}):e.jsx(Ds,{data:s,columns:n,loading:r,pagination:o,sortColumn:m,sortDirection:v,onPageChange:i,onSortChange:h,onSearchChange:y})})},os=()=>{const{showLoader:s,hideLoader:r}=ks();return{viewProductDetails:async d=>{var f,p;try{return s(),(await ye.get(`/admin/product/${d}/edit`)).data}catch(y){return H.fire({icon:"error",title:(p=(f=y==null?void 0:y.response)==null?void 0:f.data)==null?void 0:p.message}),null}finally{r()}},createProduct:async(d,f,p,y)=>{var a,n,l,t,g;try{s();const u=new FormData;["sku","name","description","brand_id","category_id","supplier_id","quantity_on_hand","reorder_point","cost_price","selling_price"].forEach(E=>u.append(E,d[E])),d.images.forEach(E=>{u.append("images[]",E)}),typeof d.primary_index<"u"&&u.append("primary_index",d.primary_index),d.addons.forEach((E,A)=>{u.append(`addons[${A}][id]`,E.id),u.append(`addons[${A}][base_price]`,E.base_price.toString()),u.append(`addons[${A}][custom_price]`,E.custom_price.toString())}),d.variants.forEach((E,A)=>{u.append(`variants[${A}][sku]`,E.sku.toString()),u.append(`variants[${A}][variant_name]`,E.variant_name.toString()),u.append(`variants[${A}][quantity_on_hand]`,E.quantity_on_hand.toString()),u.append(`variants[${A}][reorder_point]`,E.reorder_point.toString()),u.append(`variants[${A}][cost_price]`,E.cost_price.toString()),u.append(`variants[${A}][selling_price]`,E.selling_price.toString()),u.append(`variants[${A}][image]`,E.image)});const w=await Es.post("/admin/product/store",u);H.fire({icon:(a=w.data)==null?void 0:a.status,title:(n=w.data)==null?void 0:n.message}),((l=w.data)==null?void 0:l.status)=="success"&&(f(),p==null||p(!0),y==null||y(1))}catch(u){H.fire({icon:"error",title:(g=(t=u==null?void 0:u.response)==null?void 0:t.data)==null?void 0:g.message})}finally{r()}},updateProduct:async(d,f,p)=>{var y,a,n,l;try{s();const t=new FormData;["sku","name","description","brand_id","category_id","supplier_id","add_new_stocks","reorder_point","cost_price","selling_price"].forEach(x=>t.append(x,d[x])),d.images.forEach(x=>{t.append("images[]",x)}),typeof d.primary_index<"u"&&t.append("primary_index",d.primary_index),d.addons.forEach((x,w)=>{t.append(`addons[${w}][id]`,x.id),t.append(`addons[${w}][base_price]`,x.base_price.toString()),t.append(`addons[${w}][custom_price]`,x.custom_price.toString())}),d.variants.forEach((x,w)=>{t.append(`variants[${w}][id]`,x.id),t.append(`variants[${w}][sku]`,x.sku.toString()),t.append(`variants[${w}][variant_name]`,x.variant_name.toString()),t.append(`variants[${w}][quantity_on_hand]`,x.quantity_on_hand.toString()),t.append(`variants[${w}][reorder_point]`,x.reorder_point.toString()),t.append(`variants[${w}][cost_price]`,x.cost_price.toString()),t.append(`variants[${w}][selling_price]`,x.selling_price.toString()),t.append(`variants[${w}][image]`,x.image)});const u=await Es.post(`/admin/product/${f}/update`,t);H.fire({icon:(y=u.data)==null?void 0:y.status,title:(a=u.data)==null?void 0:a.message}),p==null||p(!0)}catch(t){H.fire({icon:"error",title:(l=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:l.message})}finally{r()}},archivedProduct:async(d,f)=>{var y,a,n,l;if((await H.fire({title:"Are you sure?",text:"This action will archive the item.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, archive it!"})).isConfirmed)try{s();const t=await ye.delete(`/admin/product/${d}/archive`);H.fire({icon:((y=t.data)==null?void 0:y.status)||"success",title:(a=t.data)==null?void 0:a.message}),f==null||f(!0)}catch(t){H.fire({icon:"error",title:((l=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:l.message)||"An error occurred."})}finally{r()}},restoreProduct:async(d,f,p)=>{var a,n,l,t;if((await H.fire({title:"Are you sure?",text:"This will restore the archived item.",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, restore it!"})).isConfirmed)try{s();const g=await ye.post(`/admin/product/${d}/restore`);H.fire({icon:((a=g.data)==null?void 0:a.status)||"success",title:((n=g.data)==null?void 0:n.message)||"Item restored successfully."}),f==null||f(!0),p==null||p(!0)}catch(g){H.fire({icon:"error",title:((t=(l=g==null?void 0:g.response)==null?void 0:l.data)==null?void 0:t.message)||"Something went wrong."})}finally{r()}}}};async function ut(){try{const r=(await ye.get("/category")).data;return Array.isArray(r)?r:(console.warn("Unexpected response shape:",r),[])}catch(s){return console.error("Failed to fetch categories:",s),[]}}const Us=({setClass:s,name:r,value:o,onChange:m,onBlur:v,error:i,touched:h})=>{const[d,f]=c.useState([]);return c.useEffect(()=>{ut().then(p=>{const y=p.map(a=>({value:a.id,label:a.name}));f(y)}).catch(console.error)},[]),e.jsxs("div",{className:s,children:[e.jsx("label",{className:"form-label required",children:"Category"}),e.jsx(ys,{name:r,options:d,value:d.find(p=>p.value===o)||null,onChange:p=>m({target:{name:r,value:(p==null?void 0:p.value)||""}}),onBlur:v,className:F("form-select-solid text-dark",{"is-invalid":i&&h},{})}),i&&h&&e.jsx("div",{className:"invalid-feedback",children:i})]})};async function pt(){try{const r=(await ye.get("/supplier")).data;return Array.isArray(r)?r:(console.warn("Unexpected response shape:",r),[])}catch(s){return console.error("Failed to fetch categories:",s),[]}}const Ys=({setClass:s,name:r,value:o,onChange:m,onBlur:v,error:i,touched:h})=>{const[d,f]=c.useState([]);return c.useEffect(()=>{pt().then(p=>{const y=p.map(a=>({value:a.id,label:a.name}));f(y)}).catch(console.error)},[]),e.jsxs("div",{className:s,children:[e.jsx("label",{className:"form-label required",children:"Supplier"}),e.jsx(ys,{name:r,options:d,value:d.find(p=>p.value===o)||null,onChange:p=>m({target:{name:r,value:(p==null?void 0:p.value)||""}}),onBlur:v,className:F("form-select-solid text-dark",{"is-invalid":i&&h},{})}),i&&h&&e.jsx("div",{className:"invalid-feedback",children:i})]})};/*
* React Tooltip
* {@link https://github.com/ReactTooltip/react-tooltip}
* @copyright ReactTooltip Team
* @license MIT
*/const mt="react-tooltip-core-styles",ht="react-tooltip-base-styles",qs={core:!1,base:!1};function As({css:s,id:r=ht,type:o="base",ref:m}){var v,i;if(!s||typeof document>"u"||qs[o]||o==="core"&&typeof process<"u"&&(!((v=process==null?void 0:process.env)===null||v===void 0)&&v.REACT_TOOLTIP_DISABLE_CORE_STYLES)||o!=="base"&&typeof process<"u"&&(!((i=process==null?void 0:process.env)===null||i===void 0)&&i.REACT_TOOLTIP_DISABLE_BASE_STYLES))return;o==="core"&&(r=mt),m||(m={});const{insertAt:h}=m;if(document.getElementById(r))return;const d=document.head||document.getElementsByTagName("head")[0],f=document.createElement("style");f.id=r,f.type="text/css",h==="top"&&d.firstChild?d.insertBefore(f,d.firstChild):d.appendChild(f),f.styleSheet?f.styleSheet.cssText=s:f.appendChild(document.createTextNode(s)),qs[o]=!0}const Ps=async({elementReference:s=null,tooltipReference:r=null,tooltipArrowReference:o=null,place:m="top",offset:v=10,strategy:i="absolute",middlewares:h=[it(Number(v)),ot({fallbackAxisSideDirection:"start"}),ct({padding:5})],border:d,arrowSize:f=8})=>{if(!s)return{tooltipStyles:{},tooltipArrowStyles:{},place:m};if(r===null)return{tooltipStyles:{},tooltipArrowStyles:{},place:m};const p=h;return o?(p.push(lt({element:o,padding:5})),Cs(s,r,{placement:m,strategy:i,middleware:p}).then(({x:y,y:a,placement:n,middlewareData:l})=>{var t,g;const u={left:`${y}px`,top:`${a}px`,border:d},{x,y:w}=(t=l.arrow)!==null&&t!==void 0?t:{x:0,y:0},E=(g={top:"bottom",right:"left",bottom:"top",left:"right"}[n.split("-")[0]])!==null&&g!==void 0?g:"bottom",A=d&&{borderBottom:d,borderRight:d};let B=0;if(d){const R=`${d}`.match(/(\d+)px/);B=R!=null&&R[1]?Number(R[1]):1}return{tooltipStyles:u,tooltipArrowStyles:{left:x!=null?`${x}px`:"",top:w!=null?`${w}px`:"",right:"",bottom:"",...A,[E]:`-${f/2+B}px`},place:n}})):Cs(s,r,{placement:"bottom",strategy:i,middleware:p}).then(({x:y,y:a,placement:n})=>({tooltipStyles:{left:`${y}px`,top:`${a}px`},tooltipArrowStyles:{},place:n}))},$s=(s,r)=>!("CSS"in window&&"supports"in window.CSS)||window.CSS.supports(s,r),Fs=(s,r,o)=>{let m=null;const v=function(...i){const h=()=>{m=null,o||s.apply(this,i)};o&&!m&&(s.apply(this,i),m=setTimeout(h,r)),o||(m&&clearTimeout(m),m=setTimeout(h,r))};return v.cancel=()=>{m&&(clearTimeout(m),m=null)},v},Bs=s=>s!==null&&!Array.isArray(s)&&typeof s=="object",vs=(s,r)=>{if(s===r)return!0;if(Array.isArray(s)&&Array.isArray(r))return s.length===r.length&&s.every((v,i)=>vs(v,r[i]));if(Array.isArray(s)!==Array.isArray(r))return!1;if(!Bs(s)||!Bs(r))return s===r;const o=Object.keys(s),m=Object.keys(r);return o.length===m.length&&o.every(v=>vs(s[v],r[v]))},bt=s=>{if(!(s instanceof HTMLElement||s instanceof SVGElement))return!1;const r=getComputedStyle(s);return["overflow","overflow-x","overflow-y"].some(o=>{const m=r.getPropertyValue(o);return m==="auto"||m==="scroll"})},Ts=s=>{if(!s)return null;let r=s.parentElement;for(;r;){if(bt(r))return r;r=r.parentElement}return document.scrollingElement||document.documentElement},gt=typeof window<"u"?c.useLayoutEffect:c.useEffect,Z=s=>{s.current&&(clearTimeout(s.current),s.current=null)},vt="DEFAULT_TOOLTIP_ID",ft={anchorRefs:new Set,activeAnchor:{current:null},attach:()=>{},detach:()=>{},setActiveAnchor:()=>{}},yt=c.createContext({getTooltipData:()=>ft});function Qs(s=vt){return c.useContext(yt).getTooltipData(s)}var Be={tooltip:"core-styles-module_tooltip__3vRRp",fixed:"core-styles-module_fixed__pcSol",arrow:"core-styles-module_arrow__cvMwQ",noArrow:"core-styles-module_noArrow__xock6",clickable:"core-styles-module_clickable__ZuTTB",show:"core-styles-module_show__Nt9eE",closing:"core-styles-module_closing__sGnxF"},hs={tooltip:"styles-module_tooltip__mnnfp",arrow:"styles-module_arrow__K0L3T",dark:"styles-module_dark__xNqje",light:"styles-module_light__Z6W-X",success:"styles-module_success__A2AKt",warning:"styles-module_warning__SCK0X",error:"styles-module_error__JvumD",info:"styles-module_info__BWdHW"};const xt=({forwardRef:s,id:r,className:o,classNameArrow:m,variant:v="dark",anchorId:i,anchorSelect:h,place:d="top",offset:f=10,events:p=["hover"],openOnClick:y=!1,positionStrategy:a="absolute",middlewares:n,wrapper:l,delayShow:t=0,delayHide:g=0,float:u=!1,hidden:x=!1,noArrow:w=!1,clickable:E=!1,closeOnEsc:A=!1,closeOnScroll:B=!1,closeOnResize:R=!1,openEvents:q,closeEvents:L,globalCloseEvents:te,imperativeModeOnly:Re,style:We,position:Xe,afterShow:Ze,afterHide:re,disableTooltip:xe,content:Oe,contentWrapperRef:ue,isOpen:k,defaultIsOpen:_e=!1,setIsOpen:pe,activeAnchor:D,setActiveAnchor:je,border:He,opacity:ke,arrowColor:es,arrowSize:Ne=8,role:cs="tooltip"})=>{var Ie;const Y=c.useRef(null),we=c.useRef(null),ee=c.useRef(null),oe=c.useRef(null),Le=c.useRef(null),[ce,ds]=c.useState({tooltipStyles:{},tooltipArrowStyles:{},place:d}),[G,ss]=c.useState(!1),[me,he]=c.useState(!1),[$,De]=c.useState(null),Ve=c.useRef(!1),ze=c.useRef(null),{anchorRefs:Me,setActiveAnchor:ts}=Qs(r),Se=c.useRef(!1),[de,Ke]=c.useState([]),be=c.useRef(!1),Ee=y||p.includes("click"),us=Ee||(q==null?void 0:q.click)||(q==null?void 0:q.dblclick)||(q==null?void 0:q.mousedown),Ce=q?{...q}:{mouseover:!0,focus:!0,mouseenter:!1,click:!1,dblclick:!1,mousedown:!1};!q&&Ee&&Object.assign(Ce,{mouseenter:!1,focus:!1,mouseover:!1,click:!0});const ge=L?{...L}:{mouseout:!0,blur:!0,mouseleave:!1,click:!1,dblclick:!1,mouseup:!1};!L&&Ee&&Object.assign(ge,{mouseleave:!1,blur:!1,mouseout:!1});const se=te?{...te}:{escape:A||!1,scroll:B||!1,resize:R||!1,clickOutsideAnchor:us||!1};Re&&(Object.assign(Ce,{mouseover:!1,focus:!1,mouseenter:!1,click:!1,dblclick:!1,mousedown:!1}),Object.assign(ge,{mouseout:!1,blur:!1,mouseleave:!1,click:!1,dblclick:!1,mouseup:!1}),Object.assign(se,{escape:!1,scroll:!1,resize:!1,clickOutsideAnchor:!1})),gt(()=>(be.current=!0,()=>{be.current=!1}),[]);const O=b=>{be.current&&(b&&he(!0),setTimeout(()=>{be.current&&(pe==null||pe(b),k===void 0&&ss(b))},10))};c.useEffect(()=>{if(k===void 0)return()=>null;k&&he(!0);const b=setTimeout(()=>{ss(k)},10);return()=>{clearTimeout(b)}},[k]),c.useEffect(()=>{if(G!==Ve.current)if(Z(Le),Ve.current=G,G)Ze==null||Ze();else{const b=(j=>{const N=j.match(/^([\d.]+)(ms|s)$/);if(!N)return 0;const[,V,M]=N;return Number(V)*(M==="ms"?1:1e3)})(getComputedStyle(document.body).getPropertyValue("--rt-transition-show-delay"));Le.current=setTimeout(()=>{he(!1),De(null),re==null||re()},b+25)}},[G]);const rs=b=>{ds(j=>vs(j,b)?j:b)},Ue=(b=t)=>{Z(ee),me?O(!0):ee.current=setTimeout(()=>{O(!0)},b)},qe=(b=g)=>{Z(oe),oe.current=setTimeout(()=>{Se.current||O(!1)},b)},Ye=b=>{var j;if(!b)return;const N=(j=b.currentTarget)!==null&&j!==void 0?j:b.target;if(!(N!=null&&N.isConnected))return je(null),void ts({current:null});t?Ue():O(!0),je(N),ts({current:N}),Z(oe)},Ae=()=>{E?qe(g||100):g?qe():O(!1),Z(ee)},Pe=({x:b,y:j})=>{var N;const V={getBoundingClientRect:()=>({x:b,y:j,width:0,height:0,top:j,left:b,right:b,bottom:j})};Ps({place:(N=$==null?void 0:$.place)!==null&&N!==void 0?N:d,offset:f,elementReference:V,tooltipReference:Y.current,tooltipArrowReference:we.current,strategy:a,middlewares:n,border:He,arrowSize:Ne}).then(M=>{rs(M)})},$e=b=>{if(!b)return;const j=b,N={x:j.clientX,y:j.clientY};Pe(N),ze.current=N},Qe=b=>{var j;if(!G)return;const N=b.target;N.isConnected&&(!((j=Y.current)===null||j===void 0)&&j.contains(N)||[document.querySelector(`[id='${i}']`),...de].some(V=>V==null?void 0:V.contains(N))||(O(!1),Z(ee)))},as=Fs(Ye,50,!0),z=Fs(Ae,50,!0),W=b=>{z.cancel(),as(b)},_=()=>{as.cancel(),z()},S=c.useCallback(()=>{var b,j;const N=(b=$==null?void 0:$.position)!==null&&b!==void 0?b:Xe;N?Pe(N):u?ze.current&&Pe(ze.current):D!=null&&D.isConnected&&Ps({place:(j=$==null?void 0:$.place)!==null&&j!==void 0?j:d,offset:f,elementReference:D,tooltipReference:Y.current,tooltipArrowReference:we.current,strategy:a,middlewares:n,border:He,arrowSize:Ne}).then(V=>{be.current&&rs(V)})},[G,D,Oe,We,d,$==null?void 0:$.place,f,a,Xe,$==null?void 0:$.position,u,Ne]);c.useEffect(()=>{var b,j;const N=new Set(Me);de.forEach(C=>{xe!=null&&xe(C)||N.add({current:C})});const V=document.querySelector(`[id='${i}']`);V&&!(xe!=null&&xe(V))&&N.add({current:V});const M=()=>{O(!1)},ae=Ts(D),ne=Ts(Y.current);se.scroll&&(window.addEventListener("scroll",M),ae==null||ae.addEventListener("scroll",M),ne==null||ne.addEventListener("scroll",M));let Q=null;se.resize?window.addEventListener("resize",M):D&&Y.current&&(Q=nt(D,Y.current,S,{ancestorResize:!0,elementResize:!0,layoutShift:!0}));const X=C=>{C.key==="Escape"&&O(!1)};se.escape&&window.addEventListener("keydown",X),se.clickOutsideAnchor&&window.addEventListener("click",Qe);const P=[],Fe=C=>!!(C!=null&&C.target&&(D!=null&&D.contains(C.target))),Xs=C=>{G&&Fe(C)||Ye(C)},Zs=C=>{G&&Fe(C)&&Ae()},xs=["mouseover","mouseout","mouseenter","mouseleave","focus","blur"],_s=["click","dblclick","mousedown","mouseup"];Object.entries(Ce).forEach(([C,le])=>{le&&(xs.includes(C)?P.push({event:C,listener:W}):_s.includes(C)&&P.push({event:C,listener:Xs}))}),Object.entries(ge).forEach(([C,le])=>{le&&(xs.includes(C)?P.push({event:C,listener:_}):_s.includes(C)&&P.push({event:C,listener:Zs}))}),u&&P.push({event:"pointermove",listener:$e});const js=()=>{Se.current=!0},Ns=()=>{Se.current=!1,Ae()},ws=E&&(ge.mouseout||ge.mouseleave);return ws&&((b=Y.current)===null||b===void 0||b.addEventListener("mouseover",js),(j=Y.current)===null||j===void 0||j.addEventListener("mouseout",Ns)),P.forEach(({event:C,listener:le})=>{N.forEach(ps=>{var Ge;(Ge=ps.current)===null||Ge===void 0||Ge.addEventListener(C,le)})}),()=>{var C,le;se.scroll&&(window.removeEventListener("scroll",M),ae==null||ae.removeEventListener("scroll",M),ne==null||ne.removeEventListener("scroll",M)),se.resize?window.removeEventListener("resize",M):Q==null||Q(),se.clickOutsideAnchor&&window.removeEventListener("click",Qe),se.escape&&window.removeEventListener("keydown",X),ws&&((C=Y.current)===null||C===void 0||C.removeEventListener("mouseover",js),(le=Y.current)===null||le===void 0||le.removeEventListener("mouseout",Ns)),P.forEach(({event:ps,listener:Ge})=>{N.forEach(Hs=>{var ms;(ms=Hs.current)===null||ms===void 0||ms.removeEventListener(ps,Ge)})})}},[D,S,me,Me,de,q,L,te,Ee,t,g]),c.useEffect(()=>{var b,j;let N=(j=(b=$==null?void 0:$.anchorSelect)!==null&&b!==void 0?b:h)!==null&&j!==void 0?j:"";!N&&r&&(N=`[data-tooltip-id='${r.replace(/'/g,"\\'")}']`);const V=new MutationObserver(M=>{const ae=[],ne=[];M.forEach(Q=>{if(Q.type==="attributes"&&Q.attributeName==="data-tooltip-id"&&(Q.target.getAttribute("data-tooltip-id")===r?ae.push(Q.target):Q.oldValue===r&&ne.push(Q.target)),Q.type==="childList"){if(D){const X=[...Q.removedNodes].filter(P=>P.nodeType===1);if(N)try{ne.push(...X.filter(P=>P.matches(N))),ne.push(...X.flatMap(P=>[...P.querySelectorAll(N)]))}catch{}X.some(P=>{var Fe;return!!(!((Fe=P==null?void 0:P.contains)===null||Fe===void 0)&&Fe.call(P,D))&&(he(!1),O(!1),je(null),Z(ee),Z(oe),!0)})}if(N)try{const X=[...Q.addedNodes].filter(P=>P.nodeType===1);ae.push(...X.filter(P=>P.matches(N))),ae.push(...X.flatMap(P=>[...P.querySelectorAll(N)]))}catch{}}}),(ae.length||ne.length)&&Ke(Q=>[...Q.filter(X=>!ne.includes(X)),...ae])});return V.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["data-tooltip-id"],attributeOldValue:!0}),()=>{V.disconnect()}},[r,h,$==null?void 0:$.anchorSelect,D]),c.useEffect(()=>{S()},[S]),c.useEffect(()=>{if(!(ue!=null&&ue.current))return()=>null;const b=new ResizeObserver(()=>{setTimeout(()=>S())});return b.observe(ue.current),()=>{b.disconnect()}},[Oe,ue==null?void 0:ue.current]),c.useEffect(()=>{var b;const j=document.querySelector(`[id='${i}']`),N=[...de,j];D&&N.includes(D)||je((b=de[0])!==null&&b!==void 0?b:j)},[i,de,D]),c.useEffect(()=>(_e&&O(!0),()=>{Z(ee),Z(oe)}),[]),c.useEffect(()=>{var b;let j=(b=$==null?void 0:$.anchorSelect)!==null&&b!==void 0?b:h;if(!j&&r&&(j=`[data-tooltip-id='${r.replace(/'/g,"\\'")}']`),j)try{const N=Array.from(document.querySelectorAll(j));Ke(N)}catch{Ke([])}},[r,h,$==null?void 0:$.anchorSelect]),c.useEffect(()=>{ee.current&&(Z(ee),Ue(t))},[t]);const J=(Ie=$==null?void 0:$.content)!==null&&Ie!==void 0?Ie:Oe,ve=G&&Object.keys(ce.tooltipStyles).length>0;return c.useImperativeHandle(s,()=>({open:b=>{if(b!=null&&b.anchorSelect)try{document.querySelector(b.anchorSelect)}catch{return void console.warn(`[react-tooltip] "${b.anchorSelect}" is not a valid CSS selector`)}De(b??null),b!=null&&b.delay?Ue(b.delay):O(!0)},close:b=>{b!=null&&b.delay?qe(b.delay):O(!1)},activeAnchor:D,place:ce.place,isOpen:!!(me&&!x&&J&&ve)})),me&&!x&&J?fe.createElement(l,{id:r,role:cs,className:gs("react-tooltip",Be.tooltip,hs.tooltip,hs[v],o,`react-tooltip__place-${ce.place}`,Be[ve?"show":"closing"],ve?"react-tooltip__show":"react-tooltip__closing",a==="fixed"&&Be.fixed,E&&Be.clickable),onTransitionEnd:b=>{Z(Le),G||b.propertyName!=="opacity"||(he(!1),De(null),re==null||re())},style:{...We,...ce.tooltipStyles,opacity:ke!==void 0&&ve?ke:void 0},ref:Y},J,fe.createElement(l,{className:gs("react-tooltip-arrow",Be.arrow,hs.arrow,m,w&&Be.noArrow),style:{...ce.tooltipArrowStyles,background:es?`linear-gradient(to right bottom, transparent 50%, ${es} 50%)`:void 0,"--rt-arrow-size":`${Ne}px`},ref:we})):null},_t=({content:s})=>fe.createElement("span",{dangerouslySetInnerHTML:{__html:s}}),Je=fe.forwardRef(({id:s,anchorId:r,anchorSelect:o,content:m,html:v,render:i,className:h,classNameArrow:d,variant:f="dark",place:p="top",offset:y=10,wrapper:a="div",children:n=null,events:l=["hover"],openOnClick:t=!1,positionStrategy:g="absolute",middlewares:u,delayShow:x=0,delayHide:w=0,float:E=!1,hidden:A=!1,noArrow:B=!1,clickable:R=!1,closeOnEsc:q=!1,closeOnScroll:L=!1,closeOnResize:te=!1,openEvents:Re,closeEvents:We,globalCloseEvents:Xe,imperativeModeOnly:Ze=!1,style:re,position:xe,isOpen:Oe,defaultIsOpen:ue=!1,disableStyleInjection:k=!1,border:_e,opacity:pe,arrowColor:D,arrowSize:je,setIsOpen:He,afterShow:ke,afterHide:es,disableTooltip:Ne,role:cs="tooltip"},Ie)=>{const[Y,we]=c.useState(m),[ee,oe]=c.useState(v),[Le,ce]=c.useState(p),[ds,G]=c.useState(f),[ss,me]=c.useState(y),[he,$]=c.useState(x),[De,Ve]=c.useState(w),[ze,Me]=c.useState(E),[ts,Se]=c.useState(A),[de,Ke]=c.useState(a),[be,Ee]=c.useState(l),[us,Ce]=c.useState(g),[ge,se]=c.useState(null),[O,rs]=c.useState(null),Ue=c.useRef(k),{anchorRefs:qe,activeAnchor:Ye}=Qs(s),Ae=z=>z==null?void 0:z.getAttributeNames().reduce((W,_)=>{var S;return _.startsWith("data-tooltip-")&&(W[_.replace(/^data-tooltip-/,"")]=(S=z==null?void 0:z.getAttribute(_))!==null&&S!==void 0?S:null),W},{}),Pe=z=>{const W={place:_=>{var S;ce((S=_)!==null&&S!==void 0?S:p)},content:_=>{we(_??m)},html:_=>{oe(_??v)},variant:_=>{var S;G((S=_)!==null&&S!==void 0?S:f)},offset:_=>{me(_===null?y:Number(_))},wrapper:_=>{var S;Ke((S=_)!==null&&S!==void 0?S:a)},events:_=>{const S=_==null?void 0:_.split(" ");Ee(S??l)},"position-strategy":_=>{var S;Ce((S=_)!==null&&S!==void 0?S:g)},"delay-show":_=>{$(_===null?x:Number(_))},"delay-hide":_=>{Ve(_===null?w:Number(_))},float:_=>{Me(_===null?E:_==="true")},hidden:_=>{Se(_===null?A:_==="true")},"class-name":_=>{se(_)}};Object.values(W).forEach(_=>_(null)),Object.entries(z).forEach(([_,S])=>{var J;(J=W[_])===null||J===void 0||J.call(W,S)})};c.useEffect(()=>{we(m)},[m]),c.useEffect(()=>{oe(v)},[v]),c.useEffect(()=>{ce(p)},[p]),c.useEffect(()=>{G(f)},[f]),c.useEffect(()=>{me(y)},[y]),c.useEffect(()=>{$(x)},[x]),c.useEffect(()=>{Ve(w)},[w]),c.useEffect(()=>{Me(E)},[E]),c.useEffect(()=>{Se(A)},[A]),c.useEffect(()=>{Ce(g)},[g]),c.useEffect(()=>{Ue.current!==k&&console.warn("[react-tooltip] Do not change `disableStyleInjection` dynamically.")},[k]),c.useEffect(()=>{typeof window<"u"&&window.dispatchEvent(new CustomEvent("react-tooltip-inject-styles",{detail:{disableCore:k==="core",disableBase:k}}))},[]),c.useEffect(()=>{var z;const W=new Set(qe);let _=o;if(!_&&s&&(_=`[data-tooltip-id='${s.replace(/'/g,"\\'")}']`),_)try{document.querySelectorAll(_).forEach(j=>{W.add({current:j})})}catch{console.warn(`[react-tooltip] "${_}" is not a valid CSS selector`)}const S=document.querySelector(`[id='${r}']`);if(S&&W.add({current:S}),!W.size)return()=>null;const J=(z=O??S)!==null&&z!==void 0?z:Ye.current,ve=new MutationObserver(j=>{j.forEach(N=>{var V;if(!J||N.type!=="attributes"||!(!((V=N.attributeName)===null||V===void 0)&&V.startsWith("data-tooltip-")))return;const M=Ae(J);Pe(M)})}),b={attributes:!0,childList:!1,subtree:!1};if(J){const j=Ae(J);Pe(j),ve.observe(J,b)}return()=>{ve.disconnect()}},[qe,Ye,O,r,o]),c.useEffect(()=>{re!=null&&re.border&&console.warn("[react-tooltip] Do not set `style.border`. Use `border` prop instead."),_e&&!$s("border",`${_e}`)&&console.warn(`[react-tooltip] "${_e}" is not a valid \`border\`.`),re!=null&&re.opacity&&console.warn("[react-tooltip] Do not set `style.opacity`. Use `opacity` prop instead."),pe&&!$s("opacity",`${pe}`)&&console.warn(`[react-tooltip] "${pe}" is not a valid \`opacity\`.`)},[]);let $e=n;const Qe=c.useRef(null);if(i){const z=i({content:(O==null?void 0:O.getAttribute("data-tooltip-content"))||Y||null,activeAnchor:O});$e=z?fe.createElement("div",{ref:Qe,className:"react-tooltip-content-wrapper"},z):null}else Y&&($e=Y);ee&&($e=fe.createElement(_t,{content:ee}));const as={forwardRef:Ie,id:s,anchorId:r,anchorSelect:o,className:gs(h,ge),classNameArrow:d,content:$e,contentWrapperRef:Qe,place:Le,variant:ds,offset:ss,wrapper:de,events:be,openOnClick:t,positionStrategy:us,middlewares:u,delayShow:he,delayHide:De,float:ze,hidden:ts,noArrow:B,clickable:R,closeOnEsc:q,closeOnScroll:L,closeOnResize:te,openEvents:Re,closeEvents:We,globalCloseEvents:Xe,imperativeModeOnly:Ze,style:re,position:xe,isOpen:Oe,defaultIsOpen:ue,border:_e,opacity:pe,arrowColor:D,arrowSize:je,setIsOpen:He,afterShow:ke,afterHide:es,disableTooltip:Ne,activeAnchor:O,setActiveAnchor:z=>rs(z),role:cs};return fe.createElement(xt,{...as})});typeof window<"u"&&window.addEventListener("react-tooltip-inject-styles",s=>{s.detail.disableCore||As({css:":root{--rt-color-white:#fff;--rt-color-dark:#222;--rt-color-success:#8dc572;--rt-color-error:#be6464;--rt-color-warning:#f0ad4e;--rt-color-info:#337ab7;--rt-opacity:0.9;--rt-transition-show-delay:0.15s;--rt-transition-closing-delay:0.15s;--rt-arrow-size:8px}.core-styles-module_tooltip__3vRRp{position:absolute;top:0;left:0;pointer-events:none;opacity:0;will-change:opacity}.core-styles-module_fixed__pcSol{position:fixed}.core-styles-module_arrow__cvMwQ{position:absolute;background:inherit;z-index:-1}.core-styles-module_noArrow__xock6{display:none}.core-styles-module_clickable__ZuTTB{pointer-events:auto}.core-styles-module_show__Nt9eE{opacity:var(--rt-opacity);transition:opacity var(--rt-transition-show-delay)ease-out}.core-styles-module_closing__sGnxF{opacity:0;transition:opacity var(--rt-transition-closing-delay)ease-in}",type:"core"}),s.detail.disableBase||As({css:`
.styles-module_tooltip__mnnfp{padding:8px 16px;border-radius:3px;font-size:90%;width:max-content}.styles-module_arrow__K0L3T{width:var(--rt-arrow-size);height:var(--rt-arrow-size)}[class*='react-tooltip__place-top']>.styles-module_arrow__K0L3T{transform:rotate(45deg)}[class*='react-tooltip__place-right']>.styles-module_arrow__K0L3T{transform:rotate(135deg)}[class*='react-tooltip__place-bottom']>.styles-module_arrow__K0L3T{transform:rotate(225deg)}[class*='react-tooltip__place-left']>.styles-module_arrow__K0L3T{transform:rotate(315deg)}.styles-module_dark__xNqje{background:var(--rt-color-dark);color:var(--rt-color-white)}.styles-module_light__Z6W-X{background-color:var(--rt-color-white);color:var(--rt-color-dark)}.styles-module_success__A2AKt{background-color:var(--rt-color-success);color:var(--rt-color-white)}.styles-module_warning__SCK0X{background-color:var(--rt-color-warning);color:var(--rt-color-white)}.styles-module_error__JvumD{background-color:var(--rt-color-error);color:var(--rt-color-white)}.styles-module_info__BWdHW{background-color:var(--rt-color-info);color:var(--rt-color-white)}`,type:"base"})});async function jt(){try{const r=(await ye.get("/addons")).data;return Array.isArray(r)?r:(console.warn("Unexpected response shape:",r),[])}catch(s){return console.error("Failed to fetch categories:",s),[]}}const Gs=({name:s,errors:r,touched:o,onBlur:m,onChange:v,setFieldValue:i,setFieldTouched:h,initialAddons:d=[]})=>{const{values:f}=et(),[p,y]=c.useState([]),[a,n]=c.useState([]);c.useEffect(()=>{jt().then(t=>{y(t.map(g=>({id:String(g.id),name:g.name,base_price:Number(g.base_price),is_freebies:g.is_freebies??"N"})))}).catch(console.error)},[]);const l=f[s]||[];return c.useEffect(()=>{d.length&&l.length===0&&i(s,d.map(t=>({...t,custom_price:t.is_freebies==="Y"?0:t.custom_price})))},[d,l.length,s,i]),e.jsx(Os,{name:s,render:t=>e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h5",{children:"Addons"}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>t.push({id:"",name:"",base_price:0,custom_price:"",is_freebies:"N"}),children:"Add Addon"}),(()=>{const g=a.filter(u=>u.id);return g.length>0&&e.jsxs("button",{type:"button",className:"btn btn-outline-primary d-inline-flex align-items-center",id:"tooltip-retrieve-addons",onClick:()=>{g.forEach(u=>t.push(u)),n(u=>u.filter(x=>!x.id))},children:[e.jsx("i",{className:"bi bi-arrow-counterclockwise fs-5"}),e.jsx(Je,{anchorId:"tooltip-retrieve-addons",place:"top",content:`Retrieve Existing (${g.length})`})]})})()]})]}),l.length===0&&e.jsxs("div",{className:"alert alert-secondary text-center rounded-3 py-4 shadow-sm",children:[e.jsx("i",{className:"bi bi-plus-circle fs-3 d-block mb-2 text-muted"}),e.jsx("span",{className:"fw-semibold text-muted",children:"No addons added yet."})]}),l.map((g,u)=>{const x=`addons[${u}].id`,w=`addons[${u}].custom_price`,E=r[x],A=r[w],B=typeof o.addons<"u"?o.addons[u]:o;return e.jsxs("div",{className:"row align-items-center mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs("select",{name:`${s}[${u}].id`,value:g.id||"",className:F("form-control",{"is-invalid":E&&((B==null?void 0:B.id)??!0)}),onChange:R=>{const q=R.target.value,L=p.find(te=>te.id===q);i(`${s}[${u}].id`,q),L&&(h(`${s}[${u}].id`,!1),i(`${s}[${u}].name`,L.name),i(`${s}[${u}].base_price`,L.base_price),i(`${s}[${u}].is_freebies`,L.is_freebies),i(`${s}[${u}].custom_price`,L.is_freebies==="Y"?0:""))},children:[e.jsx("option",{value:"",children:"Select Addon"}),p.map(R=>e.jsx("option",{value:R.id,children:R.name},R.id))]}),E&&((B==null?void 0:B.id)??!0)&&e.jsx("div",{className:"invalid-feedback",children:E})]}),e.jsx("div",{className:"col-md-3",children:e.jsx("input",{type:"number",placeholder:"Base Price",className:"form-control",value:g.base_price,readOnly:!0})}),e.jsx("div",{className:"col-md-3",children:g.is_freebies==="Y"?e.jsx("input",{type:"text",className:"form-control",value:"Freebie",readOnly:!0}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",name:`${s}[${u}].custom_price`,value:g.custom_price,min:0,step:.01,placeholder:"Custom Price",className:F("form-control",{"is-invalid":A&&((B==null?void 0:B.custom_price)??!0)}),onChange:R=>i(`${s}[${u}].custom_price`,R.target.value),onBlur:()=>h(`${s}[${u}].custom_price`,!1)}),A&&((B==null?void 0:B.custom_price)??!0)&&e.jsx("div",{className:"invalid-feedback",children:A})]})}),e.jsx("div",{className:"col-md-2",children:e.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>{n(R=>[...R,l[u]]),t.remove(u),h(`${s}[${u}].id`,!1),h(`${s}[${u}].custom_price`,!1)},children:"×"})})]},u)})]})})},Nt=({name:s,formik:r,preview:o,setPreview:m,label:v="Upload Image",accept:i="image/*"})=>{const h=c.useRef(null),[d,f]=c.useState(0),p=["image/jpeg","image/jpg","image/png"],y=n=>{var g;const l=(g=n.target.files)==null?void 0:g[0];if(!l)return;if(!p.includes(l.type)){H.fire({icon:"info",title:"Only JPG, JPEG, PNG files are allowed."});return}r.setFieldValue(s,l),console.log(r.values),o&&o.startsWith("blob:")&&URL.revokeObjectURL(o);const t=URL.createObjectURL(l);m(t),f(100),r.setFieldValue(s.replace(".image",".image_preview"),t),n.target.value=""},a=()=>{o&&o.startsWith("blob:")&&URL.revokeObjectURL(o),r.setFieldValue(s,null),m(null),f(0)};return e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:v}),e.jsx("div",{className:"position-relative image-preview-container image-input-wrapper w-150px h-150px",children:o?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:o,alt:"Preview",className:"img-thumbnail preview-image"}),e.jsx("div",{className:"progress mt-1",style:{height:"5px"},children:e.jsx("div",{className:"progress-bar",role:"progressbar",style:{width:`${d}%`},"aria-valuenow":d,"aria-valuemin":0,"aria-valuemax":100})}),e.jsx("button",{type:"button",className:"btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-body shadow position-absolute top-0 end-0 m-1",onClick:a,children:"×"})]}):e.jsx("img",{src:"/media/default.jpg",alt:"Default Preview",className:"img-thumbnail preview-image"})}),e.jsx("button",{type:"button",className:"btn btn-secondary mt-2",onClick:()=>{var n;return(n=h.current)==null?void 0:n.click()},children:"Select Image"}),e.jsx("input",{type:"file",accept:i,onChange:y,ref:h,className:"d-none"}),r.touched[s]&&r.errors[s]&&e.jsx("div",{className:"invalid-feedback d-block",children:r.errors[s]})]})},Js=({name:s,errors:r,touched:o,onBlur:m,onChange:v,setFieldValue:i,setFieldTouched:h,initialPreviews:d=[]})=>{const[f,p]=c.useState([]),[y,a]=c.useState([]);return c.useEffect(()=>{d.length>0&&p(d.map(n=>n.filter(Boolean)))},[d]),e.jsx(Os,{name:s,render:n=>e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("h5",{children:"Variants"}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>{n.push({id:"",sku:"",variant_name:"",quantity_on_hand:"",reorder_point:"",cost_price:"",selling_price:"",image:null,image_preview:null}),p(l=>[...l,[]])},children:"Add Variant"}),y.filter(l=>l.id).length>0&&e.jsxs("button",{type:"button",className:"btn btn-outline-primary d-inline-flex align-items-center",id:"tooltip-retrieve-variants",onClick:()=>{y.filter(t=>t.id).forEach(t=>n.push(t)),a(t=>t.filter(g=>!g.id))},children:[e.jsx("i",{className:"bi bi-arrow-counterclockwise fs-5"}),e.jsx(Je,{anchorId:"tooltip-retrieve-variants",place:"top",content:`Retrieve Existing (${y.filter(l=>l.id).length})`})]})]})]}),n.form.values[s].length===0&&e.jsxs("div",{className:"alert alert-secondary text-center rounded-3 py-4 shadow-sm",children:[e.jsx("i",{className:"bi bi-plus-circle fs-3 d-block mb-2 text-muted"}),e.jsx("span",{className:"fw-semibold text-muted",children:"No variant added yet."})]}),e.jsx("div",{className:"row",children:n.form.values[s].map((l,t)=>{const g=`variants[${t}].quantity_on_hand`,u=`variants[${t}].sku`,x=`variants[${t}].variant_name`,w=`variants[${t}].image`,E=r[g],A=r[u],B=r[x],R=r[w],q=typeof o.variants<"u"?o.variants[t]:o;return e.jsx("div",{className:"col-md-3 mb-4",children:e.jsxs("div",{className:"border rounded p-3 mb-3",children:[e.jsx(Nt,{name:`variants.${t}.image`,formik:n.form,preview:typeof l.image_preview=="string"?l.image_preview:null,setPreview:L=>{const te=[...n.form.values.variants];te[t].image_preview=L,n.form.setFieldValue(`variants.${t}.image_preview`,L)},label:"Variant Image"}),R&&((q==null?void 0:q.image)??!0)&&e.jsx("div",{className:"text-danger",children:R}),e.jsx("label",{className:"form-label required",children:"Variant SKU"}),e.jsx("input",{type:"text",className:F("form-control mb-2",{"is-invalid":A&&((q==null?void 0:q.sku)??!0)}),placeholder:"Variant SKU",...n.form.getFieldProps(u),onBlur:()=>h(u,!1)}),e.jsx("label",{className:"form-label required",children:"Variant Name"}),e.jsx("input",{type:"text",className:F("form-control mb-2",{"is-invalid":B&&((q==null?void 0:q.variant_name)??!0)}),placeholder:"Variant Name",...n.form.getFieldProps(x),onBlur:()=>h(x,!1)}),e.jsx("label",{className:"form-label required",children:"Quantity"}),e.jsx("input",{type:"number",className:F("form-control mb-2",{"is-invalid":E&&((q==null?void 0:q.quantity_on_hand)??!0)}),placeholder:"Quantity on Hand",...n.form.getFieldProps(g),onBlur:()=>h(g,!1)}),e.jsxs("label",{className:"form-label",children:["Reorder Point (optional)",e.jsx("span",{id:`tooltip-reorders-${t}`,className:"ms-2 cursor-pointer text-primary",children:"ℹ️"}),e.jsx(Je,{anchorId:`tooltip-reorders-${t}`,place:"right",content:"If Reorder point is 0 or empty, the main product re order points will be used."})]}),e.jsx("input",{type:"number",className:"form-control mb-2",placeholder:"Reorder Point",...n.form.getFieldProps(`${s}[${t}].reorder_point`)}),e.jsxs("label",{className:"form-label",children:["Cost Price (optional)",e.jsx("span",{id:`tooltip-cost-${t}`,className:"ms-2 cursor-pointer text-primary",children:"ℹ️"}),e.jsx(Je,{anchorId:`tooltip-cost-${t}`,place:"right",content:"If Cost Price is 0 or empty, the main product price will be used."})]}),e.jsx("input",{type:"number",className:"form-control mb-2",placeholder:"Cost Price",...n.form.getFieldProps(`${s}[${t}].cost_price`)}),e.jsxs("label",{className:"form-label",children:["Selling Price (optional)",e.jsx("span",{id:`tooltip-selling-${t}`,className:"ms-2 cursor-pointer text-primary",children:"ℹ️"}),e.jsx(Je,{anchorId:`tooltip-selling-${t}`,place:"right",content:"If Selling Price is 0 or empty, the main product price will be used."})]}),e.jsx("input",{type:"number",className:"form-control mb-2",placeholder:"Selling Price",...n.form.getFieldProps(`${s}[${t}].selling_price`)}),e.jsx("button",{type:"button",className:"btn btn-sm btn-danger mt-2",onClick:()=>{l.id&&a(L=>[...L,l]),n.remove(t),p(L=>L.filter((te,Re)=>Re!==t)),h(u,!1),h(x,!1),h(w,!1),h(g,!1)},children:"Remove Variant"})]})},t)})})]})})};async function wt(){try{const r=(await ye.get("/brands")).data;return Array.isArray(r)?r:(console.warn("Unexpected response shape:",r),[])}catch(s){return console.error("Failed to fetch categories:",s),[]}}const Ws=({setClass:s,name:r,value:o,onChange:m,onBlur:v,error:i,touched:h})=>{const[d,f]=c.useState([]);return c.useEffect(()=>{wt().then(p=>{const y=p.map(a=>({value:a.id,label:a.name}));f(y)}).catch(console.error)},[]),e.jsxs("div",{className:s,children:[e.jsx("label",{className:"form-label required",children:"Brands"}),e.jsx(ys,{name:r,options:d,value:d.find(p=>p.value===o)||null,onChange:p=>m({target:{name:r,value:(p==null?void 0:p.value)||""}}),onBlur:v,className:F("form-select-solid text-dark",{"is-invalid":i&&h},{})}),i&&h&&e.jsx("div",{className:"invalid-feedback",children:i})]})},K=[U().shape({sku:T().min(1).max(50).required("SKU is required"),name:T().min(1).max(50).required("Product name is required"),description:T().min(1).required("Description is required"),brand_id:T().required("Product Brand is required"),category_id:T().required("Category is required"),supplier_id:T().required("Supplier is required")}),U().shape({quantity_on_hand:I().required("Quantity is required").min(1),reorder_point:I().required("Reorder point is required").min(0),cost_price:I().required("Cost price is required").min(0),selling_price:I().required("Selling price is required").min(0)}),U().shape({images:Te().of(is().test("fileType","Only JPG, JPEG, PNG files are allowed",s=>s?s instanceof File?["image/jpeg","image/jpg","image/png"].includes(s.type):!1:!0).test("fileSize","File size is too large (max 5MB)",s=>s?s instanceof File?s.size<=5*1024*1024:!1:!0)).test("images","At least one image required",function(s){var o;const r=(o=this.options.context)==null?void 0:o.imagePreviews;return Array.isArray(s)&&s.length>0||r&&r.length>0})}),U().shape({addons:Te().min(0,"At least one addon is required").of(U().shape({id:T().required("Addon is required"),is_freebies:T().oneOf(["Y","N"],"Must be Y or N").required("is_freebies is required"),base_price:I().transform((s,r)=>r===""?null:s).min(0,"Base price cannot be negative").when("is_freebies",{is:"Y",then:s=>s.notRequired().nullable(),otherwise:s=>s.required("Base price is required")}),custom_price:I().transform((s,r)=>r===""?null:s).required("Custom price is required").min(0,"Custom price cannot be negative").when("is_freebies",{is:"Y",then:s=>s.test("must-be-zero-if-freebie","Custom price must be 0 for freebies",r=>r===0||r===null||r===void 0),otherwise:s=>s.test("custom-vs-base","Custom price cannot be less than base price",function(r){const{base_price:o}=this.parent;return r==null?!0:r>=o})})}))}),U().shape({variants:Te().of(U().shape({sku:T().required("Variant SKU is required"),variant_name:T().required("Variant name is required"),quantity_on_hand:I().required("Quantity on hand is required").min(0),reorder_point:I().transform((s,r)=>r===""?null:s).nullable(),cost_price:I().transform((s,r)=>r===""?null:s).nullable(),selling_price:I().transform((s,r)=>r===""?null:s).nullable(),image:is().nullable().test("required","Variant image is required",function(s){const o=this.parent??{};return o.image_preview&&typeof o.image_preview=="string"&&o.image_preview.trim()!==""?!0:s?Array.isArray(s)?s.length===0?!1:s.some(m=>typeof m=="string"||m instanceof File):typeof s=="string"||s instanceof File:!1}).test("fileType","Only JPG, JPEG, PNG files are allowed",s=>s?Array.isArray(s)?s.every(r=>typeof r=="string"||r instanceof File&&["image/jpeg","image/jpg","image/png"].includes(r.type)):typeof s=="string"?!0:s instanceof File?["image/jpeg","image/jpg","image/png"].includes(s.type):!1:!0).test("fileSize","File size is too large (max 5MB)",s=>s?Array.isArray(s)?s.every(r=>typeof r=="string"||r instanceof File&&r.size<=5*1024*1024):typeof s=="string"?!0:s instanceof File?s.size<=5*1024*1024:!0:!0)}))})],ns=[{label:"Basic Info"},{label:"Inventory & Pricing"},{label:"Images"},{label:"Addons"},{label:"Variants"}],St=({setPage:s,setRefreshTable:r,onSubmit:o})=>{const[m,v]=c.useState([]),[i,h]=c.useState(1),{createProduct:d}=os(),f=async(a,n)=>{const l=await n();Object.keys(l).length>0||h(t=>Math.min(t+1,ns.length))},p=()=>h(a=>Math.max(a-1,1)),y=(a,n)=>{const l={};if(a===4){const t=Array.isArray(n.addons)?n.addons:[];l.addons=t.map(()=>({id:!0,name:!0,base_price:!0,custom_price:!0,is_freebies:!0}))}else(K[a-1]&&K[a-1].fields?Object.keys(K[a-1].fields):[]).forEach(g=>l[g]=!0);return l};return e.jsx(Is,{initialValues:{sku:"",name:"",description:"",brand_id:"",category_id:"",supplier_id:"",quantity_on_hand:"",reorder_point:"",cost_price:"",selling_price:"",images:[],primary_index:0,addons:[],variants:[]},validationSchema:U(),validateOnChange:!1,validateOnBlur:!1,onSubmit:async(a,{resetForm:n})=>{await d(a,n,r,s),o==null||o(a)},children:a=>e.jsxs("form",{noValidate:!0,onSubmit:a.handleSubmit,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"d-flex justify-content-between align-items-center mb-2",children:ns.map((n,l)=>e.jsx("div",{className:`flex-fill text-center ${i===l+1?"fw-bold text-primary":"text-muted"}`,children:n.label},l))}),e.jsx("div",{className:"progress",style:{height:"6px"},children:e.jsx("div",{className:"progress-bar bg-primary",role:"progressbar",style:{width:`${i/ns.length*100}%`}})})]}),i===1&&e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label required",children:"SKU"}),e.jsx("input",{type:"text",className:F("form-control",{"is-invalid":a.touched.sku&&a.errors.sku}),...a.getFieldProps("sku"),onChange:n=>{a.handleChange(n),K[i-1].validateAt("sku",a.values).then(()=>a.setFieldError("sku","")).catch(t=>a.setFieldError("sku",t.message))}}),a.touched.sku&&a.errors.sku&&e.jsx("div",{className:"invalid-feedback",children:a.errors.sku})]}),e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label required",children:"Product Name"}),e.jsx("input",{type:"text",className:F("form-control",{"is-invalid":a.touched.name&&a.errors.name}),...a.getFieldProps("name"),onChange:n=>{a.handleChange(n),K[i-1].validateAt("name",a.values).then(()=>a.setFieldError("name","")).catch(t=>a.setFieldError("name",t.message))}}),a.touched.name&&a.errors.name&&e.jsx("div",{className:"invalid-feedback",children:a.errors.name})]}),e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label required",children:"Description"}),e.jsx("textarea",{className:F("form-control",{"is-invalid":a.touched.description&&a.errors.description}),rows:4,...a.getFieldProps("description"),onChange:n=>{a.handleChange(n),K[i-1].validateAt("description",a.values).then(()=>a.setFieldError("description","")).catch(t=>a.setFieldError("description",t.message))}}),a.touched.description&&a.errors.description&&e.jsx("div",{className:"invalid-feedback",children:a.errors.description})]}),e.jsx("div",{className:"col-md-6",children:e.jsx(Ws,{setClass:"mb-3",name:"brand_id",value:a.values.brand_id,onChange:n=>{a.handleChange(n),K[i-1].validateAt("brand_id",{...a.values,[n.target.name]:n.target.value}).then(()=>a.setFieldError("brand_id","")).catch(t=>a.setFieldError("brand_id",t.message))},onBlur:n=>{a.handleBlur(n)},error:a.errors.brand_id,touched:a.touched.brand_id})}),e.jsx("div",{className:"col-md-6",children:e.jsx(Us,{setClass:"mb-3",name:"category_id",value:a.values.category_id,onChange:n=>{a.handleChange(n),K[i-1].validateAt("category_id",{...a.values,[n.target.name]:n.target.value}).then(()=>a.setFieldError("category_id","")).catch(t=>a.setFieldError("category_id",t.message))},onBlur:n=>{a.handleBlur(n)},error:a.errors.category_id,touched:a.touched.category_id})}),e.jsx("div",{className:"col-md-6 mb-3",children:e.jsx(Ys,{setClass:"mb-3",name:"supplier_id",value:a.values.supplier_id,onChange:n=>{a.handleChange(n),K[i-1].validateAt("supplier_id",{...a.values,[n.target.name]:n.target.value}).then(()=>a.setFieldError("supplier_id","")).catch(t=>a.setFieldError("supplier_id",t.message))},onBlur:n=>{a.handleBlur(n)},error:a.errors.supplier_id,touched:a.touched.supplier_id})})]}),i===2&&e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label required",children:"Quantity on Hand"}),e.jsx("input",{type:"number",className:F("form-control",{"is-invalid":a.touched.quantity_on_hand&&a.errors.quantity_on_hand}),...a.getFieldProps("quantity_on_hand"),onBlur:n=>{a.handleBlur(n),K[i-1].validateAt("quantity_on_hand",a.values).then(()=>a.setFieldError("quantity_on_hand","")).catch(t=>a.setFieldError("quantity_on_hand",t.message))}})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label required",children:"Reorder Point"}),e.jsx("input",{type:"number",className:F("form-control",{"is-invalid":a.touched.reorder_point&&a.errors.reorder_point}),...a.getFieldProps("reorder_point"),onBlur:n=>{a.handleBlur(n),K[i-1].validateAt("reorder_point",a.values).then(()=>a.setFieldError("reorder_point","")).catch(t=>a.setFieldError("reorder_point",t.message))}})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label required",children:"Cost Price"}),e.jsx("input",{type:"number",className:F("form-control",{"is-invalid":a.touched.cost_price&&a.errors.cost_price}),...a.getFieldProps("cost_price"),onBlur:n=>{a.handleBlur(n),K[i-1].validateAt("cost_price",a.values).then(()=>a.setFieldError("cost_price","")).catch(t=>a.setFieldError("cost_price",t.message))}})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label required",children:"Selling Price"}),e.jsx("input",{type:"number",className:F("form-control",{"is-invalid":a.touched.selling_price&&a.errors.selling_price}),...a.getFieldProps("selling_price"),onBlur:n=>{a.handleBlur(n),K[i-1].validateAt("selling_price",a.values).then(()=>a.setFieldError("selling_price","")).catch(t=>a.setFieldError("selling_price",t.message))}})]})]}),i===3&&e.jsx(e.Fragment,{children:e.jsx(Ks,{name:"images",formik:a,previews:m,setPreviews:v,label:"Product Images",maxFiles:5})}),i===4&&e.jsx(e.Fragment,{children:e.jsx(Gs,{name:"addons",errors:a.errors,touched:a.touched,onBlur:n=>{a.handleBlur(n)},onChange:n=>{a.handleChange(n)},setFieldValue:a.setFieldValue,setFieldTouched:a.setFieldTouched})}),i===5&&e.jsx(Js,{name:"variants",errors:a.errors,touched:a.touched,onBlur:n=>{a.handleBlur(n)},onChange:n=>{a.handleChange(n)},setFieldValue:a.setFieldValue,setFieldTouched:a.setFieldTouched}),e.jsxs("div",{className:"d-flex justify-content-between mt-4",children:[i>1&&e.jsx("button",{type:"button",className:"btn btn-light",onClick:p,children:"Back"}),i<ns.length?e.jsx("button",{type:"button",className:"btn btn-primary",onClick:async()=>{try{Object.fromEntries(Object.keys(K[i-1].fields).map(n=>[n,!0])),await K[i-1].validate(a.values,{abortEarly:!1}),f(a.values,a.validateForm)}catch(n){const l={};n.inner.forEach(g=>{l[g.path]=g.message}),a.setErrors(l);const t=y(i,a.values);a.setTouched({...a.touched||{},...t})}},children:"Next"}):e.jsx("button",{type:"button",className:"btn btn-success",onClick:async()=>{try{await K[i-1].validate(a.values,{abortEarly:!1}),console.log(a.values),a.handleSubmit()}catch(n){const l={};n.inner.forEach(g=>{l[g.path]=g.message}),console.log(l),a.setErrors(l);const t=y(i,a.values);a.setTouched({...a.touched||{},...t})}},children:"Submit"})]})]})})},ls=[{label:"Basic Info"},{label:"Inventory & Pricing"},{label:"Images"},{label:"Addons"},{label:"Variants"}],bs=[U().shape({sku:T().min(1).max(50).required("SKU is required"),name:T().min(1).max(50).required("Product name is required"),description:T().min(1).required("Description is required"),brand_id:T().required("Brand is required"),category_id:T().required("Category is required"),supplier_id:T().required("Supplier is required")}),U().shape({add_new_stocks:I().min(0),reorder_point:I().required("Reorder point is required").min(0),cost_price:I().required("Cost price is required").min(0),selling_price:I().required("Selling price is required").min(0)}),U().shape({images:Te().of(is().test("fileType","Only JPG, JPEG, PNG files are allowed",s=>s?s instanceof File?["image/jpeg","image/jpg","image/png"].includes(s.type):!1:!0).test("fileSize","File size is too large (max 5MB)",s=>s?s instanceof File?s.size<=5*1024*1024:!1:!0)).test("images","At least one image required",function(s){var o;const r=(o=this.options.context)==null?void 0:o.imagePreviews;return Array.isArray(s)&&s.length>0||r&&r.length>0})}),U().shape({addons:Te().min(0,"At least one addon is required").of(U().shape({id:T().required("Addon is required"),is_freebies:T().oneOf(["Y","N"],"Must be Y or N").required("is_freebies is required"),base_price:I().transform((s,r)=>r===""?null:s).min(0,"Base price cannot be negative").when("is_freebies",{is:"Y",then:s=>s.notRequired().nullable(),otherwise:s=>s.required("Base price is required")}),custom_price:I().transform((s,r)=>r===""?null:s).required("Custom price is required").min(0,"Custom price cannot be negative").when("is_freebies",{is:"Y",then:s=>s.test("must-be-zero-if-freebie","Custom price must be 0 for freebies",r=>r===0||r===null||r===void 0),otherwise:s=>s.test("custom-vs-base","Custom price cannot be less than base price",function(r){const{base_price:o}=this.parent;return r==null?!0:r>=o})})}))}),U().shape({variants:Te().of(U().shape({sku:T().required("Variant SKU is required"),variant_name:T().required("Variant name is required"),quantity_on_hand:I().required("Quantity on hand is required").min(0),reorder_point:I().transform((s,r)=>r===""?null:s).nullable(),cost_price:I().transform((s,r)=>r===""?null:s).nullable(),selling_price:I().transform((s,r)=>r===""?null:s).nullable(),image_preview:T(),image:is().nullable().test("required","Variant image is required",function(s){const o=this.parent??{};return o.image_preview&&typeof o.image_preview=="string"&&o.image_preview.trim()!==""?!0:s?Array.isArray(s)?s.length===0?!1:s.some(m=>typeof m=="string"||m instanceof File):typeof s=="string"||s instanceof File:!1}).test("fileType","Only JPG, JPEG, PNG files are allowed",s=>s?Array.isArray(s)?s.every(r=>typeof r=="string"||r instanceof File&&["image/jpeg","image/jpg","image/png"].includes(r.type)):typeof s=="string"?!0:s instanceof File?["image/jpeg","image/jpg","image/png"].includes(s.type):!1:!0).test("fileSize","File size is too large (max 5MB)",s=>s?Array.isArray(s)?s.every(r=>typeof r=="string"||r instanceof File&&r.size<=5*1024*1024):typeof s=="string"?!0:s instanceof File?s.size<=5*1024*1024:!0:!0)}))})],Et=({productID:s,data:r,setRefreshTable:o,onSubmit:m})=>{var a,n,l;const[v,i]=c.useState(1),[h,d]=c.useState(((a=r==null?void 0:r.images)==null?void 0:a.map(t=>t.image_cover))||[]),f=os(),p=async(t,g)=>{const u=await g();Object.keys(u).length>0||i(x=>Math.min(x+1,ls.length))},y=()=>i(t=>Math.max(t-1,1));return e.jsx(Is,{initialValues:{sku:r.sku,name:r.name,description:r.description,category_id:r.category_id,brand_id:r.brand_id,supplier_id:r.supplier_id,quantity_on_hand:r.quantity_on_hand,add_new_stocks:0,reorder_point:r.reorder_point,cost_price:r.cost_price,selling_price:r.selling_price,images:[],addons:((n=r.product_addons)==null?void 0:n.map(t=>{var g;return{id:t.addon_id,base_price:t.base_price??"",custom_price:t.custom_price??"",is_freebies:((g=t.addon)==null?void 0:g.is_freebies)??"N"}}))||[],variants:((l=r.variants)==null?void 0:l.map(t=>({id:t.id_encrypted,sku:t.sku??"",variant_name:t.variant_name??"",quantity_on_hand:t.quantity_on_hand??"",reorder_point:t.reorder_point??"",cost_price:t.cost_price??"",selling_price:t.selling_price??"",image:"",image_preview:t.image_cover??null})))||[]},validationSchema:U(),validateOnChange:!0,validateOnBlur:!0,onSubmit:async(t,{resetForm:g})=>{await f.updateProduct(t,s,o),m==null||m(t)},context:{imagePreviews:h},children:t=>{var g;return e.jsxs("form",{noValidate:!0,onSubmit:t.handleSubmit,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"d-flex justify-content-between align-items-center mb-2",children:ls.map((u,x)=>e.jsx("div",{onClick:()=>i(x+1),className:`flex-fill text-center cursor-pointer ${v===x+1?"fw-bold text-primary":"text-muted"}`,children:u.label},x))}),e.jsx("div",{className:"progress",style:{height:"6px"},children:e.jsx("div",{className:"progress-bar bg-primary",role:"progressbar",style:{width:`${v/ls.length*100}%`}})})]}),v===1&&e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label required",children:"SKU"}),e.jsx("input",{type:"text",className:F("form-control ",{"is-invalid":t.touched.sku&&t.errors.sku}),...t.getFieldProps("sku")}),t.touched.sku&&typeof t.errors.sku=="string"&&e.jsx("div",{className:"invalid-feedback",children:t.errors.sku})]}),e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label required",children:"Product Name"}),e.jsx("input",{type:"text",className:F("form-control",{"is-invalid":t.touched.name&&t.errors.name}),...t.getFieldProps("name")}),t.touched.name&&typeof t.errors.name=="string"&&e.jsx("div",{className:"invalid-feedback",children:t.errors.name})]}),e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label required",children:"Description"}),e.jsx("textarea",{className:F("form-control",{"is-invalid":t.touched.description&&t.errors.description}),rows:4,...t.getFieldProps("description")}),t.touched.description&&typeof t.errors.description=="string"&&e.jsx("div",{className:"invalid-feedback",children:t.errors.description})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(Ws,{setClass:"mb-3",name:"brand_id",value:t.values.brand_id,onChange:t.handleChange,onBlur:t.handleBlur,error:t.errors.brand_id&&typeof t.errors.brand_id=="string"?t.errors.brand_id:void 0,touched:!!t.touched.brand_id}),t.touched.brand_id&&typeof t.errors.brand_id=="string"&&e.jsx("div",{className:"invalid-feedback",children:t.errors.brand_id})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(Us,{setClass:"mb-3",name:"category_id",value:t.values.category_id,onChange:t.handleChange,onBlur:t.handleBlur,error:t.errors.category_id&&typeof t.errors.category_id=="string"?t.errors.category_id:void 0,touched:!!t.touched.category_id}),t.touched.category_id&&typeof t.errors.category_id=="string"&&e.jsx("div",{className:"invalid-feedback",children:t.errors.category_id})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx(Ys,{setClass:"mb-3",name:"supplier_id",value:t.values.supplier_id,onChange:t.handleChange,onBlur:t.handleBlur,error:t.errors.supplier_id&&typeof t.errors.supplier_id=="string"?t.errors.supplier_id:void 0,touched:!!t.touched.supplier_id}),t.touched.supplier_id&&typeof t.errors.supplier_id=="string"&&e.jsx("div",{className:"invalid-feedback",children:t.errors.supplier_id})]})]}),v===2&&e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Quantity on Hand"}),e.jsx("input",{type:"number",className:"form-control",...t.getFieldProps("quantity_on_hand"),readOnly:!0})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Add New Stocks"}),e.jsx("input",{type:"number",className:F("form-control",{"is-invalid":t.touched.add_new_stocks&&t.errors.add_new_stocks}),...t.getFieldProps("add_new_stocks")})]}),e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label",children:"Reorder Point"}),e.jsx("input",{type:"number",className:F("form-control",{"is-invalid":t.touched.reorder_point&&t.errors.reorder_point}),...t.getFieldProps("reorder_point")})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Cost Price"}),e.jsx("input",{type:"number",className:F("form-control",{"is-invalid":t.touched.cost_price&&t.errors.cost_price}),...t.getFieldProps("cost_price")})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Selling Price"}),e.jsx("input",{type:"number",className:F("form-control",{"is-invalid":t.touched.selling_price&&t.errors.selling_price}),...t.getFieldProps("selling_price")})]})]}),v===3&&e.jsx(Ks,{name:"images",formik:t,previews:h,setPreviews:d,label:"Product Images",maxFiles:5,getPrimaryIndex:(r==null?void 0:r.primary_index)??0}),v===4&&e.jsx(Gs,{name:"addons",errors:t.errors,touched:t.touched,onBlur:u=>{t.handleBlur(u)},onChange:u=>{t.handleChange(u)},setFieldValue:t.setFieldValue,setFieldTouched:t.setFieldTouched}),v===5&&e.jsx(Js,{name:"variants",errors:t.errors,touched:t.touched,onBlur:u=>{t.handleBlur(u)},onChange:u=>{t.handleChange(u)},setFieldValue:t.setFieldValue,setFieldTouched:t.setFieldTouched,initialPreviews:((g=r.variants)==null?void 0:g.map(u=>[u.image]))||[]}),e.jsxs("div",{className:"d-flex justify-content-between mt-4",children:[v>1&&e.jsx("button",{type:"button",className:"btn btn-light",onClick:y,children:"Back"}),v<ls.length?e.jsx("button",{type:"button",className:"btn btn-primary",onClick:async()=>{try{Object.keys(bs[v-1].fields).forEach(u=>{t.setFieldTouched(u,!0,!1)}),await bs[v-1].validate(t.values,{abortEarly:!1,context:{imagePreviews:h}}),p(t.values,t.validateForm)}catch(u){const x={};u.inner.forEach(w=>{x[w.path]=w.message}),t.setErrors(x)}},children:"Next"}):e.jsx("button",{type:"button",className:"btn btn-success",onClick:async()=>{try{await bs[v-1].validate(t.values,{abortEarly:!1,context:{imagePreviews:h}}),t.handleSubmit()}catch(u){const x={};u.inner.forEach(w=>{x[w.path]=w.message}),console.log(x),t.setErrors(x)}},children:"Submit"})]})]})}})},Ct=({data:s,loading:r,pagination:o,sortColumn:m,sortDirection:v,onPageChange:i,onSortChange:h,onRestore:d,onSearchChange:f,setRefreshTable:p,setRefreshFirstTable:y})=>{const a=[{title:"#",key:"row_number",sortable:!0},{title:"Items",key:"image_cover",render:n=>{var l;return e.jsx(zs,{image:((l=n.primary_image)==null?void 0:l.image_cover)??fs("media/products/default.jpg"),mainTitle:n.name,subTitle:n.sku})}},{title:"QTY on hand",key:"quantity_on_hand",sortable:!0,render:n=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"d-flex flex-column align-items-start",children:[e.jsxs("span",{className:"mb-2",children:["QTY: ",n.quantity_on_hand]}),e.jsx(Ms,{color:n.stock_status.color,title:n.stock_status.title})]})})},{title:"Price",key:"cost_price",sortable:!0,render:n=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"d-flex flex-column align-items-start",children:[e.jsxs("span",{className:"mb-2",children:["Cost: ",e.jsx(ie,{value:n.cost_price||0})]}),e.jsxs("span",{className:"mb-2",children:["Selling: ",e.jsx(ie,{value:n.selling_price||0})]})]})})},{title:"Variants",key:"variants",render:n=>e.jsx("div",{className:"d-flex flex-column gap-1",children:n.variants&&n.variants.length>0?n.variants.map((l,t)=>e.jsxs("div",{className:"border rounded p-2 bg-light",children:[e.jsxs("div",{className:"fw-semibold small",children:["SKU: ",e.jsx("span",{className:"text-primary",children:l.sku})]}),e.jsxs("div",{className:"small",children:["Name: ",l.variant_name??"-"]}),e.jsxs("div",{className:"small",children:["Qty: ",e.jsx("span",{className:"fw-bold",children:l.quantity_on_hand??0})]})]},t)):e.jsx("span",{className:"text-muted small",children:"No variants"})})},{title:"Created At",key:"created_at_format",sortable:!0},{title:"Action",key:"id_encrypted",render:n=>e.jsx(Vs,{restoreAction:()=>d(n.id_encrypted,p,y)})}];return e.jsx("div",{className:"table-responsive",children:r?e.jsx("div",{className:"alert alert-info",children:"Loading..."}):e.jsx(Ds,{data:s,columns:a,loading:r,pagination:o,sortColumn:m,sortDirection:v,onPageChange:i,onSortChange:h,onSearchChange:f})})},qt=({onRefreshFirstTable:s})=>{const r=Ls("/admin/product/archived/list"),{restoreProduct:o}=os();return e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsx(Ct,{data:r.data,loading:r.loading,pagination:r.pagination,sortColumn:r.sortColumn,sortDirection:r.sortDirection,onPageChange:r.setPage,onSortChange:(m,v)=>{r.setSortColumn(m),r.setSortDirection(v)},onRestore:o,onSearchChange:m=>{r.setPage(1),r.setSearch(m)},setRefreshTable:r.setRefreshTable,setRefreshFirstTable:s})})})},At=({preview:s,index:r,allImages:o})=>{const[m,v]=c.useState(null);return e.jsxs("div",{children:[e.jsx("img",{src:s,alt:`Preview ${r}`,className:"img-thumbnail preview-image",onClick:()=>v(r),style:{width:130,height:130,objectFit:"cover",borderRadius:8,cursor:"pointer"}}),m!==null&&e.jsx(at,{open:m!==null,close:()=>v(null),index:m,slides:o.filter(Boolean).map(i=>({src:i}))})]})},Rs=[{label:"Basic Info"},{label:"Inventory & Pricing"},{label:"Images"},{label:"Addons"},{label:"Variants"}],Pt=({data:s})=>{var m,v,i;const[r,o]=c.useState(1);return c.useState(((m=s==null?void 0:s.images)==null?void 0:m.map(h=>h.image_cover))||[]),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"d-flex justify-content-between align-items-center mb-2",children:Rs.map((h,d)=>e.jsx("div",{onClick:()=>o(d+1),className:`flex-fill text-center cursor-pointer ${r===d+1?"fw-bold text-primary":"text-muted"}`,children:h.label},d))}),e.jsx("div",{className:"progress",style:{height:"6px"},children:e.jsx("div",{className:"progress-bar bg-primary",role:"progressbar",style:{width:`${r/Rs.length*100}%`}})})]}),r===1&&e.jsxs("div",{className:"row",children:[e.jsx("hr",{}),e.jsx("div",{className:"col-md-12 mb-3",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("span",{className:"fw-bold me-2",children:"SKU:"}),e.jsx("span",{children:s.sku||"-"})]})}),e.jsx("div",{className:"col-md-12 mb-3",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("span",{className:"fw-bold me-2",children:"Product Name:"}),e.jsx("span",{children:s.name||"-"})]})}),e.jsx("div",{className:"col-md-12 mb-3",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("span",{className:"fw-bold me-2",children:"Supplier:"}),e.jsx("span",{children:s.supplier.name||"-"})]})}),e.jsx("div",{className:"col-md-12 mb-3",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("span",{className:"fw-bold me-2",children:"Brand:"}),e.jsx("span",{children:s.brand.name||"-"})]})}),e.jsx("div",{className:"col-md-12 mb-3",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("span",{className:"fw-bold me-2",children:"Category:"}),e.jsx("span",{children:s.category.name||"-"})]})}),e.jsx("hr",{}),e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("span",{className:"fw-bold me-2",children:"Description:"}),e.jsx("div",{className:"form-control-plaintext",children:s.description||"-"})]})]}),r===2&&e.jsxs("div",{className:"row",children:[e.jsx("hr",{}),e.jsx("div",{className:"col-md-12 mb-3",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("span",{className:"fw-bold me-2",children:"Quantity on Hand:"}),e.jsx("span",{children:s.quantity_on_hand||"-"})]})}),e.jsx("div",{className:"col-md-12 mb-3",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("span",{className:"fw-bold me-2",children:"Reorder Point:"}),e.jsx("span",{children:s.reorder_point||"-"})]})}),e.jsx("div",{className:"col-md-12 mb-3",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("span",{className:"fw-bold me-2",children:"Cost Price:"}),e.jsx("span",{children:e.jsx(ie,{value:s.cost_price})})]})}),e.jsx("div",{className:"col-md-12 mb-3",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("span",{className:"fw-bold me-2",children:"Selling Price:"}),e.jsx("span",{children:e.jsx(ie,{value:s.selling_price})})]})}),e.jsx("hr",{})]}),r===3&&(s.images.length>0?e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("hr",{}),e.jsx("label",{className:"form-label fw-bold",children:"Images"}),e.jsx("div",{className:"d-flex gap-2 flex-wrap",children:s.images.map((h,d)=>e.jsx(At,{preview:h.image_cover,index:d,allImages:s.images.map(f=>f.image_cover)},d))}),e.jsx("hr",{})]}):e.jsx("div",{className:"col-md-12 mb-3",children:e.jsxs("div",{className:"alert alert-secondary text-center rounded-3 py-4 shadow-sm",children:[e.jsx("i",{className:"bi bi-plus-circle fs-3 d-block mb-2 text-muted"}),e.jsx("span",{className:"fw-semibold text-muted",children:"No images added yet."})]})})),r===4&&e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("h6",{className:"fw-bold mb-3",children:"Addons"}),((v=s.product_addons)==null?void 0:v.length)>0?e.jsx("div",{className:"list-group shadow-sm rounded-3",children:s.product_addons.map((h,d)=>{var f;return e.jsxs("div",{children:[e.jsxs("div",{className:"list-group-item d-flex justify-content-between align-items-center  border-success",children:[e.jsx("div",{children:e.jsx("div",{className:"fw-semibold text-dark",children:((f=h.addon)==null?void 0:f.name)||`Addon #${d+1}`})}),e.jsx("div",{className:"fw-semibold",children:h.addon.is_freebies==="Y"?e.jsx("span",{className:"badge bg-success",children:"Freebie"}):e.jsx("span",{className:"text-dark",children:e.jsx(ie,{value:h.custom_price||h.addon.base_price||0})})})]}),d<s.product_addons.length-1&&e.jsx("hr",{className:"my-1 text-muted opacity-25"})]},d)})}):e.jsxs("div",{className:"alert alert-secondary text-center rounded-3 py-4 shadow-sm",children:[e.jsx("i",{className:"bi bi-gift fs-3 d-block mb-2 text-muted"}),e.jsx("span",{className:"fw-semibold text-muted",children:"No addons added yet."})]})]}),r===5&&e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("h6",{className:"fw-bold mb-3",children:"Variants"}),((i=s.variants)==null?void 0:i.length)>0?e.jsx("div",{className:"row g-3",children:s.variants.map((h,d)=>e.jsx("div",{className:"col-md-6",children:e.jsx("div",{className:"card shadow-sm h-100 border-success",children:e.jsxs("div",{className:"card-body d-flex justify-content-between align-items-start",children:[e.jsxs("div",{className:"flex-grow-1 pe-3",children:[e.jsx("h6",{className:"fw-semibold mb-1",children:h.variant_name||"-"}),e.jsxs("p",{className:"text-muted small mb-2",children:["SKU: ",h.sku||"-"]}),e.jsxs("div",{className:"d-flex justify-content-between small mb-1",children:[e.jsx("span",{className:"text-muted",children:"Quantity:"}),e.jsx("span",{className:"fw-semibold",children:h.quantity_on_hand??0})]}),e.jsxs("div",{className:"d-flex justify-content-between small mb-1",children:[e.jsx("span",{className:"text-muted",children:"Cost Price:"}),e.jsx("span",{className:"fw-semibold",children:e.jsx(ie,{value:h.cost_price||0})})]}),e.jsxs("div",{className:"d-flex justify-content-between small",children:[e.jsx("span",{className:"text-muted",children:"Selling Price:"}),e.jsx("span",{className:"fw-semibold",children:e.jsx(ie,{value:h.selling_price||0})})]})]}),e.jsx("div",{className:"ms-auto",children:e.jsx("img",{src:h.image_cover??fs("media/default.jpg"),alt:h.variant_name||"Variant Image",className:"rounded border",style:{width:"70px",height:"70px",objectFit:"cover"}})})]})})},d))}):e.jsxs("div",{className:"alert alert-secondary text-center rounded-3 py-4 shadow-sm",children:[e.jsx("i",{className:"bi bi-box-seam fs-3 d-block mb-2 text-muted"}),e.jsx("span",{className:"fw-semibold text-muted",children:"No variants added yet."})]})]})]})},$t=()=>{const s=Ls("/admin/product/list"),{viewProductDetails:r,archivedProduct:o}=os(),[m,v]=c.useState({visible:!1,title:"",body:e.jsx(e.Fragment,{}),className:"modal-xl",alignment:"centered"}),i=()=>{v({visible:!0,title:"Create Product",body:e.jsx(St,{setPage:s.setPage,setRefreshTable:s.setRefreshTable}),className:"modal-xl",alignment:"centered"})},h=async p=>{const y=await r(p);y&&v({visible:!0,title:"Edit Product",body:e.jsx(Et,{productID:p,data:y,setRefreshTable:s.setRefreshTable}),className:"modal-xl",alignment:"centered"})},d=async p=>{const y=await r(p);y&&v({visible:!0,title:"View Product Details",body:e.jsx(Pt,{data:y}),className:"modal-lg",alignment:"centered"})},f=async()=>{v({visible:!0,title:"Archived",body:e.jsx(qt,{onRefreshFirstTable:s.setRefreshTable}),className:"modal-xl",alignment:"centered"})};return e.jsx(e.Fragment,{children:e.jsxs(st,{children:[e.jsxs("div",{className:"card mb-5 mb-xl-8",children:[e.jsxs("div",{className:"card-header border-0 pt-5",children:[e.jsx("h3",{className:"card-title align-items-start flex-column",children:e.jsx("span",{className:"card-label fw-bold fs-3 mb-1",children:"Products"})}),e.jsxs("div",{className:"card-toolbar","data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-trigger":"hover",title:"Click to add a user",children:[e.jsxs("button",{onClick:()=>f(),className:"btn btn-sm btn-light-danger me-3",children:[e.jsx(Ss,{iconName:"delete-files",className:"fs-3"}),"Archived"]}),e.jsxs("button",{onClick:()=>i(),className:"btn btn-sm btn-light-primary",children:[e.jsx(Ss,{iconName:"plus",className:"fs-3"}),"New Product"]})]})]}),e.jsx("div",{className:"card-body py-3",children:e.jsx("div",{className:"table-responsive",children:e.jsx(dt,{data:s.data,loading:s.loading,pagination:s.pagination,sortColumn:s.sortColumn,sortDirection:s.sortDirection,onPageChange:s.setPage,onSortChange:(p,y)=>{s.setSortColumn(p),s.setSortDirection(y)},onEdit:h,onView:d,onArchive:o,onSearchChange:p=>{s.setPage(1),s.setSearch(p)},setRefreshTable:s.setRefreshTable})})})]}),m.visible&&e.jsx(rt,{title:m.title,body:m.body,modalClass:m.className,alignment:m.alignment,onClose:()=>v({visible:!1,title:"",body:e.jsx(e.Fragment,{}),className:"",alignment:"center"})})]})})},Ft=[{title:"Product List",path:"/product/list",isSeparator:!1,isActive:!1}],Mt=()=>e.jsxs(e.Fragment,{children:[e.jsx(tt,{breadcrumbs:Ft}),e.jsx($t,{})]});export{Mt as default};
