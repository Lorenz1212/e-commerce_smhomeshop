import{b as $,c as w,S as v,j as e,d as S,e as D,m as k,r as N,g as M,i as I,a as P,t as E,n as F,C as T,K as _,P as H}from"./index-47a86244.js";import{M as K}from"./ModalHandler-ad0ee9b4.js";import{a as A}from"./apiMultipart-5aee4e22.js";import{M as B}from"./MulitpleImageUploader-3f05f02e.js";import{D as q,A as V}from"./ActionsCell-25d0eec8.js";import{I as L}from"./ImageTitleCell-2b5fa3f1.js";const j=()=>{const{showLoader:c,hideLoader:t}=$();return{viewProductCategoryDetails:async d=>{var a,l;try{return c(),(await w.get(`/admin/product_category/${d}/edit`)).data}catch(s){return v.fire({icon:"error",title:(l=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:l.message}),null}finally{t()}},createProductCategory:async(d,a,l,s)=>{var i,n,y,o,u;try{c();const p=new FormData;["name"].forEach(f=>p.append(f,d[f])),d.images.forEach(f=>{p.append("images[]",f)});const b=await A.post("/admin/product_category/store",p);v.fire({icon:(i=b.data)==null?void 0:i.status,title:(n=b.data)==null?void 0:n.message}),((y=b.data)==null?void 0:y.status)=="success"&&(a(),l==null||l(!0),s==null||s(1))}catch(p){v.fire({icon:"error",title:(u=(o=p==null?void 0:p.response)==null?void 0:o.data)==null?void 0:u.message})}finally{t()}},updateProductCategory:async(d,a,l)=>{var s,i,n,y;try{c();const o=new FormData;["name"].forEach(C=>o.append(C,d[C])),d.images.forEach(C=>{o.append("images[]",C)});const p=await A.post(`/admin/product_category/${a}/update`,o);v.fire({icon:(s=p.data)==null?void 0:s.status,title:(i=p.data)==null?void 0:i.message}),l==null||l(!0)}catch(o){console.log(o),v.fire({icon:"error",title:(y=(n=o==null?void 0:o.response)==null?void 0:n.data)==null?void 0:y.message})}finally{t()}},archivedProductCategory:async(d,a)=>{var s,i,n,y;if((await v.fire({title:"Are you sure?",text:"This action will archive the item.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, archive it!"})).isConfirmed)try{c();const o=await w.delete(`/admin/product_category/${d}/delete`);v.fire({icon:((s=o.data)==null?void 0:s.status)||"success",title:(i=o.data)==null?void 0:i.message}),a==null||a(!0)}catch(o){v.fire({icon:"error",title:((y=(n=o==null?void 0:o.response)==null?void 0:n.data)==null?void 0:y.message)||"An error occurred."})}finally{t()}},restoreProductCategory:async(d,a,l)=>{var i,n,y,o;if((await v.fire({title:"Are you sure?",text:"This will restore the archived item.",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, restore it!"})).isConfirmed)try{c();const u=await w.post(`/admin/product_category/${d}/restore`);v.fire({icon:((i=u.data)==null?void 0:i.status)||"success",title:((n=u.data)==null?void 0:n.message)||"Item restored successfully."}),a==null||a(!0),l==null||l(!0)}catch(u){v.fire({icon:"error",title:((o=(y=u==null?void 0:u.response)==null?void 0:y.data)==null?void 0:o.message)||"Something went wrong."})}finally{t()}}}},Y=({data:c})=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-sm-4 text-muted",children:"Product Category"}),e.jsx("div",{className:"col-sm-8 fw-semibold",children:c.name})]})}),z=S().shape({name:D().min(1,"Minimum 1 character").max(50,"Maximum 50 characters").required("Category name is required"),images:k().test("required","Image is required",c=>Array.isArray(c)&&c.length>0)}),G=({setPage:c,setRefreshTable:t,onSubmit:r})=>{const[g,x]=N.useState([]),{createProductCategory:h}=j(),m=M({initialValues:{name:"",images:[]},validationSchema:z,onSubmit:async(d,{resetForm:a})=>{await h(d,a,t,c),r==null||r(d)}});return e.jsxs("form",{noValidate:!0,onSubmit:m.handleSubmit,children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-12",children:e.jsx(B,{name:"images",formik:m,previews:g,setPreviews:x,label:"Category Images",maxFiles:1})}),e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label",children:"Category Name"}),e.jsx("input",{type:"text",className:I("form-control",{"is-invalid":m.touched.name&&m.errors.name}),...m.getFieldProps("name")}),m.touched.name&&m.errors.name&&e.jsx("div",{className:"invalid-feedback",children:m.errors.name})]})]}),e.jsx("div",{className:"d-flex justify-content-end mt-4",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Save"})})]})},J=({categoryID:c,data:t,setRefreshTable:r,onSubmit:g})=>{var l;const{updateProductCategory:x}=j(),[h,m]=N.useState(((l=t==null?void 0:t.images)==null?void 0:l.map(s=>s.image_cover))||[]),d=S().shape({name:D().min(1,"Minimum 1 character").max(50,"Maximum 50 characters").required("Category name is required"),images:k().test("images","At least one image required",function(s){return Array.isArray(s)&&s.length>0||h&&h.length>0})}),a=M({initialValues:{name:t.name,images:[]},validationSchema:d,onSubmit:async(s,{resetForm:i})=>{await x(s,c,r),g==null||g(s)}});return e.jsxs("form",{noValidate:!0,onSubmit:a.handleSubmit,children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-12",children:e.jsx(B,{name:"images",formik:a,previews:h,setPreviews:m,label:"Category Images",maxFiles:1})}),e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label",children:"Product Category"}),e.jsx("input",{type:"text",className:I("form-control",{"is-invalid":a.touched.name&&a.errors.name}),...a.getFieldProps("name")}),a.touched.name&&typeof a.errors.name=="string"&&e.jsx("div",{className:"invalid-feedback",children:a.errors.name})]})]}),e.jsx("div",{className:"d-flex justify-content-end mt-4",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Save"})})]})},O=({data:c,loading:t,pagination:r,sortColumn:g,sortDirection:x,onPageChange:h,onSortChange:m,onEdit:d,onView:a,onArchive:l,onSearchChange:s,setRefreshTable:i})=>{const{currentUser:n}=P(),y=n==null?void 0:n.permissions,o=[{title:"#",key:"row_number",sortable:!0},{title:"Items",key:"image_cover",render:u=>{var p;return e.jsx(L,{image:((p=u.images[0])==null?void 0:p.image_cover)??E("media/default.jpg"),mainTitle:u.name})}},{title:"Created At",key:"created_at_format",sortable:!0},{title:"Action",key:"id_encrypted",render:u=>e.jsx(V,{openDetailsModal:y.includes("view_product_category_details")?()=>a(u.id_encrypted):void 0,openEditModal:y.includes("update_product_category")?()=>d(u.id_encrypted):void 0,archiveAction:y.includes("archived_product_category")?()=>l(u.id_encrypted,i):void 0})}];return e.jsx("div",{className:"table-responsive",children:t?e.jsx("div",{className:"alert alert-info",children:"Loading..."}):e.jsx(q,{data:c,columns:o,loading:t,pagination:r,sortColumn:g,sortDirection:x,onPageChange:h,onSortChange:m,onSearchChange:s})})},Q=({data:c,loading:t,pagination:r,sortColumn:g,sortDirection:x,onPageChange:h,onSortChange:m,onRestore:d,onSearchChange:a,setRefreshTable:l,setRefreshFirstTable:s})=>{const{currentUser:i}=P(),n=i==null?void 0:i.permissions,y=[{title:"#",key:"row_number",sortable:!0},{title:"Items",key:"image_cover",render:o=>{var u;return e.jsx(L,{image:((u=o.images[0])==null?void 0:u.image_cover)??E("media/default.jpg"),mainTitle:o.name})}},{title:"Created At",key:"created_at_format",sortable:!0},{title:"Action",key:"id_encrypted",render:o=>e.jsx(V,{restoreAction:n.includes("restore_product_category")?()=>d(o.id_encrypted,l,s):void 0})}];return e.jsx("div",{className:"table-responsive",children:t?e.jsx("div",{className:"alert alert-info",children:"Loading..."}):e.jsx(q,{data:c,columns:y,loading:t,pagination:r,sortColumn:g,sortDirection:x,onPageChange:h,onSortChange:m,onSearchChange:a})})},W=({onRefreshFirstTable:c})=>{const t=F("/admin/product_category/archived/list"),{restoreProductCategory:r}=j();return e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsx(Q,{data:t.data,loading:t.loading,pagination:t.pagination,sortColumn:t.sortColumn,sortDirection:t.sortDirection,onPageChange:t.setPage,onSortChange:(g,x)=>{t.setSortColumn(g),t.setSortDirection(x)},onRestore:r,onSearchChange:g=>{t.setPage(1),t.setSearch(g)},setRefreshTable:t.setRefreshTable,setRefreshFirstTable:c})})})},X=()=>{const{currentUser:c}=P(),t=c==null?void 0:c.permissions,r=F("/admin/product_category/list"),{viewProductCategoryDetails:g,archivedProductCategory:x}=j(),[h,m]=N.useState({visible:!1,title:"",body:e.jsx(e.Fragment,{}),className:"modal-xl",alignment:"centered"}),d=()=>{m({visible:!0,title:"Create Category",body:e.jsx(G,{setPage:r.setPage,setRefreshTable:r.setRefreshTable}),className:"modal-lg",alignment:"centered"})},a=async i=>{const n=await g(i);n&&m({visible:!0,title:"Edit Category",body:e.jsx(J,{categoryID:i,data:n,setRefreshTable:r.setRefreshTable}),className:"modal-lg",alignment:"centered"})},l=async i=>{const n=await g(i);n&&m({visible:!0,title:"View Category Details",body:e.jsx(Y,{data:n}),className:"modal-md",alignment:"centered"})},s=async()=>{m({visible:!0,title:"Archived",body:e.jsx(W,{onRefreshFirstTable:r.setRefreshTable}),className:"modal-xl",alignment:"centered"})};return e.jsx(e.Fragment,{children:e.jsxs(T,{children:[e.jsxs("div",{className:"card mb-5 mb-xl-8",children:[e.jsxs("div",{className:"card-header border-0 pt-5",children:[e.jsx("h3",{className:"card-title align-items-start flex-column",children:e.jsx("span",{className:"card-label fw-bold fs-3 mb-1",children:"Product Category"})}),e.jsxs("div",{className:"card-toolbar","data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-trigger":"hover",title:"Click to add a user",children:[t.includes("archived_product")&&e.jsxs("button",{onClick:()=>s(),className:"btn btn-sm btn-light-danger me-3",children:[e.jsx(_,{iconName:"delete-files",className:"fs-3"}),"Archived"]}),t.includes("create_product")&&e.jsxs("button",{onClick:()=>d(),className:"btn btn-sm btn-light-primary",children:[e.jsx(_,{iconName:"plus",className:"fs-3"}),"New Category"]})]})]}),e.jsx("div",{className:"card-body py-3",children:e.jsx("div",{className:"table-responsive",children:e.jsx(O,{data:r.data,loading:r.loading,pagination:r.pagination,sortColumn:r.sortColumn,sortDirection:r.sortDirection,onPageChange:r.setPage,onSortChange:(i,n)=>{r.setSortColumn(i),r.setSortDirection(n)},onEdit:a,onView:l,onArchive:x,onSearchChange:i=>{r.setPage(1),r.setSearch(i)},setRefreshTable:r.setRefreshTable})})})]}),h.visible&&e.jsx(K,{title:h.title,body:h.body,modalClass:h.className,alignment:h.alignment,onClose:()=>m({visible:!1,title:"",body:e.jsx(e.Fragment,{}),className:"",alignment:"center"})})]})})},Z=[{title:"Product Category",path:"/product/category/list",isSeparator:!1,isActive:!1}],re=()=>e.jsxs(e.Fragment,{children:[e.jsx(H,{breadcrumbs:Z}),e.jsx(X,{})]});export{re as default};
