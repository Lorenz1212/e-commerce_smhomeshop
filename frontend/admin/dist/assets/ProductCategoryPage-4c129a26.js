import{b as L,c as N,S as p,j as e,d as S,e as _,m as D,r as w,g as k,i as M,t as I,n as E,C as $,K as P,P as T}from"./index-04b06589.js";import{M as H}from"./ModalHandler-03d27907.js";import{a as A}from"./apiMultipart-73b930eb.js";import{M as F}from"./MulitpleImageUploader-08105d64.js";import{D as B,A as q}from"./ActionsCell-f1e55298.js";import{I as V}from"./ImageTitleCell-e3aed608.js";const j=()=>{const{showLoader:t,hideLoader:r}=L();return{viewProductCategoryDetails:async n=>{var s,o;try{return t(),(await N.get(`/admin/product_category/${n}/edit`)).data}catch(a){return p.fire({icon:"error",title:(o=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:o.message}),null}finally{r()}},createProductCategory:async(n,s,o,a)=>{var g,d,c,i,x;try{t();const C=new FormData;["name"].forEach(v=>C.append(v,n[v])),n.images.forEach(v=>{C.append("images[]",v)});const b=await A.post("/admin/product_category/store",C);p.fire({icon:(g=b.data)==null?void 0:g.status,title:(d=b.data)==null?void 0:d.message}),((c=b.data)==null?void 0:c.status)=="success"&&(s(),o==null||o(!0),a==null||a(1))}catch(C){p.fire({icon:"error",title:(x=(i=C==null?void 0:C.response)==null?void 0:i.data)==null?void 0:x.message})}finally{r()}},updateProductCategory:async(n,s,o)=>{var a,g,d,c;try{t();const i=new FormData;["name"].forEach(f=>i.append(f,n[f])),n.images.forEach(f=>{i.append("images[]",f)});const C=await A.post(`/admin/product_category/${s}/update`,i);p.fire({icon:(a=C.data)==null?void 0:a.status,title:(g=C.data)==null?void 0:g.message}),o==null||o(!0)}catch(i){console.log(i),p.fire({icon:"error",title:(c=(d=i==null?void 0:i.response)==null?void 0:d.data)==null?void 0:c.message})}finally{r()}},archivedProductCategory:async(n,s)=>{var a,g,d,c;if((await p.fire({title:"Are you sure?",text:"This action will archive the item.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, archive it!"})).isConfirmed)try{t();const i=await N.delete(`/admin/product_category/${n}/delete`);p.fire({icon:((a=i.data)==null?void 0:a.status)||"success",title:(g=i.data)==null?void 0:g.message}),s==null||s(!0)}catch(i){p.fire({icon:"error",title:((c=(d=i==null?void 0:i.response)==null?void 0:d.data)==null?void 0:c.message)||"An error occurred."})}finally{r()}},restoreProductCategory:async(n,s,o)=>{var g,d,c,i;if((await p.fire({title:"Are you sure?",text:"This will restore the archived item.",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, restore it!"})).isConfirmed)try{t();const x=await N.post(`/admin/product_category/${n}/restore`);p.fire({icon:((g=x.data)==null?void 0:g.status)||"success",title:((d=x.data)==null?void 0:d.message)||"Item restored successfully."}),s==null||s(!0),o==null||o(!0)}catch(x){p.fire({icon:"error",title:((i=(c=x==null?void 0:x.response)==null?void 0:c.data)==null?void 0:i.message)||"Something went wrong."})}finally{r()}}}},K=({data:t})=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-sm-4 text-muted",children:"Product Category"}),e.jsx("div",{className:"col-sm-8 fw-semibold",children:t.name})]})}),U=S().shape({name:_().min(1,"Minimum 1 character").max(50,"Maximum 50 characters").required("Category name is required"),images:D().test("required","Image is required",t=>Array.isArray(t)&&t.length>0)}),Y=({setPage:t,setRefreshTable:r,onSubmit:y})=>{const[l,u]=w.useState([]),{createProductCategory:h}=j(),m=k({initialValues:{name:"",images:[]},validationSchema:U,onSubmit:async(n,{resetForm:s})=>{await h(n,s,r,t),y==null||y(n)}});return e.jsxs("form",{noValidate:!0,onSubmit:m.handleSubmit,children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-12",children:e.jsx(F,{name:"images",formik:m,previews:l,setPreviews:u,label:"Category Images",maxFiles:1})}),e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label",children:"Category Name"}),e.jsx("input",{type:"text",className:M("form-control",{"is-invalid":m.touched.name&&m.errors.name}),...m.getFieldProps("name")}),m.touched.name&&m.errors.name&&e.jsx("div",{className:"invalid-feedback",children:m.errors.name})]})]}),e.jsx("div",{className:"d-flex justify-content-end mt-4",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Save"})})]})},z=({categoryID:t,data:r,setRefreshTable:y,onSubmit:l})=>{var o;const{updateProductCategory:u}=j(),[h,m]=w.useState(((o=r==null?void 0:r.images)==null?void 0:o.map(a=>a.image_cover))||[]),n=S().shape({name:_().min(1,"Minimum 1 character").max(50,"Maximum 50 characters").required("Category name is required"),images:D().test("images","At least one image required",function(a){return Array.isArray(a)&&a.length>0||h&&h.length>0})}),s=k({initialValues:{name:r.name,images:[]},validationSchema:n,onSubmit:async(a,{resetForm:g})=>{await u(a,t,y),l==null||l(a)}});return e.jsxs("form",{noValidate:!0,onSubmit:s.handleSubmit,children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-12",children:e.jsx(F,{name:"images",formik:s,previews:h,setPreviews:m,label:"Category Images",maxFiles:1})}),e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label",children:"Product Category"}),e.jsx("input",{type:"text",className:M("form-control",{"is-invalid":s.touched.name&&s.errors.name}),...s.getFieldProps("name")}),s.touched.name&&typeof s.errors.name=="string"&&e.jsx("div",{className:"invalid-feedback",children:s.errors.name})]})]}),e.jsx("div",{className:"d-flex justify-content-end mt-4",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Save"})})]})},G=({data:t,loading:r,pagination:y,sortColumn:l,sortDirection:u,onPageChange:h,onSortChange:m,onEdit:n,onView:s,onArchive:o,onSearchChange:a,setRefreshTable:g})=>{const d=[{title:"#",key:"row_number",sortable:!0},{title:"Items",key:"image_cover",render:c=>{var i;return e.jsx(V,{image:((i=c.images[0])==null?void 0:i.image_cover)??I("media/default.jpg"),mainTitle:c.name})}},{title:"Created At",key:"created_at_format",sortable:!0},{title:"Action",key:"id_encrypted",render:c=>e.jsx(q,{openDetailsModal:()=>s(c.id_encrypted),openEditModal:()=>n(c.id_encrypted),archiveAction:()=>o(c.id_encrypted,g)})}];return e.jsx("div",{className:"table-responsive",children:r?e.jsx("div",{className:"alert alert-info",children:"Loading..."}):e.jsx(B,{data:t,columns:d,loading:r,pagination:y,sortColumn:l,sortDirection:u,onPageChange:h,onSortChange:m,onSearchChange:a})})},J=({data:t,loading:r,pagination:y,sortColumn:l,sortDirection:u,onPageChange:h,onSortChange:m,onRestore:n,onSearchChange:s,setRefreshTable:o,setRefreshFirstTable:a})=>{const g=[{title:"#",key:"row_number",sortable:!0},{title:"Items",key:"image_cover",render:d=>{var c;return e.jsx(V,{image:((c=d.images[0])==null?void 0:c.image_cover)??I("media/default.jpg"),mainTitle:d.name})}},{title:"Created At",key:"created_at_format",sortable:!0},{title:"Action",key:"id_encrypted",render:d=>e.jsx(q,{restoreAction:()=>n(d.id_encrypted,o,a)})}];return e.jsx("div",{className:"table-responsive",children:r?e.jsx("div",{className:"alert alert-info",children:"Loading..."}):e.jsx(B,{data:t,columns:g,loading:r,pagination:y,sortColumn:l,sortDirection:u,onPageChange:h,onSortChange:m,onSearchChange:s})})},O=({onRefreshFirstTable:t})=>{const r=E("/admin/product_category/archived/list"),{restoreProductCategory:y}=j();return e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsx(J,{data:r.data,loading:r.loading,pagination:r.pagination,sortColumn:r.sortColumn,sortDirection:r.sortDirection,onPageChange:r.setPage,onSortChange:(l,u)=>{r.setSortColumn(l),r.setSortDirection(u)},onRestore:y,onSearchChange:l=>{r.setPage(1),r.setSearch(l)},setRefreshTable:r.setRefreshTable,setRefreshFirstTable:t})})})},Q=()=>{const t=E("/admin/product_category/list"),{viewProductCategoryDetails:r,archivedProductCategory:y}=j(),[l,u]=w.useState({visible:!1,title:"",body:e.jsx(e.Fragment,{}),className:"modal-xl",alignment:"centered"}),h=()=>{u({visible:!0,title:"Create Category",body:e.jsx(Y,{setPage:t.setPage,setRefreshTable:t.setRefreshTable}),className:"modal-lg",alignment:"centered"})},m=async o=>{const a=await r(o);a&&u({visible:!0,title:"Edit Category",body:e.jsx(z,{categoryID:o,data:a,setRefreshTable:t.setRefreshTable}),className:"modal-lg",alignment:"centered"})},n=async o=>{const a=await r(o);a&&u({visible:!0,title:"View Category Details",body:e.jsx(K,{data:a}),className:"modal-md",alignment:"centered"})},s=async()=>{u({visible:!0,title:"Archived",body:e.jsx(O,{onRefreshFirstTable:t.setRefreshTable}),className:"modal-xl",alignment:"centered"})};return e.jsx(e.Fragment,{children:e.jsxs($,{children:[e.jsxs("div",{className:"card mb-5 mb-xl-8",children:[e.jsxs("div",{className:"card-header border-0 pt-5",children:[e.jsx("h3",{className:"card-title align-items-start flex-column",children:e.jsx("span",{className:"card-label fw-bold fs-3 mb-1",children:"Product Category"})}),e.jsxs("div",{className:"card-toolbar","data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-trigger":"hover",title:"Click to add a user",children:[e.jsxs("button",{onClick:()=>s(),className:"btn btn-sm btn-light-danger me-3",children:[e.jsx(P,{iconName:"delete-files",className:"fs-3"}),"Archived"]}),e.jsxs("button",{onClick:()=>h(),className:"btn btn-sm btn-light-primary",children:[e.jsx(P,{iconName:"plus",className:"fs-3"}),"New Category"]})]})]}),e.jsx("div",{className:"card-body py-3",children:e.jsx("div",{className:"table-responsive",children:e.jsx(G,{data:t.data,loading:t.loading,pagination:t.pagination,sortColumn:t.sortColumn,sortDirection:t.sortDirection,onPageChange:t.setPage,onSortChange:(o,a)=>{t.setSortColumn(o),t.setSortDirection(a)},onEdit:m,onView:n,onArchive:y,onSearchChange:o=>{t.setPage(1),t.setSearch(o)},setRefreshTable:t.setRefreshTable})})})]}),l.visible&&e.jsx(H,{title:l.title,body:l.body,modalClass:l.className,alignment:l.alignment,onClose:()=>u({visible:!1,title:"",body:e.jsx(e.Fragment,{}),className:"",alignment:"center"})})]})})},W=[{title:"Product Category",path:"/product/category/list",isSeparator:!1,isActive:!1}],re=()=>e.jsxs(e.Fragment,{children:[e.jsx(T,{breadcrumbs:W}),e.jsx(Q,{})]});export{re as default};
